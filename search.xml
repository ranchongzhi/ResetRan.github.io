<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>最小网络节点覆盖问题</title>
      <link href="snowdrift-game/"/>
      <url>snowdrift-game/</url>
      
        <content type="html"><![CDATA[<h2 id="题目简述"><a href="#题目简述" class="headerlink" title="题目简述"></a>题目简述</h2><p>证明：当雪堆博弈满足$r&lt;\frac{1}{k_{max}}$时，网络博弈的纳什均衡中的采样合作策略的节点构成极小节点覆盖。（作业：自己编写程序验证这个结论，网络可自定，节点数目不少于20）</p><h2 id="问题背景简述"><a href="#问题背景简述" class="headerlink" title="问题背景简述"></a>问题背景简述</h2><h3 id="雪堆博弈"><a href="#雪堆博弈" class="headerlink" title="雪堆博弈"></a>雪堆博弈</h3><p>在一个风雪交加的夜晚，两人相向而来，被一个雪堆所阻，假设铲除这个雪堆使道路通畅需要的代价为c，如果道路通畅则带给每个人的好处量化为<code>b</code>。如果两人一齐动手铲雪，则他们的收益为<code>R=b-c/2</code>；如果只有一人铲雪，虽然两个人都可以回家，但是背叛者逃避了劳动，它的收益为<code>T=b</code>，而合作者的收益为<code>S=b-c</code>；如果两人都选择不合作，两人都被雪堆挡住而无法回家，他们的收益都为<code>P=0</code>。这里假设收益参数满足下面的条件：<code>T&gt;R&gt;S&gt;P</code>。</p><h3 id="纳什均衡"><a href="#纳什均衡" class="headerlink" title="纳什均衡"></a>纳什均衡</h3><p>在博弈论中，如果每个参与者都选择了自己的策略，并且没有玩家可以透过改变策略而其他参与者保持不变而获益，那么当前的策略选择的集合及其相应的结果构成了纳什均衡。即若$\displaystyle p_{i} (s)=max_{r_{i}}[p_i(s;r_i)]$，则称<em>s</em>为纳什均衡点，其中：$p_i$为参与者i的收获（payoff），$s_{i}$代表所有参与者之策略，$r_{i}$代表参与者i的一种可能策略，$(s;r_i)$指参与者i单方面改变策略为$r_i$。</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>python=3.7.4</p><p>Windows10</p><h2 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h2><ol><li>给每个节点的初始状态随机设置为<code>C</code>或者<code>D</code></li><li>依次计算每个节点采用<code>C</code>行为和<code>D</code>行为的收益，通过改变策略使收益最大</li><li>重复步骤2直到每个节点的状态信息不再发生变化</li></ol><p>采取不同策略时，收益表如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-25_16-19-02.png"></p><h2 id="迭代流程图"><a href="#迭代流程图" class="headerlink" title="迭代流程图"></a>迭代流程图</h2><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/%E6%B5%81%E7%A8%8B.png"></p><h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><p>本次实验选取的网络结构如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/graph_1.png" style="zoom:200%;" /><p>运行之后，结果如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-26_16-41-14.png"></p><p>其中第一列表示节点序号，第二列表示节点当前的策略，第三列表示执行当前策略的收益值，最后一行表示总的收益。结果图像如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/graph_2.png" style="zoom:200%;" /><p>其中红色表示策略D，蓝色表示策略C</p><p>多次实验后，我们发现每一次网络满足纳什均衡的策略组合都能满足最小节点覆盖。雪堆博弈模型在实现的方面较很多网络算法更为简单，且一定能够搜索到极小节点覆盖，具有很强的实用性。同时，作为博弈论模型，反映出个体在博弈中寻求最大利益的属性，使得整个群体在数次迭代后趋向于一个对整体较为有利的情况，也就是每条边两端都有至少有一个C节点使得该边得以通行，使得整个群体得到最大的利益。</p><h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> random<span class="token comment" spellcheck="true"># 收益矩阵</span>r<span class="token operator">=</span><span class="token number">0.02</span>interest<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>r<span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'C'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>r<span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">-</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 结点数据结构</span><span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'C'</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token string">'D'</span>        self<span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token number">0</span>        self<span class="token punctuation">.</span>all_value<span class="token operator">=</span><span class="token number">0</span>        self<span class="token punctuation">.</span>neighbour_number<span class="token operator">=</span><span class="token number">0</span>        self<span class="token punctuation">.</span>nb<span class="token operator">=</span>list<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">pass</span>    <span class="token keyword">pass</span><span class="token keyword">class</span> <span class="token class-name">Network</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>numbers<span class="token operator">=</span>n        self<span class="token punctuation">.</span>nodes<span class="token operator">=</span>list<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>edges<span class="token operator">=</span>list<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>generateNode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 生成n个结点</span>    <span class="token keyword">def</span> <span class="token function">generateNode</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            tmp_node <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp_node<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">addEgde</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>es<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> e <span class="token keyword">in</span> es<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>edges<span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 保存结点的邻居</span>    <span class="token keyword">def</span> <span class="token function">saveNb</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> self<span class="token punctuation">.</span>edges<span class="token punctuation">:</span>            a<span class="token punctuation">.</span>nb<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>            b<span class="token punctuation">.</span>nb<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>neighbour_number<span class="token operator">=</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nb<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 计算每个结点的平均收益</span>    <span class="token keyword">def</span> <span class="token function">calValue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>all_value<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> self<span class="token punctuation">.</span>edges<span class="token punctuation">:</span>            a<span class="token punctuation">.</span>all_value<span class="token operator">+=</span>interest<span class="token punctuation">[</span>a<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            b<span class="token punctuation">.</span>all_value<span class="token operator">+=</span>interest<span class="token punctuation">[</span>a<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token operator">=</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>all_value<span class="token operator">/</span>self<span class="token punctuation">.</span>nodes\                <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>neighbour_number    <span class="token comment" spellcheck="true"># 最优邻居法更新状态</span>    <span class="token keyword">def</span> <span class="token function">updateState</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            max_value<span class="token operator">=</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>neighbour_number<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nb<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token operator">></span>\                    max_value<span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token operator">=</span>self<span class="token punctuation">.</span>nodes\                        <span class="token punctuation">[</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nb<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>state                    max_value<span class="token operator">=</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nb<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># 计算单个结点的收益</span>    <span class="token keyword">def</span> <span class="token function">getReward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>        all_value<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">for</span> s <span class="token keyword">in</span>  self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nb<span class="token punctuation">:</span>            all_value<span class="token operator">+=</span>interest<span class="token punctuation">[</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>nodes\                <span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        value <span class="token operator">=</span> all_value <span class="token operator">/</span> self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>neighbour_number        <span class="token keyword">return</span> value    <span class="token comment" spellcheck="true"># 获得总收益</span>    <span class="token keyword">def</span> <span class="token function">getAllReward</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>reward <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> self<span class="token punctuation">.</span>edges<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>reward<span class="token operator">+=</span>sum<span class="token punctuation">(</span>interest<span class="token punctuation">[</span>a<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">.</span>state<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>reward    <span class="token keyword">def</span> <span class="token function">outputState</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'----------------'</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%d:%c %f '</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>self<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span>self<span class="token punctuation">.</span>nodes\                <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reward<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'----------------'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">designNet2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    net<span class="token operator">=</span>Network<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>    edge_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span>                <span class="token punctuation">]</span>    net<span class="token punctuation">.</span>addEgde<span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token punctuation">{</span>net<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> net<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> edge_list<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> net    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>        mynet<span class="token operator">=</span>designNet2<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(mynet.edges)</span>    mynet<span class="token punctuation">.</span>saveNb<span class="token punctuation">(</span><span class="token punctuation">)</span>    max_reward<span class="token operator">=</span><span class="token number">0</span>    i1<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        reward<span class="token operator">=</span>mynet<span class="token punctuation">.</span>getAllReward<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>max_reward<span class="token operator">==</span>reward<span class="token punctuation">)</span><span class="token punctuation">:</span>            i1<span class="token operator">+=</span><span class="token number">1</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>i1<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                mynet<span class="token punctuation">.</span>calValue<span class="token punctuation">(</span><span class="token punctuation">)</span>                mynet<span class="token punctuation">.</span>outputState<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token keyword">elif</span><span class="token punctuation">(</span>reward<span class="token operator">></span>max_reward<span class="token punctuation">)</span><span class="token punctuation">:</span>            i1<span class="token operator">=</span><span class="token number">0</span>            max_reward<span class="token operator">=</span>reward        mynet<span class="token punctuation">.</span>updateState<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 雪堆博弈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>社区发现算法</title>
      <link href="community-detection/"/>
      <url>community-detection/</url>
      
        <content type="html"><![CDATA[<h2 id="一、任务简介"><a href="#一、任务简介" class="headerlink" title="一、任务简介"></a>一、任务简介</h2><p>通过编程实现两个社区发现算法，并利用实例进行验证，最后对算法的复杂度进行分析。</p><blockquote><p>本次大作业选取的算法为GN算法和Louvain算法</p></blockquote><h2 id="二、概念简介"><a href="#二、概念简介" class="headerlink" title="二、概念简介"></a>二、概念简介</h2><h3 id="复杂网络"><a href="#复杂网络" class="headerlink" title="复杂网络"></a>复杂网络</h3><p>在网络理论的研究中，复杂网络是由数量巨大的节点和节点之间错综复杂的关系共同构成的网络结构。用数学的语言来说，就是一个有着足够复杂的拓扑结构特征的图。复杂网络具有简单网络，如规则网络、随机图等结构所不具备的特性，而这些特性往往出现在真实世界的网络结构中。</p><p>在自然界和人类社会中，复杂网络无处不在，如自然界中的生态网络、新陈代谢网络、蛋白质网络等；人类社会中的社交网络、交通网络、电子邮件网络、科学家合作网、电子电路网络等，这些复杂系统都可以用复杂网络的相关特性进行描述和分析，网络中的结点表示系统个体，边表示个体之间的关系。如今，复杂网络的研究是现今科学研究中的一个热点，它已渗透到各个领域，并成为这些领域的重要研究方向</p><h3 id="社区发现"><a href="#社区发现" class="headerlink" title="社区发现"></a>社区发现</h3><p>随着复杂网络理论的发展，继1998年Watts和Strogtz提出了WS小世界模型(<a href="https://en.wikipedia.org/wiki/Small-world_network" target="_blank" rel="noopener">Small-world network</a>)，1999年Barabasi和Albert提出无标度网络模型(<a href="https://en.wikipedia.org/wiki/Scale-free_network" target="_blank" rel="noopener">Scale-free network</a>)之后，人们发现复杂网络具有一定的社区结构。相同类型节点之间连接较多，构成一个一个的小社区，不同类型节点之间连接较少，但成为沟通不同社区的重要通道，这种连接的不均匀性表明，网络内部存在一定的自然分化。</p><p>对于社区（community），目前没有明确的定义，常见的是Newman和Gievan提出的：<strong>社区是图的一个子图，相比于图的其他部分，其中包含着密集的节点，或者等价地说，如果图一个子图内部的链接数量高于这些子图之间的链接数，我们就可以说这个图含有社区</strong>。如下图所示，图中网络包含三个社区结构，分别对应图中的三个虚线圈内的节点，同一社区内的节点和节点之间连接很紧密，而社区与社区之间的连接比较稀疏。换而言之，复杂网络的社区结构是复杂网络中社区之间的连接相对稀疏，而社区内部的连接相对稠密的特性。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-21_15-25-50.jpg"></p><h3 id="介数和边介数"><a href="#介数和边介数" class="headerlink" title="介数和边介数"></a>介数和边介数</h3><p>2004年，Newman和Girvan的论文中提出了利用介数中心性（betweenness centrality）的方法，称之为Girvan-Newman算法，这篇论文也是开创了社区发现这一领域的文章。本文主要针对无权和有权网络，对此类算法进行一定的研究分析。</p><p>在图论中，介数中心性（betweenness centrality）是基于最短路径的图的中心的度量方法。对于连通图中的每对顶点，在顶点之间至少存在一条最短路径，而<strong>一个节点的介数一般是指通过该节点的最短路径数</strong>。</p><p>节点介数中心性的定义如下：<br>$$<br>g(v)=\sum_{s \neq v \neq t \in V} \frac{\sigma_{s t(v)}}{\sigma_{s t}}<br>$$<br>其中$\sigma_{s t(v)}$表示通过节点$v$的节点$s\Rightarrow t$最短路径的数量，$s、t$表示图中的节点，$\sigma_{st}$表示节点$s\Rightarrow t$的最短路径的数量。直观上来说，节点的介数中心性反映了节点$v$作为”桥梁”的重要程度。</p><p>通过节点介数我们可以引出边介数的概念，<strong>边介数即为经过该边的最短路径的数量</strong>，因此可以引出边介数中心性的概念，它可以用来<strong>衡量图中一条边作为”桥梁”的重要程度</strong>。</p><h3 id="模块度"><a href="#模块度" class="headerlink" title="模块度"></a>模块度</h3><p>模块度，是指复杂网络中连接社区内部节点的边所占的比例，与另一个随机网络中连接社区内部节点的边所占的比例的期望值的差值。其中，这个随机网络的构造方法为：保持每个节点的社区属性不变，根据节点度对节点间的边进行随机连接。如果社区结构比较明显，则社区内部连接的边的比例应改高于随机网络的期望值。</p><p>模块度定义如下：<br>$$<br>Q=\frac{1}{2m}\sum_{i,j}[A_{ij}-\frac{k_ik_j}{2m}]\delta(c_i,c_j)<br>$$</p><p>其中，m表示网络中边的数量，A为邻接矩阵，$A_{ij}$就是i和j的之间的连边权重，$k_{i}$表示所有指向i节点的连接边权重和，$\delta (c_i,c_j)$满足：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-24_22-15-15.jpg"></p><h3 id="社区发现效果的评价指标——NMI指数"><a href="#社区发现效果的评价指标——NMI指数" class="headerlink" title="社区发现效果的评价指标——NMI指数"></a>社区发现效果的评价指标——NMI指数</h3><p>NMI是社区发现(community detection)在有标准ground-truth的情况下的重要衡量指标，基本可以比较客观地评价出一个社区划分与标准划分之间相比的准确度。NMI的值域是0到1，越高代表划分得越准。NMI指数的计算公式如下：<br>$$<br>NMI(X;Y)=2\frac{I(X;Y)}{H(X)+H(Y)}<br>$$<br>其中，$X,Y$表示实验社区发现的结果以及实际情况，$H(X)$表示$X$的信息熵，计算公式如下：<br>$$<br>H(X)=-\sum_{i}p(x_i)logp(x_i)<br>$$<br>$I(X;Y)$表示$X,Y$的互信息，它可以看成是一个随机变量中包含的关于另一个随机变量的信息量，或者说是一个随机变量由于已知另一个随机变量而减少的不肯定性。计算公式如下：<br>$$<br>I(X;Y)=\sum_{x}\sum_{y}p(x,y)log\frac{p(x,y)}{p(x)p(y)}<br>$$<br>$p(x),p(x,y)$分别表示随机变量$X,Y$的边缘分布和联合分布。</p><h2 id="三、算法原理介绍"><a href="#三、算法原理介绍" class="headerlink" title="三、算法原理介绍"></a>三、算法原理介绍</h2><h3 id="基于边介数的社区发现算法——Girvan-Newman算法"><a href="#基于边介数的社区发现算法——Girvan-Newman算法" class="headerlink" title="基于边介数的社区发现算法——Girvan-Newman算法"></a>基于边介数的社区发现算法——Girvan-Newman算法</h3><p>直观来看，在社区内部节点之间相互连接的边密度较大，因此，通过边介数（连接社区的边的边介数大）来识别社区是一种较为直观的社区发现算法。Girvan-Newman算法即是一种基于介数的社区发现算法，其基本思想是根据边介数中心性（edge betweenness）从大到小的顺序不断的将边从网络中移除直到整个网络分解为各个社区。因此，Girvan-Newman算法实际上是一种分裂方法。</p><p>该算法的基本流程如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-21_21-38-56.jpg"  /><h3 id="基于模块度的社区发现算法——Louvain算法"><a href="#基于模块度的社区发现算法——Louvain算法" class="headerlink" title="基于模块度的社区发现算法——Louvain算法"></a>基于模块度的社区发现算法——Louvain算法</h3><p>Louvain算法是一种基于多层次优化Modularit（模块度）的算法，它的优点是快速、准确，被认为是性能最好的社区发现算法之一。Modularity函数最初被用于衡量社区发现算法结果的质量，它能够刻画发现的社区的紧密程度。那么既然能刻画社区的紧密程度，也就能够被用来当作一个优化函数，如果能够提升当前社区结构的modularity，即将结点加入它的某个邻居所在的社区中。</p><p>如果当前结点所在的社区只有它自己，那么在计算将它加入到其它社区时的modularity的变化有个技巧来加速计算，Louvain的高效性也在一定程度上受益于此，它具体如下:<br>$$<br>\begin{align*}<br>\Delta Q &amp;=\left [ \frac{\sum_{in}^{}{+k_{i,in}} }{2m} -(\frac{\sum_{tot}^{}{+k_{i}} }{2m})^2  \right ]-\left [ \frac{\sum_{in}^{}}{2m} -(\frac{\sum_{tot}^{}}{2m})^2-(\frac{k_i}{2m})^2  \right ]\<br> &amp;=\frac{1}{2m}(k_{i,in}-\frac{\sum_{tot}^{}k_i }{m} )<br>\end{align*}<br>$$<br>Louvain算法主要包括两个阶段：</p><ol><li><p>遍历网络中的所有结点，尝试将单个结点加入能使modulatity提升最大的社区中，直到所有结点不再变化</p></li><li><p>将上一步的结果生成的一个个小社区归并为一个超结点来重新构造网络，这时边的权重为两个结点内所有原始结点的边权重之和。</p></li></ol><p>算法基本流程如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_20-31-29.jpg"></p><h2 id="四、算法实现"><a href="#四、算法实现" class="headerlink" title="四、算法实现"></a>四、算法实现</h2><h3 id="GN算法"><a href="#GN算法" class="headerlink" title="GN算法"></a>GN算法</h3><p>将用于测试的网络数据存放于<code>network.dat</code>文件中，格式如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_20-03-18.jpg"></p><p>比如前两行就表示0，1这两个节点相连，利用<code>networkx</code>库进行无向图的绘制，输出如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_20-29-35.jpg" style="zoom:80%;" /><p>经过GN算法，删除掉“桥梁”边之后，得到的图像如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/gn-2.jpg" style="zoom:67%;" /><p>可见总的节点被分为14个社团，任选其中一个社团放大，如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_20-50-38.jpg"></p><p>可以看出社团内部之间的连接很紧密，具体的社区发现结果我们保存在<code>predict.txt</code>文件中，该文件第一列表示节点，第二列表示社团编号，在这里截取一部分展示。</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_20-54-56.jpg" style="zoom:50%;" /><h3 id="Louvain算法"><a href="#Louvain算法" class="headerlink" title="Louvain算法"></a>Louvain算法</h3><p>同样是读取<code>network.dat</code>文件，然后利用Louvain算法进行社区发现，结果图如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_23-06-22.jpg"></p><p>放大右下角，如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_23-07-41.jpg"></p><p>得到的结果存放于<code>Louvain_predict.txt</code>文件中，截取一部分结果进行展示</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_23-00-46.jpg"></p><h2 id="五、效果评价部分"><a href="#五、效果评价部分" class="headerlink" title="五、效果评价部分"></a>五、效果评价部分</h2><p>对于网络<code>network.dat</code>，它的实际社区分布保存在<code>community.dat</code>中，我们的社区发现算法结果都保存在<code>txt</code>文件中，利用上述文件计算两种算法的NMI指数：</p><h3 id="GN算法-1"><a href="#GN算法-1" class="headerlink" title="GN算法"></a>GN算法</h3><p>运行结果如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_21-58-51.jpg"></p><h3 id="Louvain算法-1"><a href="#Louvain算法-1" class="headerlink" title="Louvain算法"></a>Louvain算法</h3><p>运行结果如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-23_22-00-01.jpg"></p><h3 id="简要分析"><a href="#简要分析" class="headerlink" title="简要分析"></a>简要分析</h3><p>可以看出：两种算法的NMI指数都很高，说明两种社区发现算法的准确率都很高，与实际情况较为相符。其中GN算法的NMI指数略高于Louvain算法的NMI指数，可能的原因如下：</p><p>Louvain算法是基于模块度的社区发现算法，模块度也可以作为社区发现的评价指标，不过模块度主要是用于不知道真实社区分布情况下的评价指标（类似于无监督学习评价指标），而NMI指数主要用于已知真实情况下的评价。Louvain可能是过于侧重模块度的优化，注重的方面是社区更集中，而不是跟真实情况更相近，所以可能导致算法的准确率未达到90%，而GN算法考虑网络全局，准确率就较高。</p><h2 id="六、算法复杂度分析"><a href="#六、算法复杂度分析" class="headerlink" title="六、算法复杂度分析"></a>六、算法复杂度分析</h2><h3 id="GN算法-2"><a href="#GN算法-2" class="headerlink" title="GN算法"></a>GN算法</h3><ul><li><p>GN算法计算边界数的时间复杂度为$\mathcal{O}(m\times n)$，其中m为边数，n为节点数。</p></li><li><p>总时间复杂度在m条边和n个节点的网络下为 $\mathcal{O}(m^2n)$。</p></li></ul><h3 id="Louvain算法-2"><a href="#Louvain算法-2" class="headerlink" title="Louvain算法"></a>Louvain算法</h3><ul><li><p>在Louvain算法的第一步中，扫描所有节点并将其加入能带来最高模块度收益的邻居节点所在的社区，每一次迭代的时间复杂度为$\mathcal{O}(n)$，其中的n为输入数据中的边的数量；</p></li><li><p>在第二步中完美将第一步形成的社区进行折叠，把每个社区看成一个超结点进行下一步的边权重计算，将结果用于下一次迭代的步骤一，每一次迭代中，步骤二的复杂度为$\mathcal{O}(m+n)$，m为本轮迭代中超结点的个数。</p></li></ul><h2 id="七、算法评价"><a href="#七、算法评价" class="headerlink" title="七、算法评价"></a>七、算法评价</h2><h3 id="GN算法-3"><a href="#GN算法-3" class="headerlink" title="GN算法"></a>GN算法</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul><li>GN算法每次迭代删去最大边介数所在的边时，都在考虑网络全局，所以划分社区的准确率很高</li></ul><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul><li>因为每次迭代都要考虑整个网络，所以时间复杂度较高</li><li>对网络社区结构缺少量的定义，得事先知道社区的个数</li></ul><h3 id="Louvain算法-3"><a href="#Louvain算法-3" class="headerlink" title="Louvain算法"></a>Louvain算法</h3><h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ul><li>简单、易于理解</li><li>非监督</li><li>时间复杂度低，运算速度很快，是最快的模块化算法之一</li></ul><h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul><li>它会将较小的社区合并为较大的社区</li><li>当存在具有类似模块性的多个候选分区时，可能会出现平台，形成局部最大值并阻止进展</li></ul><h2 id="八、代码展示"><a href="#八、代码展示" class="headerlink" title="八、代码展示"></a>八、代码展示</h2><h3 id="GN算法-4"><a href="#GN算法-4" class="headerlink" title="GN算法"></a>GN算法</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">def</span> <span class="token function">load_graph</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    g <span class="token operator">=</span> nx<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            nodex<span class="token punctuation">,</span> nodey <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 因为我们是无权图，所以这里将所有的边权重设为1.0</span>            g<span class="token punctuation">.</span>add_edge<span class="token punctuation">(</span>nodex<span class="token punctuation">,</span> nodey<span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> g<span class="token comment" spellcheck="true"># 移除边界数最大的边</span><span class="token keyword">def</span> <span class="token function">removing_based_on_betweeness</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">:</span>    init_ncomp <span class="token operator">=</span> nx<span class="token punctuation">.</span>number_connected_components<span class="token punctuation">(</span>g<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 连通图的数量</span>    curr_ncomp <span class="token operator">=</span> init_ncomp    <span class="token keyword">while</span> curr_ncomp <span class="token operator">&lt;=</span> init_ncomp<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 因为我们删除边界数大的边就是为了不连通  </span>        <span class="token comment" spellcheck="true"># 所以只要边界数大的边删除后，连通数量大于原来的数量就停止</span>        bws <span class="token operator">=</span> nx<span class="token punctuation">.</span>edge_betweenness_centrality<span class="token punctuation">(</span>g<span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'weight'</span><span class="token punctuation">)</span>         max_bw <span class="token operator">=</span> max<span class="token punctuation">(</span>bws<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> nodes<span class="token punctuation">,</span> bw <span class="token keyword">in</span> bws<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> bw <span class="token operator">==</span> max_bw<span class="token punctuation">:</span>                g<span class="token punctuation">.</span>remove_edge<span class="token punctuation">(</span><span class="token operator">*</span>nodes<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 相当于删除当前边界数大的边</span>        curr_ncomp <span class="token operator">=</span> nx<span class="token punctuation">.</span>number_connected_components<span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 更新连通数量</span><span class="token keyword">def</span> <span class="token function">get_deg</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 统计每个队和别人打的次数</span>    adj <span class="token operator">=</span> nx<span class="token punctuation">.</span>adj_matrix<span class="token punctuation">(</span>g<span class="token punctuation">)</span>    nodes <span class="token operator">=</span> g<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span>    t <span class="token operator">=</span> adj<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>     <span class="token keyword">return</span> <span class="token punctuation">{</span>node<span class="token punctuation">:</span> t<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> node <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">get_modularity</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> init_deg<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>    deg <span class="token operator">=</span> get_deg<span class="token punctuation">(</span>g<span class="token punctuation">)</span>    modularity <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> comp <span class="token keyword">in</span> nx<span class="token punctuation">.</span>connected_components<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> node <span class="token keyword">in</span> comp<span class="token punctuation">:</span>            modularity <span class="token operator">+=</span> <span class="token punctuation">(</span>deg<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">-</span> init_deg<span class="token punctuation">[</span>node<span class="token punctuation">]</span> \                <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> modularity <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> m<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">gn</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">:</span>    init_n <span class="token operator">=</span> g<span class="token punctuation">.</span>number_of_edges<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"总共的边数(相当于两两比赛的总次数):"</span><span class="token punctuation">,</span> init_n<span class="token punctuation">)</span>        <span class="token keyword">if</span> init_n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> None    <span class="token comment" spellcheck="true"># 简单的一个预处理</span>    m <span class="token operator">=</span> nx<span class="token punctuation">.</span>adj_matrix<span class="token punctuation">(</span>g<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 按第一列从小到大 整理我们的数据</span>    m <span class="token operator">=</span> m<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>  <span class="token comment" spellcheck="true"># 总的比赛数</span>    init_deg <span class="token operator">=</span> get_deg<span class="token punctuation">(</span>g<span class="token punctuation">)</span>    i <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> g<span class="token punctuation">.</span>number_of_edges<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">420</span><span class="token punctuation">:</span>        removing_based_on_betweeness<span class="token punctuation">(</span>g<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 迭代5次计算一下模块度</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代次数:{} 模块度的值:{} 边数:{}"</span><span class="token punctuation">.</span>format\                <span class="token punctuation">(</span>i<span class="token punctuation">,</span> get_modularity<span class="token punctuation">(</span>g<span class="token punctuation">,</span> init_deg<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> \                    g<span class="token punctuation">.</span>number_of_edges<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"模块度最大: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>get_modularity<span class="token punctuation">(</span>g<span class="token punctuation">,</span> \        init_deg<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 社团中止时的图</span>    nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>g<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">"gn_2.jpg"</span><span class="token punctuation">,</span>dpi <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nx<span class="token punctuation">.</span>connected_components<span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1. 加载数据</span>    graph <span class="token operator">=</span> load_graph<span class="token punctuation">(</span><span class="token string">"data/network.dat"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 2. 画出我们的网络结构图</span>    nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>graph<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">"gn_1.jpg"</span><span class="token punctuation">,</span>dpi <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 进行社团检测</span>    set_list <span class="token operator">=</span> gn<span class="token punctuation">(</span>graph<span class="token punctuation">)</span>    total <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> temp <span class="token keyword">in</span> set_list<span class="token punctuation">:</span>        total<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 4.写入文件  这种写入文件的数据与标签文件的样子</span>    <span class="token comment" spellcheck="true"># 相同  但是我们检测预测的准确率</span>    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> temp <span class="token keyword">in</span> total<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> temp<span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> total<span class="token punctuation">.</span>index<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./data/predict.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> r <span class="token keyword">in</span> result<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\t'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="Louvain算法-4"><a href="#Louvain算法-4" class="headerlink" title="Louvain算法"></a>Louvain算法</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> collections<span class="token keyword">import</span> random<span class="token keyword">import</span> networkx <span class="token keyword">as</span> nx<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">def</span> <span class="token function">load_graph</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    G <span class="token operator">=</span> collections<span class="token punctuation">.</span>defaultdict<span class="token punctuation">(</span>dict<span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> text<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> text<span class="token punctuation">:</span>            vertices <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>            v_i <span class="token operator">=</span> int<span class="token punctuation">(</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            v_j <span class="token operator">=</span> int<span class="token punctuation">(</span>vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># w = float(vertices[2])</span>            G<span class="token punctuation">[</span>v_i<span class="token punctuation">]</span><span class="token punctuation">[</span>v_j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">return</span> G<span class="token keyword">class</span> <span class="token class-name">Vertex</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vid<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> k_in<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_vid <span class="token operator">=</span> vid        self<span class="token punctuation">.</span>_cid <span class="token operator">=</span> cid        self<span class="token punctuation">.</span>_nodes <span class="token operator">=</span> nodes        self<span class="token punctuation">.</span>_kin <span class="token operator">=</span> k_in  <span class="token comment" spellcheck="true"># 结点内部的边的权重</span><span class="token keyword">class</span> <span class="token class-name">Louvain</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> G<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_G <span class="token operator">=</span> G        self<span class="token punctuation">.</span>_m <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment" spellcheck="true"># 边数量</span>        <span class="token comment" spellcheck="true"># 需维护的关于社区的信息(社区编号,其中包含的结点编号的集合)</span>        self<span class="token punctuation">.</span>_cid_vertices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>          <span class="token comment" spellcheck="true"># 需维护的关于结点的信息(结点编号，相应的Vertex实例)</span>        self<span class="token punctuation">.</span>_vid_vertex <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>          <span class="token keyword">for</span> vid <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">[</span>vid<span class="token punctuation">]</span> <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>vid<span class="token punctuation">]</span> <span class="token operator">=</span> Vertex<span class="token punctuation">(</span>vid<span class="token punctuation">,</span> vid<span class="token punctuation">,</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>_m <span class="token operator">+=</span> sum<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token keyword">for</span> neighbor <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span> \                <span class="token keyword">if</span> neighbor <span class="token operator">></span> vid<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">first_stage</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        mod_inc <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment" spellcheck="true"># 用于判断算法是否可终止</span>        visit_sequence <span class="token operator">=</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>        random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>list<span class="token punctuation">(</span>visit_sequence<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            can_stop <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment" spellcheck="true"># 第一阶段是否可终止</span>            <span class="token keyword">for</span> v_vid <span class="token keyword">in</span> visit_sequence<span class="token punctuation">:</span>                v_cid <span class="token operator">=</span> self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_cid                k_v <span class="token operator">=</span> sum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> \                    self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_kin                cid_Q <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token keyword">for</span> w_vid <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    w_cid <span class="token operator">=</span> self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>w_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_cid                    <span class="token keyword">if</span> w_cid <span class="token keyword">in</span> cid_Q<span class="token punctuation">:</span>                        <span class="token keyword">continue</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        tot <span class="token operator">=</span> sum<span class="token punctuation">(</span>                            <span class="token punctuation">[</span>sum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> \                                self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>_kin <span class="token keyword">for</span> \                                    k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">[</span>w_cid<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                        <span class="token keyword">if</span> w_cid <span class="token operator">==</span> v_cid<span class="token punctuation">:</span>                            tot <span class="token operator">-=</span> k_v                        k_v_in <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token punctuation">[</span>v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span>\                            <span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">[</span>w_cid<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                        delta_Q <span class="token operator">=</span> k_v_in <span class="token operator">-</span> k_v <span class="token operator">*</span> tot <span class="token operator">/</span> self<span class="token punctuation">.</span>_m  <span class="token comment" spellcheck="true"># 由于只需要知道delta_Q的正负，所以少乘了1/(2*self._m)</span>                        cid_Q<span class="token punctuation">[</span>w_cid<span class="token punctuation">]</span> <span class="token operator">=</span> delta_Q                cid<span class="token punctuation">,</span> max_delta_Q <span class="token operator">=</span> sorted<span class="token punctuation">(</span>cid_Q<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>\                    <span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                <span class="token keyword">if</span> max_delta_Q <span class="token operator">></span> <span class="token number">0.0</span> <span class="token operator">and</span> cid <span class="token operator">!=</span> v_cid<span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>v_vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_cid <span class="token operator">=</span> cid                    self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">[</span>cid<span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span>v_vid<span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">[</span>v_cid<span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>v_vid<span class="token punctuation">)</span>                    can_stop <span class="token operator">=</span> <span class="token boolean">False</span>                    mod_inc <span class="token operator">=</span> <span class="token boolean">True</span>            <span class="token keyword">if</span> can_stop<span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">return</span> mod_inc    <span class="token keyword">def</span> <span class="token function">second_stage</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        cid_vertices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        vid_vertex <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token keyword">for</span> cid<span class="token punctuation">,</span> vertices <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> len<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            new_vertex <span class="token operator">=</span> Vertex<span class="token punctuation">(</span>cid<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> vid <span class="token keyword">in</span> vertices<span class="token punctuation">:</span>                new_vertex<span class="token punctuation">.</span>_nodes<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_nodes<span class="token punctuation">)</span>                new_vertex<span class="token punctuation">.</span>_kin <span class="token operator">+=</span> self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_kin                <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> k <span class="token keyword">in</span> vertices<span class="token punctuation">:</span>                        new_vertex<span class="token punctuation">.</span>_kin <span class="token operator">+=</span> v <span class="token operator">/</span> <span class="token number">2.0</span>            cid_vertices<span class="token punctuation">[</span>cid<span class="token punctuation">]</span> <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span>cid<span class="token punctuation">]</span><span class="token punctuation">)</span>            vid_vertex<span class="token punctuation">[</span>cid<span class="token punctuation">]</span> <span class="token operator">=</span> new_vertex        G <span class="token operator">=</span> collections<span class="token punctuation">.</span>defaultdict<span class="token punctuation">(</span>dict<span class="token punctuation">)</span>        <span class="token keyword">for</span> cid1<span class="token punctuation">,</span> vertices1 <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> len<span class="token punctuation">(</span>vertices1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">for</span> cid2<span class="token punctuation">,</span> vertices2 <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> cid2 <span class="token operator">&lt;=</span> cid1 <span class="token operator">or</span> len<span class="token punctuation">(</span>vertices2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                edge_weight <span class="token operator">=</span> <span class="token number">0.0</span>                <span class="token keyword">for</span> vid <span class="token keyword">in</span> vertices1<span class="token punctuation">:</span>                    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>_G<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">if</span> k <span class="token keyword">in</span> vertices2<span class="token punctuation">:</span>                            edge_weight <span class="token operator">+=</span> v                <span class="token keyword">if</span> edge_weight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>                    G<span class="token punctuation">[</span>cid1<span class="token punctuation">]</span><span class="token punctuation">[</span>cid2<span class="token punctuation">]</span> <span class="token operator">=</span> edge_weight                    G<span class="token punctuation">[</span>cid2<span class="token punctuation">]</span><span class="token punctuation">[</span>cid1<span class="token punctuation">]</span> <span class="token operator">=</span> edge_weight        self<span class="token punctuation">.</span>_cid_vertices <span class="token operator">=</span> cid_vertices        self<span class="token punctuation">.</span>_vid_vertex <span class="token operator">=</span> vid_vertex        self<span class="token punctuation">.</span>_G <span class="token operator">=</span> G    <span class="token keyword">def</span> <span class="token function">get_communities</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        communities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> vertices <span class="token keyword">in</span> self<span class="token punctuation">.</span>_cid_vertices<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> len<span class="token punctuation">(</span>vertices<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>                c <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> vid <span class="token keyword">in</span> vertices<span class="token punctuation">:</span>                    c<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_vid_vertex<span class="token punctuation">[</span>vid<span class="token punctuation">]</span><span class="token punctuation">.</span>_nodes<span class="token punctuation">)</span>                communities<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>        <span class="token keyword">return</span> communities    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        iter_time <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            iter_time <span class="token operator">+=</span> <span class="token number">1</span>            mod_inc <span class="token operator">=</span> self<span class="token punctuation">.</span>first_stage<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> mod_inc<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>second_stage<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_communities<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">load</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    g <span class="token operator">=</span> nx<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            nodex<span class="token punctuation">,</span> nodey <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 因为我们是无权图，所以这里将所有的边权重设为1.0</span>            g<span class="token punctuation">.</span>add_edge<span class="token punctuation">(</span>nodex<span class="token punctuation">,</span> nodey<span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> g<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    G <span class="token operator">=</span> load_graph<span class="token punctuation">(</span><span class="token string">'./data/network.dat'</span><span class="token punctuation">)</span>    algorithm <span class="token operator">=</span> Louvain<span class="token punctuation">(</span>G<span class="token punctuation">)</span>    communities <span class="token operator">=</span> algorithm<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 按照社区大小从大到小排序输出</span>    communities <span class="token operator">=</span> sorted<span class="token punctuation">(</span>communities<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> b<span class="token punctuation">:</span> <span class="token operator">-</span>len<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 按社区大小排序</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>    total <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> temp <span class="token keyword">in</span> communities<span class="token punctuation">:</span>        total<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 4.写入文件  这种写入文件的数据与标签文件的样子相同  但是我们检测预测的准确率</span>    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> temp <span class="token keyword">in</span> total<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> temp<span class="token punctuation">:</span>            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> total<span class="token punctuation">.</span>index<span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'./data/Louvain_predict.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> r <span class="token keyword">in</span> result<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\t'</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>str<span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    graph <span class="token operator">=</span> load<span class="token punctuation">(</span><span class="token string">"./data/Louvain_predict.txt"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 5. 画出我们的网络结构图</span>    nx<span class="token punctuation">.</span>draw_networkx<span class="token punctuation">(</span>graph<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="计算NMI指数"><a href="#计算NMI指数" class="headerlink" title="计算NMI指数"></a>计算NMI指数</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> math<span class="token keyword">def</span> <span class="token function">NMI</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 社团检测评估算法 NMI 基于归一化互信息向量的匹配方法</span>    <span class="token comment" spellcheck="true"># 1. len(A) 应该等于 len(B)</span>    total <span class="token operator">=</span> len<span class="token punctuation">(</span>A<span class="token punctuation">)</span>    A_ids <span class="token operator">=</span> set<span class="token punctuation">(</span>A<span class="token punctuation">)</span>    B_ids <span class="token operator">=</span> set<span class="token punctuation">(</span>B<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 2. 互信息</span>    MI <span class="token operator">=</span> <span class="token number">0</span>    eps <span class="token operator">=</span> <span class="token number">1.4e-45</span>    <span class="token keyword">for</span> idA <span class="token keyword">in</span> A_ids<span class="token punctuation">:</span>        <span class="token keyword">for</span> idB <span class="token keyword">in</span> B_ids<span class="token punctuation">:</span>            idAOccur <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>A <span class="token operator">==</span> idA<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 找出A 在A_ids中的编号</span>            idBOccur <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>B <span class="token operator">==</span> idB<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 找出B 在B_ids中的编号</span>            idABOccur <span class="token operator">=</span> np<span class="token punctuation">.</span>intersect1d<span class="token punctuation">(</span>idAOccur<span class="token punctuation">,</span> idBOccur<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 返回两个数组中相同值的个数</span>            px <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>idAOccur<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> total   <span class="token comment" spellcheck="true"># 每种类别所占比例</span>            py <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>idBOccur<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> total   <span class="token comment" spellcheck="true"># 每种类别所占比例</span>            pxy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>idABOccur<span class="token punctuation">)</span> <span class="token operator">/</span> total   <span class="token comment" spellcheck="true"># 两种类别直接的联合概率</span>            MI <span class="token operator">=</span> MI <span class="token operator">+</span> pxy <span class="token operator">*</span> math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>pxy <span class="token operator">/</span> <span class="token punctuation">(</span>px<span class="token operator">*</span>py<span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3.归一化互信息</span>    Hx <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> idA <span class="token keyword">in</span> A_ids<span class="token punctuation">:</span>        idAOccurCount <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>A <span class="token operator">==</span> idA<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        Hx <span class="token operator">=</span> Hx <span class="token operator">-</span> <span class="token punctuation">(</span>idAOccurCount <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>idAOccurCount <span class="token operator">/</span> total <span class="token operator">+</span> eps<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>    Hy <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> idB <span class="token keyword">in</span> B_ids<span class="token punctuation">:</span>        idBOccurCount <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>B <span class="token operator">==</span> idB<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        Hy <span class="token operator">=</span> Hy <span class="token operator">-</span> <span class="token punctuation">(</span>idBOccurCount <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>log<span class="token punctuation">(</span>idBOccurCount <span class="token operator">/</span> total <span class="token operator">+</span> eps<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>    MIhat <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> MI <span class="token operator">/</span> <span class="token punctuation">(</span>Hx <span class="token operator">+</span> Hy<span class="token punctuation">)</span>    <span class="token keyword">return</span> MIhat<span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            g<span class="token punctuation">,</span> t <span class="token operator">=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>            data<span class="token punctuation">[</span>g<span class="token punctuation">]</span> <span class="token operator">=</span> t    <span class="token keyword">return</span> data<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    path_real <span class="token operator">=</span> <span class="token string">'./data/community.dat'</span>    path_predict <span class="token operator">=</span> <span class="token string">'./data/Louvain_predict.txt'</span>    data_real <span class="token operator">=</span> load_data<span class="token punctuation">(</span>path_real<span class="token punctuation">)</span>    data_predict <span class="token operator">=</span> load_data<span class="token punctuation">(</span>path_predict<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print("真实数据:", data_real)</span>    <span class="token comment" spellcheck="true"># print("预测数据:", data_predict)</span>    <span class="token comment" spellcheck="true"># print(len(data_real))</span>    <span class="token comment" spellcheck="true"># print(len(data_predict))</span>    real<span class="token punctuation">,</span> predict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span>        real<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data_real<span class="token punctuation">.</span>get<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        predict<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data_predict<span class="token punctuation">.</span>get<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    real <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>real<span class="token punctuation">)</span>    predict <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>predict<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Louvain算法准确率:\n"</span><span class="token punctuation">,</span> NMI<span class="token punctuation">(</span>real<span class="token punctuation">,</span> predict<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> 社区发现 </tag>
            
            <tag> python </tag>
            
            <tag> 大作业 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>专家控制系统</title>
      <link href="pid/"/>
      <url>pid/</url>
      
        <content type="html"><![CDATA[<h2 id="题目简述"><a href="#题目简述" class="headerlink" title="题目简述"></a>题目简述</h2><p>控制一个三阶传递函数的阶跃响应，采样周期为1ms，传递函数如下：<br>$$<br>G(s)=\frac{523500}{s^3+87.35s^2+1047s}<br>$$</p><ol><li>编程实现上述系统的单位阶跃响应，并画出波形图</li><li>编程实现用传统PID对上述系统进行校正，要求设置10组参数，给出结果图</li><li>编程实现用专家PID对上述系统进行校正，给出结果图</li></ol><h2 id="理论知识"><a href="#理论知识" class="headerlink" title="理论知识"></a>理论知识</h2><h3 id="传统PID校正"><a href="#传统PID校正" class="headerlink" title="传统PID校正"></a>传统PID校正</h3><p>加入了反馈后的PID控制：<br>$$<br>e_{ss}=\lim_{t\to \infty}e(t)=\lim_{s\to 0}sE(s)=\lim_{s\to 0}\frac{sR(s)}{1+PID(s)\times G(s)}<br>$$<br>其中$PID(s)$是$PID$的传递函数，$R(s)$是输入，当$sE(s)$在收敛域内时，一般来说可以看到当信号稳定后，误差$e$是趋近于0的。</p><h3 id="专家PID校正"><a href="#专家PID校正" class="headerlink" title="专家PID校正"></a>专家PID校正</h3><p>首先先将连续信号离散化，专家控制系统有5大规则：</p><ul><li><p>$|e(k)|&gt;M_1$，此时控制输出信号为常数，相当于进行开环控制。</p></li><li><p>$e(k)\Delta e(k)&gt;0$或者$\Delta e(k)=0$</p><ul><li><p>$|e(k)|&gt;M_1$，此时控制PID输出为：<br>$$<br>u(k)=u(k-1)+k_1{k_p[e(k)-e(k-1)]+k_ie(k)+k_d[e(k)-2e(k-1)+e(k-2)]}<br>$$</p></li><li><p>$|e(k)|&lt;M_2$，此时控制PID输出为：<br>$$<br>u(k)=u(k-1)+k_p[e(k)-e(k-1)]+k_ie(k)+k_d[e(k)-2e(k-1)+e(k-2)]<br>$$</p></li></ul></li><li><p>$e(k)\Delta e(k)&lt;0$，$\Delta e(k)\Delta e(k-1)&gt;0$或者$\Delta e(k)=0$,此时控制PID输出如下：<br>$$<br>u(k)=u(k-1)<br>$$</p></li><li><p>$e(k)\Delta e(k)&lt;0$，$\Delta e(k)\Delta e(k-1)&lt;0$</p><ul><li><p>$|e(k)|&gt;M_2$，此时控制PID输出为：<br>$$<br>u(k)=u(k-1)+k_{1}k_{p}e(k)<br>$$</p></li><li><p>$|e(k)|&lt;M_2$，此时控制PID输出为：<br>$$<br>u(k)=u(k-1)+k_{2}k_{p}e(k)<br>$$</p></li></ul></li><li><p>$|e(k)&lt;\epsilon|$，此时采用PI控制，输出为：<br>$$<br>u(k)=u(k-1)+k_p[e(k)-e(k-1)]+k_ie(k)<br>$$</p></li></ul><h2 id="问题求解"><a href="#问题求解" class="headerlink" title="问题求解"></a>问题求解</h2><h3 id="求解单位阶跃响应"><a href="#求解单位阶跃响应" class="headerlink" title="求解单位阶跃响应"></a>求解单位阶跃响应</h3><p>由于所求阶跃响应是时域响应，所以需要将s域的响应变换到时域，基本思路如下：</p><ol><li><p>先利用式子<br>$$<br>Y(s)=G(s)\times{\frac{1}{s}}<br>$$<br>求出该系统在输入为单位阶跃信号时s域的响应</p></li><li><p>再利用<code>matlab</code>中的<code>ilaplace</code>函数将响应$Y(s)$变换到时域，即可求得该系统的单位阶跃响应</p></li></ol><p>代码如下：</p><pre class=" language-matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>clc<span class="token punctuation">;</span>syms s t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 传递函数</span>G<span class="token operator">=</span><span class="token number">523500</span><span class="token operator">/</span><span class="token punctuation">(</span>s<span class="token operator">^</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">87.35</span><span class="token operator">*</span>s<span class="token operator">^</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">10470</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 传递函数乘以1/s得到s域的阶跃响应</span>Y<span class="token operator">=</span>G<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 阶跃响应变换到时域</span>y_t<span class="token operator">=</span><span class="token function">ilaplace</span><span class="token punctuation">(</span>Y<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">disp</span><span class="token punctuation">(</span>y_t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>将得到的时域的$y(t)$写成函数形式，以便于画图调用：</p><pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%%%将y_t函数改写成如下的函数</span><span class="token keyword">function</span> fval<span class="token operator">=</span><span class="token function">y</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">%%%%求时域下的阶跃响应，输入时间求出响应值</span>    <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>        <span class="token function">fval</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">50</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1747</span><span class="token operator">*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">1747</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token operator">*</span>          <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">5323991</span><span class="token operator">*</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">23933884277</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4188</span> <span class="token operator">-</span> <span class="token number">1747</span><span class="token operator">/</span><span class="token number">4188</span><span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span></code></pre><p>设置采样间隔为1ms，持续时间为0.5s，画出波形图：</p><pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%%%画图</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.001</span><span class="token operator">:</span><span class="token number">0.5</span><span class="token punctuation">;</span><span class="token function">figure</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token function">xlabel</span><span class="token punctuation">(</span>"时间<span class="token operator">/</span>s"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span>"阶跃响应值"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">title</span><span class="token punctuation">(</span>"系统<span class="token function">G</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>的阶跃响应图"<span class="token punctuation">)</span></code></pre><p>得到的波形图如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/%E5%8D%95%E4%BD%8D%E9%98%B6%E8%B7%83%E5%93%8D%E5%BA%94%E5%9B%BE.jpg"></p><h3 id="传统PID控制校正"><a href="#传统PID控制校正" class="headerlink" title="传统PID控制校正"></a>传统PID控制校正</h3><h4 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h4><p>选取不同的PID参数，画出图像，效果如下：</p><center class="half">    <img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1.jpg" width="300"/><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/2.jpg" width="300"/></center><center class="half">    <img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/3.jpg" width="300"/><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/4.jpg" width="300"/></center><center class="half">    <img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/5.jpg" width="300"/><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/6.jpg" width="300"/></center><center class="half">    <img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/7.jpg" width="300"/><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/8.jpg" width="300"/></center><center class="half">    <img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/9.jpg" width="300"/><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/10.jpg" width="300"/></center><h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><p>从上面的10张图像可以得出一些结论：</p><ul><li>如果kp很大，输出曲线会出现振荡的情况，见图（1）（3）（4）（5）</li><li>如果kp很小，输出曲线回收敛得很慢，见图（9）</li><li>如果kp适中，那么收敛速度会较快，也不会出现很强烈的振荡现象，见图（6）（7）（10）</li><li>如果ki很大，输出曲线的最大值会超过1，ki太小输出曲线最大值回小于1，见图（8）（9）</li><li>如果kd很大，输出曲线会出现值变得很大的情况，见图（2）</li></ul><p>综上：当三个参数都选取恰当时，会使输出曲线像一个一阶系统，见图（6）（10）</p><h3 id="专家PID控制校正"><a href="#专家PID控制校正" class="headerlink" title="专家PID控制校正"></a>专家PID控制校正</h3><p>在传统PID的基础上加上五大规则，即构成了专家PID控制</p><h4 id="结果展示-1"><a href="#结果展示-1" class="headerlink" title="结果展示"></a>结果展示</h4><p>当选取kp、ki、kd三个参数选取合适时，改变五大规则里的参数，比较同一组PID参数下不同规则的结果（由于规则参数较多，在这就不详细说明了），展示如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/20201126220822.jpg"></p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/20201126220903.jpg"></p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/20201126220923.jpg"></p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/20201126221003.jpg"></p><h4 id="结果分析-1"><a href="#结果分析-1" class="headerlink" title="结果分析"></a>结果分析</h4><p>由此可见，在同一组kp、ki、kd参数的条件下，专家PID校正需要一定的专业经验知识才能调参更好</p><h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><h3 id="求阶跃响应"><a href="#求阶跃响应" class="headerlink" title="求阶跃响应"></a>求阶跃响应</h3><pre class=" language-matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>clc<span class="token punctuation">;</span>syms s t<span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 传递函数</span>G<span class="token operator">=</span><span class="token number">523500</span><span class="token operator">/</span><span class="token punctuation">(</span>s<span class="token operator">^</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">87.35</span><span class="token operator">*</span>s<span class="token operator">^</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">10470</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 传递函数乘以1/s得到s域的阶跃响应</span>Y<span class="token operator">=</span>G<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% 阶跃响应变换到时域</span>y_t<span class="token operator">=</span><span class="token function">ilaplace</span><span class="token punctuation">(</span>Y<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">disp</span><span class="token punctuation">(</span>y_t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">%%%画图</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.001</span><span class="token operator">:</span><span class="token number">0.5</span><span class="token punctuation">;</span><span class="token function">figure</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token function">xlabel</span><span class="token punctuation">(</span>"时间<span class="token operator">/</span>s"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span>"阶跃响应值"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">title</span><span class="token punctuation">(</span>"系统<span class="token function">G</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>的阶跃响应图"<span class="token punctuation">)</span><span class="token comment" spellcheck="true">%%%将a中的函数改写成如下的时域函数</span><span class="token keyword">function</span> fval<span class="token operator">=</span><span class="token function">y</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">%%%%求时域下的阶跃响应，输入时间求出响应值</span>    <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>        <span class="token function">fval</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">50</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1747</span><span class="token operator">*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">1747</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">5323991</span><span class="token operator">*</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13699991</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">23933884277</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4188</span> <span class="token operator">-</span> <span class="token number">1747</span><span class="token operator">/</span><span class="token number">4188</span><span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span></code></pre><h3 id="传统PID"><a href="#传统PID" class="headerlink" title="传统PID"></a>传统PID</h3><pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%%传统PID控制</span>clear<span class="token punctuation">;</span>clc<span class="token punctuation">;</span>ts <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%采样时间</span>sys <span class="token operator">=</span> <span class="token function">tf</span><span class="token punctuation">(</span><span class="token number">5.235e005</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">87.35</span><span class="token punctuation">,</span><span class="token number">1.047e004</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%传递函数</span>dsys <span class="token operator">=</span> <span class="token function">c2d</span><span class="token punctuation">(</span>sys<span class="token punctuation">,</span>ts<span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%连续模型离散化</span><span class="token punctuation">[</span>num<span class="token punctuation">,</span>den<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">tfdata</span><span class="token punctuation">(</span>dsys<span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%获得分子分母</span>u_1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>u_2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>u_3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">'</span><span class="token punctuation">;</span>x2_1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">%比例积分微分参数</span>kp <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>ki <span class="token operator">=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>kd <span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">;</span>error_1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">500</span> <span class="token comment" spellcheck="true">%运行时间0.5s</span>    <span class="token function">time</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>k<span class="token operator">*</span>ts<span class="token punctuation">;</span>    <span class="token function">r</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%第k次控制器输出</span>    <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> kp<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>kd<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> ki<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">%线性变换 Z变换</span>    <span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>y_1<span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span>y_2<span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>y_3<span class="token operator">+</span><span class="token punctuation">...</span>        <span class="token function">num</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>u_1<span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span>u_2<span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>u_3<span class="token punctuation">;</span>    <span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">%Return of parameter</span>    u_3<span class="token operator">=</span>u_2<span class="token punctuation">;</span>u_2<span class="token operator">=</span>u_1<span class="token punctuation">;</span>u_1<span class="token operator">=</span><span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    y_3<span class="token operator">=</span>y_2<span class="token punctuation">;</span>y_2<span class="token operator">=</span>y_1<span class="token punctuation">;</span>y_1<span class="token operator">=</span><span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算P</span>    x2_1<span class="token operator">=</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span>error_1<span class="token punctuation">)</span><span class="token operator">/</span>ts<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算D</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">*</span>ts<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算 I</span>    error_1<span class="token operator">=</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plot</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span>r<span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span>time<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'时间(s)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'输出'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>grid on<span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'传统PID控制阶跃响应曲线'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'kp='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>kp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">',ki='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>ki<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">...</span>    <span class="token string">',kd='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>kd<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">% figure(2);</span><span class="token comment" spellcheck="true">% plot(time,r-y,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% xlabel(</span><span class="token string">'times(s)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% grid on</span><span class="token comment" spellcheck="true">% title(</span><span class="token string">'误差响应曲线'</span><span class="token punctuation">)</span></code></pre><h3 id="专家PID"><a href="#专家PID" class="headerlink" title="专家PID"></a>专家PID</h3><p>展示效果最好的那一组专家规则，即第一组规则参数</p><pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%%专家PID控制</span>clear<span class="token punctuation">;</span>clc<span class="token punctuation">;</span>ts <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%采样时间</span>sys <span class="token operator">=</span> <span class="token function">tf</span><span class="token punctuation">(</span><span class="token number">5.235e005</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">87.35</span><span class="token punctuation">,</span><span class="token number">1.047e004</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%传递函数</span>dsys <span class="token operator">=</span> <span class="token function">c2d</span><span class="token punctuation">(</span>sys<span class="token punctuation">,</span>ts<span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%连续模型离散化</span><span class="token punctuation">[</span>num<span class="token punctuation">,</span>den<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">tfdata</span><span class="token punctuation">(</span>dsys<span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%获得分子分母</span>u_1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>u_2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>u_3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>y_3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">'</span><span class="token punctuation">;</span>x2_1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">%比例积分微分参数</span>kp <span class="token operator">=</span> <span class="token number">0.6</span><span class="token punctuation">;</span>ki <span class="token operator">=</span> <span class="token number">0.03</span><span class="token punctuation">;</span>kd <span class="token operator">=</span><span class="token number">0.002</span><span class="token punctuation">;</span>error_1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">500</span> <span class="token comment" spellcheck="true">%运行时间0.5s</span>    <span class="token function">time</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>k<span class="token operator">*</span>ts<span class="token punctuation">;</span>    <span class="token function">r</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%第k次控制器输出</span>    <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> kp<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>kd<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> ki<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">%规则1：控制误差输出的绝对值，避免超调</span>    <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.8</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.45</span><span class="token punctuation">;</span>    <span class="token keyword">elseif</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.4</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.40</span><span class="token punctuation">;</span>    <span class="token keyword">elseif</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.2</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.12</span><span class="token punctuation">;</span>    <span class="token keyword">elseif</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.01</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.10</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token comment" spellcheck="true">%规则2：误差为某一参数，未发生变化</span>    <span class="token keyword">if</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0.05</span>            <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u_1<span class="token operator">+</span> <span class="token number">2</span><span class="token operator">*</span>kp<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u_1<span class="token operator">+</span> <span class="token number">0.4</span><span class="token operator">*</span>kp<span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token comment" spellcheck="true">%规则3：误差的绝对值朝小的方向变化</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>x2_1<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token comment" spellcheck="true">%规则4：误差处于极值状态</span>    <span class="token keyword">if</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>x2_1<span class="token operator">&lt;</span><span class="token number">0</span>        <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0.05</span>            <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u_1<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>kp<span class="token operator">*</span>error_1<span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u_1<span class="token operator">+</span><span class="token number">0.6</span><span class="token operator">*</span>kp<span class="token operator">*</span>error_1<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token comment" spellcheck="true">%规则5：误差的绝对值很小</span>    <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0.001</span> <span class="token comment" spellcheck="true">%Pi控制</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0.5</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.01</span><span class="token operator">*</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token keyword">if</span> <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token operator">-</span><span class="token number">10</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token keyword">if</span> <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">10</span>        <span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token comment" spellcheck="true">%线性变换 Z变换</span>    <span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>y_1<span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span>y_2<span class="token operator">-</span><span class="token function">den</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>y_3<span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>u_1<span class="token operator">+</span><span class="token punctuation">...</span>        <span class="token function">num</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span>u_2<span class="token operator">+</span><span class="token function">num</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span>u_3<span class="token punctuation">;</span>    <span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">%Return of parameter</span>    u_3<span class="token operator">=</span>u_2<span class="token punctuation">;</span>u_2<span class="token operator">=</span>u_1<span class="token punctuation">;</span>u_1<span class="token operator">=</span><span class="token function">u</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    y_3<span class="token operator">=</span>y_2<span class="token punctuation">;</span>y_2<span class="token operator">=</span>y_1<span class="token punctuation">;</span>y_1<span class="token operator">=</span><span class="token function">y</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算P值</span>    x2_1<span class="token operator">=</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span>error_1<span class="token punctuation">)</span><span class="token operator">/</span>ts<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算D值</span>    <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">*</span>ts<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">%计算 I值</span>    error_1<span class="token operator">=</span><span class="token function">error</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>p1<span class="token operator">=</span><span class="token function">plot</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span>r<span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hold on<span class="token punctuation">;</span>p2<span class="token operator">=</span><span class="token function">plot</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'时间(s)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'输出'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>grid on<span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'专家PID控制阶跃响应曲线'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'kp='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>kp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">',ki='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>ki<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">...</span>    <span class="token string">',kd='</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>kd<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>hold on<span class="token punctuation">;</span>p3<span class="token operator">=</span><span class="token function">plot</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span>r<span class="token operator">-</span>y<span class="token punctuation">,</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'linewidth'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'输出值'</span><span class="token punctuation">,</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token string">'location'</span><span class="token punctuation">,</span><span class="token string">'best'</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 大作业 </tag>
            
            <tag> PID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——pandas（1）</title>
      <link href="pandas-1/"/>
      <url>pandas-1/</url>
      
        <content type="html"><![CDATA[<p>如果利用python数据分析，基本上都会用到numpy和pandas这两货，前面学了一点numpy，现在慢慢写点pandas的学习笔记</p><h2 id="numpy和pandas有啥区别"><a href="#numpy和pandas有啥区别" class="headerlink" title="numpy和pandas有啥区别"></a>numpy和pandas有啥区别</h2><p>emmm。。。。以我现在这个初学者的角度来看，numpy处理的对象主要是数字，主要用于矩阵运算，底层是c，运算速度蛮不错；而pandas处理的内容可以是很多种，而且一个DataFrame里边还能有不同类型的元素，但运算方面就没有numpy那么猛了。其实我觉得二者不适合拿来对比，各有各的专长，至于我为什么要写，嗯是因为我想凑点字数😂😂。</p><h2 id="安装pandas"><a href="#安装pandas" class="headerlink" title="安装pandas"></a>安装pandas</h2><p>安装直接<code>pip install pandas</code>即可，已安装显示如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-18_19-30-36.jpg"></p><p>还是可以用打印版本号的方法检查是否安装成功：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token operator">>></span><span class="token operator">></span> pd<span class="token punctuation">.</span>__version__<span class="token comment" spellcheck="true">## '0.25.1'</span></code></pre><h2 id="两个常用的类"><a href="#两个常用的类" class="headerlink" title="两个常用的类"></a>两个常用的类</h2><p>pandas里有两个常用的工具数据结构：Series和DataFrame。尽管他们并不能解决所有问题，但他们为大多数应用提供了一个有效、易用的基础。在这里先简单介绍一下，后续再做深入的剖析。</p><h3 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h3><p>Series是一种一维的数据对象，它包含了一个值序列（这里的值可以是很多种类型），并且包含了数据标签，称之为索引（index）。其实个人感觉可以参照字典来理解，感觉差不多。</p><h4 id="创建一个简单的Series类"><a href="#创建一个简单的Series类" class="headerlink" title="创建一个简单的Series类"></a>创建一个简单的Series类</h4><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> obj<span class="token number">0</span>    <span class="token number">4</span><span class="token number">1</span>    <span class="token number">5</span><span class="token number">2</span>    <span class="token number">6</span><span class="token number">3</span>    <span class="token number">7</span>dtype<span class="token punctuation">:</span> int64</code></pre><p>可以看到出现了两列内容，左边那一列表示的就是index，右边是values，可以看出如果不指定的话，<code>pd.Series()</code>生成的索引（index）就是从0到N-1（N表示数据的长度）。可以通过调用values属性和index属性分别查看Series对象的内容和索引</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>valuesarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int64<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>indexRangeIndex<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre><p>这里的<code>RangeIndex(start=0, stop=4, step=1)</code>就有点类似于<code>range(0,4,1)</code></p><h4 id="创建一个索引序列"><a href="#创建一个索引序列" class="headerlink" title="创建一个索引序列"></a>创建一个索引序列</h4><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj2<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> obj2a    <span class="token number">1</span>b    <span class="token number">2</span>c    <span class="token number">3</span>d    <span class="token number">4</span>dtype<span class="token punctuation">:</span> int64</code></pre><h4 id="通过字典来创建一个Series"><a href="#通过字典来创建一个Series" class="headerlink" title="通过字典来创建一个Series"></a>通过字典来创建一个Series</h4><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> dic<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Tom'</span><span class="token punctuation">:</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token string">'Lily'</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">'Mike'</span><span class="token punctuation">:</span><span class="token number">66</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> obj3<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>dic<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> obj3Tom     <span class="token number">90</span>Lily    <span class="token number">80</span>Mike    <span class="token number">66</span>dtype<span class="token punctuation">:</span> int64</code></pre><h4 id="选择数据"><a href="#选择数据" class="headerlink" title="选择数据"></a>选择数据</h4><p>选择数据时可以使用标签来进行索引，也可以对选择到的value值进行赋新值</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj2<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token number">1</span><span class="token comment" spellcheck="true">## 也可以索引多个值</span><span class="token operator">>></span><span class="token operator">></span> obj2<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>a    <span class="token number">1</span>b    <span class="token number">2</span>d    <span class="token number">4</span>dtype<span class="token punctuation">:</span> int64<span class="token operator">>></span><span class="token operator">></span> obj2<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">5</span><span class="token operator">>></span><span class="token operator">></span> obj2<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token number">5</span></code></pre><h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k-means and FCM</title>
      <link href="k-means-fcm/"/>
      <url>k-means-fcm/</url>
      
        <content type="html"><![CDATA[<h2 id="原理简介"><a href="#原理简介" class="headerlink" title="原理简介"></a>原理简介</h2><h3 id="K-means"><a href="#K-means" class="headerlink" title="K-means"></a>K-means</h3><ol><li>指定需要划分的簇的个数，即K值（类的个数）</li><li>随机的选择K个数据对象作为初始的聚类中心</li><li>计算其余的各个数据对象到这K个聚类中心的距离，把数据对象划分到距离它最近的那个中心所在的簇中</li><li>调整新类并计算出新的聚类中心</li><li>循环第三和第四步，直到聚类中心不再发生变化，聚类结束</li></ol><h3 id="FCM"><a href="#FCM" class="headerlink" title="FCM"></a>FCM</h3><ol><li><p>指定需要划分的类别个数以及柔性参数的值，即c和$\alpha$</p></li><li><p>初始化隶属度矩阵，其中样本数据属于所有类别的隶属度之和应该为1</p><p>$$<br>\sum_{j=1}^{c}u_{ij}=1,\forall{i}=1,…,m<br>$$<br>其中$i$对应样本，$j$对应聚类中心，$u_{ij}$即为隶属度，它是一个位于区间$[0,1]$之间的数，它表示样本$x_i$属于第$j$类的概率为$u_{ij}$</p></li><li><p>根据隶属度矩阵计算新的c个聚类中心，计算公式如下：</p><p>$$<br>z_j=\frac{\sum_{i=1}^{m}u_{ij}^\alpha{x_i}}{\sum_{i=1}^{m}u_{ij}^\alpha}<br>$$<br>其中$x_i$表示一个样本，$z_j$表示一个聚类中心，它是一个向量</p></li><li><p>以<strong>聚类中心不再变化</strong>为终止条件，判断此次迭代是否满足终止条件</p></li><li><p>如果满足终止条件，那么对于每一个样本，将它归类于隶属度最大的那一类</p></li><li><p>如果不满足终止条件，就更新隶属度矩阵$U$，并回到第3步继续迭代，更新公式如下：</p><p>$$<br>u_{ij}=\frac{1}{\sum_{k=1}^{c}(\frac{d_{ij}}{d_{ki}})^{\frac{2}{\alpha-1}}}<br>$$<br>其中$d_{ij}$表示样本$x_i$到聚类中心点$z_j$的欧式距离</p></li></ol><h2 id="评价指标"><a href="#评价指标" class="headerlink" title="评价指标"></a>评价指标</h2><p>由于聚类属于无监督学习，用OA、AA等指标来评价聚类效果可能得不到理想的结果。故在本次作业中，使用<a href="https://baike.baidu.com/item/%E8%BD%AE%E5%BB%93%E7%B3%BB%E6%95%B0/17361607?fr=aladdin" target="_blank" rel="noopener">轮廓系数</a>作为聚类的评价指标。</p><p>轮廓系数取值范围为$[-1,1]$，取值越接近1则说明聚类性能越好，相反，取值越接近-1则说明聚类性能越差，一个样本的轮廓系数计算公式如下：</p><p>$$<br>s_i=\frac{b_i-a_i}{\max{a_i,b_i}}<br>$$<br>其中：</p><ul><li>$a_i$：样本$x_i$与其所在簇内其他样本的平均距离</li><li>$b_i$：样本$x_i$与其他簇内样本的平均距离</li></ul><p>当$b_i$大于$a_i$时，说明样本$x_i$跟同类的样本之间的平均距离小于其与其他类别样本之间的平均距离，令$\Delta_1=b_i-a_i$，$\Delta_1$越大，$s_i$就越接近1，此时样本类间的紧密程度较高，类间的稀疏程度较低，聚类效果就较为理想</p><p>同理当$b_i$小于$a_i$时，说明样本$x_i$跟同类的样本之间的平均距离大于其与其他类别样本之间的平均距离，令$\Delta_2=a_i-b_i$，$\Delta_2$越大，$s_i$就越接近-1，此时样本类间的紧密程度较低，类间的紧密程度甚至高于类内紧密程度，这时聚类效果就比较糟糕</p><p>对于$m$个样本，样本整体的轮廓系数即为各个样本轮廓系数的平均值：</p><p>$$<br>S=\frac{1}{m}\sum_{i=1}^{m}s_i<br>$$</p><h2 id="数据标准化"><a href="#数据标准化" class="headerlink" title="数据标准化"></a>数据标准化</h2><p>由于两数据集中特征的量纲都相同，所以只需要消除量纲，将每个特征的数值除以该特征中的最大值即可，这样就将所有特征数值映射到了区间$[0,1]$内</p><h2 id="类数的选择"><a href="#类数的选择" class="headerlink" title="类数的选择"></a>类数的选择</h2><p>因为我们知道sonar数据集和iris数据集对应的类别数分别为2、3。所以在聚类的过程中将k值和c值取成对应的类别即可</p><h2 id="编程思路"><a href="#编程思路" class="headerlink" title="编程思路"></a>编程思路</h2><h3 id="K-means的实现"><a href="#K-means的实现" class="headerlink" title="K-means的实现"></a>K-means的实现</h3><h4 id="导入数据部分"><a href="#导入数据部分" class="headerlink" title="导入数据部分"></a>导入数据部分</h4><h5 id="iris数据集"><a href="#iris数据集" class="headerlink" title="iris数据集"></a>iris数据集</h5><p>直接从<code>sklearn</code>包中导入即可：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris<span class="token comment" spellcheck="true"># 读取数据</span>data<span class="token operator">=</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 标签</span>target<span class="token operator">=</span>data<span class="token punctuation">.</span>target<span class="token punctuation">.</span>T<span class="token comment" spellcheck="true"># 样本数据</span>data<span class="token operator">=</span>data<span class="token punctuation">.</span>data</code></pre><h5 id="sonar数据集"><a href="#sonar数据集" class="headerlink" title="sonar数据集"></a>sonar数据集</h5><p>从本地的sonar.xlsx导入：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook<span class="token comment" spellcheck="true"># 导入数据</span><span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    传入文件路径，返回样本数据以及标签    """</span>    workbook<span class="token operator">=</span>load_workbook<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(workbook.sheetnames)</span>    sheet<span class="token operator">=</span>workbook<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储样本特征集</span>    sonar<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 存储标签</span>    target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># print(sonar.shape)</span>    <span class="token comment" spellcheck="true"># print(sonar[0,59])</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">==</span><span class="token string">'R'</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token keyword">return</span> sonar<span class="token punctuation">,</span>target</code></pre><h4 id="随机选择聚类中心"><a href="#随机选择聚类中心" class="headerlink" title="随机选择聚类中心"></a>随机选择聚类中心</h4><p>产生k个随机索引即可</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 指定k-means中的k值</span>    k<span class="token operator">=</span><span class="token number">2</span>    <span class="token comment" spellcheck="true"># 随机选择k个聚类中心</span>    flags<span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(flags)</span>    center_points<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>k<span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>        center_points<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>data<span class="token punctuation">[</span>flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        j<span class="token operator">+=</span><span class="token number">1</span></code></pre><h4 id="算法核心的实现"><a href="#算法核心的实现" class="headerlink" title="算法核心的实现"></a>算法核心的实现</h4><p>编写一个类，名称为<code>k-means</code>，它的属性以及方法如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/class.jpg"></p><p>利用python实现的代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 创建一个k-means类</span><span class="token keyword">class</span> <span class="token class-name">K_means</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>data<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>center<span class="token operator">=</span>center_points <span class="token comment" spellcheck="true">#聚类中心点的坐标</span>        self<span class="token punctuation">.</span>k<span class="token operator">=</span>k <span class="token comment" spellcheck="true">#聚类数</span>        self<span class="token punctuation">.</span>data<span class="token operator">=</span>data <span class="token comment" spellcheck="true">#样本</span>        <span class="token comment" spellcheck="true"># dis前k列表示每个样本到各聚类中心的距离，最后一列表示类别</span>        self<span class="token punctuation">.</span>dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># distance方法：计算当前到k个聚类中心的距离，找出最小距离并将每个样本分类</span>    <span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">## 距离取为欧氏距离，即为二范数</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>\                    center<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\               <span class="token operator">==</span>np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 根据self.dis更新聚类中心self.center</span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#设置统计数组每次循环将同类的样本存储起来</span>            count<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 逐类进行统计并计算新的聚类中心</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>j<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># 一行一行进行拼接</span>                    count<span class="token operator">=</span>np<span class="token punctuation">.</span>row_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>            <span class="token comment" spellcheck="true"># 更新聚类中心</span>            <span class="token comment" spellcheck="true"># print(count.shape)</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>count<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.center)</span></code></pre><h4 id="迭代更新部分"><a href="#迭代更新部分" class="headerlink" title="迭代更新部分"></a>迭代更新部分</h4><p>循环调用<code>k-means</code>类里的方法即可达到迭代更新的目的，终止条件：当此次的聚类中心点和上次的聚类中心点相比变化小于设定阈值时停止迭代</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 实例化一个K_means类</span>iris<span class="token operator">=</span> K_means<span class="token punctuation">(</span>data<span class="token punctuation">,</span> target<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print(iris.dis)</span><span class="token comment" spellcheck="true"># center用来和iris.center比较，相同则迭代终止</span>center<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 迭代部分</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.0000001</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 刚用class写，踩到的一个坑，这里要调用copy方法，</span>    <span class="token comment" spellcheck="true"># 直接等于表示只修改指针，不可取</span>    center<span class="token operator">=</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>    iris<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(center)</span>    iris<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>    i<span class="token operator">+=</span><span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span></code></pre><h4 id="评价聚类效果"><a href="#评价聚类效果" class="headerlink" title="评价聚类效果"></a>评价聚类效果</h4><p>利用sklearn包中的函数计算轮廓系数</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token comment" spellcheck="true">## 计算轮廓系数来评价聚类效果</span><span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span>\    iris<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="FCM的实现"><a href="#FCM的实现" class="headerlink" title="FCM的实现"></a>FCM的实现</h3><h4 id="导入数据部分-1"><a href="#导入数据部分-1" class="headerlink" title="导入数据部分"></a>导入数据部分</h4><p>与K-means相同</p><h4 id="随机初始化隶属度矩阵"><a href="#随机初始化隶属度矩阵" class="headerlink" title="随机初始化隶属度矩阵"></a>随机初始化隶属度矩阵</h4><pre class=" language-python"><code class="language-python">!<span class="token punctuation">[</span><span class="token keyword">class</span>：FCM<span class="token punctuation">]</span><span class="token punctuation">(</span>E<span class="token punctuation">:</span><span class="token operator">%</span>5Cblog_pic<span class="token operator">%</span>5Cclass<span class="token operator">%</span>EF<span class="token operator">%</span>BC<span class="token operator">%</span>9AFCM<span class="token punctuation">.</span>jpg<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 指定FCM中的c值</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token comment" spellcheck="true"># 随机初始化隶属度矩阵</span>U <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">and</span> j <span class="token operator">&lt;</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>            U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 最后一列单独赋值</span>    U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h4 id="算法核心的实现-1"><a href="#算法核心的实现-1" class="headerlink" title="算法核心的实现"></a>算法核心的实现</h4><p>编写一个类，名称为<code>FCM</code>，它的属性以及方法如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/class%EF%BC%9AFCM.jpg"></p><p>利用python实现的代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">FCM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 聚类数目</span>        self<span class="token punctuation">.</span>c <span class="token operator">=</span> c        <span class="token comment" spellcheck="true"># 柔性参数（衡量模糊度）</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha        <span class="token comment" spellcheck="true"># 样本数据</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data        <span class="token comment" spellcheck="true"># 隶属度矩阵</span>        self<span class="token punctuation">.</span>U <span class="token operator">=</span> U        <span class="token comment" spellcheck="true"># 聚类中心</span>        self<span class="token punctuation">.</span>center <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>c<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 代价函数</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># 存储距离</span>        self<span class="token punctuation">.</span>dis <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 聚类结果</span>        self<span class="token punctuation">.</span>target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新聚类中心</span>    <span class="token keyword">def</span> <span class="token function">update_center</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>\                <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token operator">*</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum\                    <span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新隶属度矩阵</span>    <span class="token keyword">def</span> <span class="token function">update_U</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 计算距离，并存入self.dis中</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm\                    <span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.dis)</span>        <span class="token comment" spellcheck="true"># 根据公式计算新的隶属度矩阵</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis\                    <span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">-</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.U)</span>    <span class="token comment" spellcheck="true"># 计算代价函数</span>    <span class="token keyword">def</span> <span class="token function">compute_J</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            J <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                J <span class="token operator">+=</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span> <span class="token operator">*</span> \                    np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># print(J)</span>            self<span class="token punctuation">.</span>J <span class="token operator">+=</span> J    <span class="token comment" spellcheck="true"># 根据当前隶属度矩阵判断类别</span>    <span class="token keyword">def</span> <span class="token function">compute_target</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>target<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h4 id="迭代更新部分-1"><a href="#迭代更新部分-1" class="headerlink" title="迭代更新部分"></a>迭代更新部分</h4><p>循环调用<code>FCM</code>类里的方法即可达到迭代更新的目的，终止条件：当此次的聚类中心点和上次的聚类中心点相比变化小于设定阈值时停止迭代</p><pre class=" language-python"><code class="language-python">iris <span class="token operator">=</span> FCM<span class="token punctuation">(</span>c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print(sonar.U)</span><span class="token comment" spellcheck="true"># 保留更新前的中心点</span>center <span class="token operator">=</span> np<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 迭代部分</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.0000001</span><span class="token punctuation">:</span>    center<span class="token operator">=</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(U)</span>    iris<span class="token punctuation">.</span>update_center<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(iris.center)</span>    iris<span class="token punctuation">.</span>compute_J<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(iris.center)</span>    iris<span class="token punctuation">.</span>update_U<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    iris<span class="token punctuation">.</span>compute_target<span class="token punctuation">(</span><span class="token punctuation">)</span>    i<span class="token operator">+=</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span></code></pre><h4 id="评价聚类效果-1"><a href="#评价聚类效果-1" class="headerlink" title="评价聚类效果"></a>评价聚类效果</h4><p>与K-means相同</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token comment" spellcheck="true"># 计算轮廓系数来评价聚类效果</span><span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span>\    iris<span class="token punctuation">.</span>target<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="结果展示与分析"><a href="#结果展示与分析" class="headerlink" title="结果展示与分析"></a>结果展示与分析</h2><h3 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h3><h4 id="K-means-1"><a href="#K-means-1" class="headerlink" title="K-means"></a>K-means</h4><h5 id="iris数据集-1"><a href="#iris数据集-1" class="headerlink" title="iris数据集"></a>iris数据集</h5><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-01_15-39-36.jpg"></p><p>轮廓系数为0.519，聚类效果还可以</p><h5 id="sonar数据集-1"><a href="#sonar数据集-1" class="headerlink" title="sonar数据集"></a>sonar数据集</h5><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-01_15-43-37.jpg"></p><p>轮廓系数为0.198，效果一般</p><h4 id="FCM-1"><a href="#FCM-1" class="headerlink" title="FCM"></a>FCM</h4><h5 id="iris数据集-2"><a href="#iris数据集-2" class="headerlink" title="iris数据集"></a>iris数据集</h5><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-01_15-45-50.jpg"></p><p>轮廓系数为0.527，与k-means效果相当</p><h5 id="sonar数据集-2"><a href="#sonar数据集-2" class="headerlink" title="sonar数据集"></a>sonar数据集</h5><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-01_15-48-25.jpg"></p><p>轮廓系数为0.198，与k-means效果相当</p><h3 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h3><p>可以看出，在性能方面，k-means算法和FCM算法基本上差距不大；但在收敛速度上，k-means算法要略优于FCM算法，收敛速度慢，容易陷入局部最小是FCM算法的缺点，改进可以使用IFCM算法（直觉模糊c均值聚类），它相较于FCM算法增加了新的参数——非隶属度$\gamma$和不确定度$\pi$，能更加细腻的刻画出客观世界的模糊性质。</p><h2 id="拓展——k-means算法用于图像分割"><a href="#拓展——k-means算法用于图像分割" class="headerlink" title="拓展——k-means算法用于图像分割"></a>拓展——k-means算法用于图像分割</h2><h3 id="原理简介-1"><a href="#原理简介-1" class="headerlink" title="原理简介"></a>原理简介</h3><p>将一张RGB三通道的图像中的每一个像素点都视为一个样本，那么每个样本都对应有3个特征，分别为R、G、B的值，如果像素点属于同一区域，那么它们的特征值一定很相近，此时就可以利用聚类算法让特征值相近的像素点聚为一类，最后将不同类别的像素点用不同的颜色或者灰度值输出即可</p><h3 id="样本展示"><a href="#样本展示" class="headerlink" title="样本展示"></a>样本展示</h3><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/3.bmp"></p><p>在此处取聚类的k值为3，意思是将图片分割为3类，分别是天空、山坡和水面。</p><h3 id="编程思路-1"><a href="#编程思路-1" class="headerlink" title="编程思路"></a>编程思路</h3><p>整体思路和前面的思路基本一致，只需要修改图像输入部分以及加上最后的结果图展示部分</p><h4 id="图像输入"><a href="#图像输入" class="headerlink" title="图像输入"></a>图像输入</h4><p>利用<code>pillow</code>包中的<code>Imge</code>库将图片中的每一个像素点的rgb值都提取出来，成为一个行向量，然后将所有行向量拼接起来，变成一个样本矩阵。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token comment" spellcheck="true"># 读取数据</span>img<span class="token operator">=</span>Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'3.bmp'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>lst<span class="token operator">=</span>list<span class="token punctuation">(</span>img<span class="token punctuation">.</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print(type(img.size))</span>data<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>lst<span class="token punctuation">)</span></code></pre><h4 id="结果图展示部分"><a href="#结果图展示部分" class="headerlink" title="结果图展示部分"></a>结果图展示部分</h4><p>根据聚类得到的标签值(一个列向量)，先将它重组为一个和原图像尺寸一致的矩阵，再根据不同的类别给像素点赋上不同的RGB值，然后再根据RGB值输出图像即可</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token comment" spellcheck="true">## 输出分割后的图像</span><span class="token keyword">def</span> <span class="token function">plot_pic</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    k<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    rows<span class="token punctuation">,</span>columns<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    targets<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>    img<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>rows<span class="token punctuation">,</span>columns<span class="token punctuation">]</span><span class="token punctuation">)</span>    img<span class="token operator">=</span>targets<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span>columns<span class="token punctuation">,</span>rows<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T    im <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#创建图片</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    im<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'3-result.jpg'</span><span class="token punctuation">)</span></code></pre><h3 id="结果展示-1"><a href="#结果展示-1" class="headerlink" title="结果展示"></a>结果展示</h3><p>首先来看一下轮廓系数</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-11-01_17-51-49.jpg"></p><p>轮廓系数为0.669，说明聚类的效果比较好，再来看看分割后的图像</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/3-result.jpg"></p><p>可以看出，整体上图像分割的效果还不错，基本上将天空，山坡和水区分开来。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><h3 id="k-means"><a href="#k-means" class="headerlink" title="k-means"></a>k-means</h3><h4 id="iris"><a href="#iris" class="headerlink" title="iris"></a>iris</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token keyword">import</span> random<span class="token comment" spellcheck="true">## 创建一个k-means类</span><span class="token keyword">class</span> <span class="token class-name">K_means</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>data<span class="token punctuation">,</span> target<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>center<span class="token operator">=</span>center_points <span class="token comment" spellcheck="true">#聚类中心点的坐标</span>        self<span class="token punctuation">.</span>k<span class="token operator">=</span>k <span class="token comment" spellcheck="true">#聚类数</span>        self<span class="token punctuation">.</span>data<span class="token operator">=</span>data <span class="token comment" spellcheck="true">#样本</span>        self<span class="token punctuation">.</span>target<span class="token operator">=</span>target <span class="token comment" spellcheck="true">#样本对应的标签</span>        <span class="token comment" spellcheck="true"># dis前k列表示每个样本到各聚类中心的距离，最后一列表示类别</span>        self<span class="token punctuation">.</span>dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># distance方法：计算当前到k个聚类中心的距离，找出最小距离并将每个样本分类</span>    <span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">## 距离取为欧氏距离，即为二范数</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>\                    center<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\                <span class="token operator">==</span>np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 根据self.dis更新聚类中心self.center    </span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#设置统计数组每次循环将同类的样本存储起来</span>            count<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 逐类进行统计并计算新的聚类中心</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>j<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># 一行一行进行拼接</span>                    count<span class="token operator">=</span>np<span class="token punctuation">.</span>row_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                 <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>            <span class="token comment" spellcheck="true"># 更新聚类中心</span>            <span class="token comment" spellcheck="true"># print(count.shape)</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>count<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.center)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据</span>    data<span class="token operator">=</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 标签</span>    target<span class="token operator">=</span>data<span class="token punctuation">.</span>target<span class="token punctuation">.</span>T    <span class="token comment" spellcheck="true"># 样本数据</span>    data<span class="token operator">=</span>data<span class="token punctuation">.</span>data    <span class="token comment" spellcheck="true"># 指定k-means中的k值</span>    k<span class="token operator">=</span><span class="token number">3</span>    <span class="token comment" spellcheck="true"># 随机选择k个聚类中心</span>    flags<span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(flags)</span>    center_points<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>k<span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>        center_points<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>data<span class="token punctuation">[</span>flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        j<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># 实例化一个K_means类</span>    iris<span class="token operator">=</span> K_means<span class="token punctuation">(</span>data<span class="token punctuation">,</span> target<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(iris.dis)</span>    <span class="token comment" spellcheck="true"># center用来和iris.center比较，相同则迭代终止</span>    center<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 迭代部分</span>    i<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.0000001</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># while i&lt;50:</span>        <span class="token comment" spellcheck="true"># 刚用class写，踩到的一个坑，这里要调用copy方法，</span>        <span class="token comment" spellcheck="true"># 直接等于表示只修改指针，不可取</span>        center<span class="token operator">=</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        iris<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(center)</span>        iris<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>        i<span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(iris.dis)</span>    <span class="token comment" spellcheck="true"># 计算轮廓系数来评价聚类效果</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="sonar"><a href="#sonar" class="headerlink" title="sonar"></a>sonar</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> random<span class="token comment" spellcheck="true">## 创建一个k-means类，编写一些方法</span><span class="token keyword">class</span> <span class="token class-name">K_means</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>data<span class="token punctuation">,</span> target<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>center<span class="token operator">=</span>center_points <span class="token comment" spellcheck="true">#聚类中心点的坐标</span>        self<span class="token punctuation">.</span>k<span class="token operator">=</span>k <span class="token comment" spellcheck="true">#聚类数</span>        self<span class="token punctuation">.</span>data<span class="token operator">=</span>data <span class="token comment" spellcheck="true">#样本</span>        self<span class="token punctuation">.</span>target<span class="token operator">=</span>target <span class="token comment" spellcheck="true">#样本对应的标签</span>        <span class="token comment" spellcheck="true"># dis前k列表示每个样本到各聚类中心的距离，最后一列表示类别</span>        self<span class="token punctuation">.</span>dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#distance方法：计算当前到k个聚类中心的距离，找出最小距离并将每个样本分类</span>    <span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">## 距离取为欧氏距离，即为二范数</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm\                    <span class="token punctuation">(</span>self<span class="token punctuation">.</span>center<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\                <span class="token operator">==</span>np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 根据self.dis更新聚类中心self.center    </span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#设置统计数组每次循环将同类的样本存储起来</span>            count<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 逐类进行统计并计算新的聚类中心</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>j<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># 一行一行进行拼接</span>                    count<span class="token operator">=</span>np<span class="token punctuation">.</span>row_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                 <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>            <span class="token comment" spellcheck="true"># 更新聚类中心</span>            <span class="token comment" spellcheck="true"># print(count.shape)</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>count<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.center)</span><span class="token comment" spellcheck="true"># 导入数据</span><span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    传入文件路径，返回样本数据以及标签    """</span>    workbook<span class="token operator">=</span>load_workbook<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(workbook.sheetnames)</span>    sheet<span class="token operator">=</span>workbook<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储样本特征集</span>    sonar<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 存储标签</span>    target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># print(sonar.shape)</span>    <span class="token comment" spellcheck="true"># print(sonar[0,59])</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">==</span><span class="token string">'R'</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(target[97])</span>    <span class="token comment" spellcheck="true"># sonar1=sonar[0:97,:]</span>    <span class="token comment" spellcheck="true"># sonar2=sonar[97:208,:]</span>    <span class="token comment" spellcheck="true"># target1=target[0:97,:]</span>    <span class="token comment" spellcheck="true"># target2=target[97:208,:]  </span>    <span class="token keyword">return</span> sonar<span class="token punctuation">,</span>target<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#读取数据</span>    path<span class="token operator">=</span><span class="token string">'sonar.xlsx'</span>    data<span class="token punctuation">,</span>target<span class="token operator">=</span>get_data<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 指定k-means中的k值</span>    k<span class="token operator">=</span><span class="token number">2</span>    <span class="token comment" spellcheck="true"># 随机选择k个聚类中心</span>    flags<span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(flags)</span>    center_points<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>k<span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>        center_points<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>data<span class="token punctuation">[</span>flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        j<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># 实例化一个K_means类</span>    sonar<span class="token operator">=</span> K_means<span class="token punctuation">(</span>data<span class="token punctuation">,</span> target<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(sonar.dis)</span>    <span class="token comment" spellcheck="true"># center用来和sonar.center比较，相同则迭代终止</span>    center<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>center<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 迭代部分</span>    i<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.00000001</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 刚用class写，踩到的一个坑，这里要调用copy方法，</span>        <span class="token comment" spellcheck="true"># 直接等于表示只修改指针，不可取</span>        center<span class="token operator">=</span>sonar<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        sonar<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(center)</span>        sonar<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>        i<span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(sonar.dis)</span>    <span class="token comment" spellcheck="true"># 计算轮廓系数来评价聚类效果</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span>\        sonar<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="FCM-2"><a href="#FCM-2" class="headerlink" title="FCM"></a>FCM</h3><h4 id="iris-1"><a href="#iris-1" class="headerlink" title="iris"></a>iris</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> random<span class="token keyword">class</span> <span class="token class-name">FCM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 聚类数目</span>        self<span class="token punctuation">.</span>c <span class="token operator">=</span> c        <span class="token comment" spellcheck="true"># 柔性参数（衡量模糊度）</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha        <span class="token comment" spellcheck="true"># 样本数据</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data        <span class="token comment" spellcheck="true"># 隶属度矩阵</span>        self<span class="token punctuation">.</span>U <span class="token operator">=</span> U        <span class="token comment" spellcheck="true"># 聚类中心</span>        self<span class="token punctuation">.</span>center <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>c<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 代价函数</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># 存储距离</span>        self<span class="token punctuation">.</span>dis <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 聚类结果</span>        self<span class="token punctuation">.</span>target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新聚类中心</span>    <span class="token keyword">def</span> <span class="token function">update_center</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>\                <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token operator">*</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum\                    <span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新隶属度矩阵</span>    <span class="token keyword">def</span> <span class="token function">update_U</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 计算距离，并存入self.dis中</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm\                    <span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.dis)</span>        <span class="token comment" spellcheck="true"># 根据公式计算新的隶属度矩阵</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis\                    <span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">-</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.U)</span>    <span class="token comment" spellcheck="true"># 计算代价函数</span>    <span class="token keyword">def</span> <span class="token function">compute_J</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            J <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                J <span class="token operator">+=</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span> <span class="token operator">*</span> \                    np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># print(J)</span>            self<span class="token punctuation">.</span>J <span class="token operator">+=</span> J    <span class="token comment" spellcheck="true"># 根据当前隶属度矩阵判断类别</span>    <span class="token keyword">def</span> <span class="token function">compute_target</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>target<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据</span>    data<span class="token operator">=</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 标签</span>    target<span class="token operator">=</span>data<span class="token punctuation">.</span>target<span class="token punctuation">.</span>T    <span class="token comment" spellcheck="true"># 样本数据</span>    data<span class="token operator">=</span>data<span class="token punctuation">.</span>data    <span class="token comment" spellcheck="true"># 指定FCM中的c值</span>    c <span class="token operator">=</span> <span class="token number">3</span>    <span class="token comment" spellcheck="true"># 设置柔性参数alpha</span>    alpha <span class="token operator">=</span> <span class="token number">2</span>    <span class="token comment" spellcheck="true"># 随机生成隶属度矩阵U</span>    <span class="token comment" spellcheck="true"># 随机初始化隶属度矩阵</span>    U <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">and</span> j <span class="token operator">&lt;</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>                U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 最后一列单独赋值</span>        U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    iris <span class="token operator">=</span> FCM<span class="token punctuation">(</span>c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(sonar.U)</span>    <span class="token comment" spellcheck="true"># 保留更新前的中心点</span>    center <span class="token operator">=</span> np<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 迭代部分</span>    i <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.0000001</span><span class="token punctuation">:</span>        center<span class="token operator">=</span>iris<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(U)</span>        iris<span class="token punctuation">.</span>update_center<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(iris.center)</span>        iris<span class="token punctuation">.</span>compute_J<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(iris.center)</span>        iris<span class="token punctuation">.</span>update_U<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        iris<span class="token punctuation">.</span>compute_target<span class="token punctuation">(</span><span class="token punctuation">)</span>        i<span class="token operator">+=</span><span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(iris.dis)</span>    <span class="token comment" spellcheck="true"># 计算轮廓系数来评价聚类效果</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score\          <span class="token punctuation">(</span>data<span class="token punctuation">,</span> iris<span class="token punctuation">.</span>target<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="sonar-1"><a href="#sonar-1" class="headerlink" title="sonar"></a>sonar</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> numpy<span class="token punctuation">.</span>ma<span class="token punctuation">.</span>core <span class="token keyword">import</span> argsort<span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> random<span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    传入文件路径，返回样本数据以及标签    """</span>    workbook <span class="token operator">=</span> load_workbook<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(workbook.sheetnames)</span>    sheet <span class="token operator">=</span> workbook<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储样本特征集</span>    sonar <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 存储标签</span>    target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># print(sonar.shape)</span>    <span class="token comment" spellcheck="true"># print(sonar[0,59])</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'R'</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">return</span> sonar<span class="token punctuation">,</span> target<span class="token comment" spellcheck="true"># 编写FCM类</span><span class="token keyword">class</span> <span class="token class-name">FCM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 聚类数目</span>        self<span class="token punctuation">.</span>c <span class="token operator">=</span> c        <span class="token comment" spellcheck="true"># 柔性参数（衡量模糊度）</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha        <span class="token comment" spellcheck="true"># 样本数据</span>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data        <span class="token comment" spellcheck="true"># 隶属度矩阵</span>        self<span class="token punctuation">.</span>U <span class="token operator">=</span> U        <span class="token comment" spellcheck="true"># 聚类中心</span>        self<span class="token punctuation">.</span>center <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>c<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 代价函数</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># 存储距离</span>        self<span class="token punctuation">.</span>dis <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 聚类结果</span>        self<span class="token punctuation">.</span>target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新聚类中心</span>    <span class="token keyword">def</span> <span class="token function">update_center</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>\                self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token operator">*</span>self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> \                    axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U\                        <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 更新隶属度矩阵</span>    <span class="token keyword">def</span> <span class="token function">update_U</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 计算距离，并存入self.dis中</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>\                    self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.dis)</span>        <span class="token comment" spellcheck="true"># 根据公式计算新的隶属度矩阵</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>\                    sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis\                        <span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token operator">/</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> \                            <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">-</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>alpha<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.U)</span>    <span class="token comment" spellcheck="true"># 计算代价函数</span>    <span class="token keyword">def</span> <span class="token function">compute_J</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>J <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            J <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                J <span class="token operator">+=</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span>\                    <span class="token operator">*</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># print(J)</span>            self<span class="token punctuation">.</span>J <span class="token operator">+=</span> J    <span class="token comment" spellcheck="true"># 根据当前隶属度矩阵判断类别</span>    <span class="token keyword">def</span> <span class="token function">compute_target</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>target<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>self<span class="token punctuation">.</span>U<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据</span>    path <span class="token operator">=</span> r<span class="token string">'sonar.xlsx'</span>    data<span class="token punctuation">,</span> target <span class="token operator">=</span> get_data<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(data.shape)</span>    <span class="token comment" spellcheck="true"># 设置聚类数目</span>    c <span class="token operator">=</span> <span class="token number">2</span>    <span class="token comment" spellcheck="true"># 设置柔性参数alpha</span>    alpha <span class="token operator">=</span> <span class="token number">2</span>    <span class="token comment" spellcheck="true"># 随机生成隶属度矩阵U</span>    <span class="token comment" spellcheck="true"># 随机初始化隶属度矩阵</span>    U <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">and</span> j <span class="token operator">&lt;</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>                U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 最后一列单独赋值</span>        U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>U<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    sonar <span class="token operator">=</span> FCM<span class="token punctuation">(</span>c<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> data<span class="token punctuation">,</span> U<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(sonar.U)</span>    <span class="token comment" spellcheck="true"># 保留更新前的中心点</span>    center <span class="token operator">=</span> np<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>center<span class="token punctuation">)</span>    i <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.0000001</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># while i&lt;100:</span>        center<span class="token operator">=</span>sonar<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(center)</span>        sonar<span class="token punctuation">.</span>update_center<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(sonar.center)</span>        sonar<span class="token punctuation">.</span>compute_J<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(sonar.center)</span>        sonar<span class="token punctuation">.</span>update_U<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        sonar<span class="token punctuation">.</span>compute_target<span class="token punctuation">(</span><span class="token punctuation">)</span>        i<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(sonar.target)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代结束"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(type(sonar.target))</span>    <span class="token comment" spellcheck="true"># print(center)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span> sonar<span class="token punctuation">.</span>target<span class="token punctuation">.</span>\        reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="图像分割"><a href="#图像分割" class="headerlink" title="图像分割"></a>图像分割</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics<span class="token keyword">import</span> random<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token comment" spellcheck="true">## 创建一个k-means类</span><span class="token keyword">class</span> <span class="token class-name">K_means</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>data<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>center<span class="token operator">=</span>center_points <span class="token comment" spellcheck="true">#聚类中心点的坐标</span>        self<span class="token punctuation">.</span>k<span class="token operator">=</span>k <span class="token comment" spellcheck="true">#聚类数</span>        self<span class="token punctuation">.</span>data<span class="token operator">=</span>data <span class="token comment" spellcheck="true">#样本</span>        <span class="token comment" spellcheck="true"># self.target=target #样本对应的标签</span>        <span class="token comment" spellcheck="true"># dis前k列表示每个样本到各聚类中心的距离，最后一列表示类别</span>        self<span class="token punctuation">.</span>dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#distance方法：计算当前到k个聚类中心的距离，找出最小距离并将每个样本分类</span>    <span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">## 距离取为欧氏距离，即为二范数</span>                self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm\                    <span class="token punctuation">(</span>self<span class="token punctuation">.</span>center<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>ord<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">==</span>\                np<span class="token punctuation">.</span>min<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 根据self.dis更新聚类中心self.center    </span>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#设置统计数组每次循环将同类的样本存储起来</span>            count<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true"># 逐类进行统计并计算新的聚类中心</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>dis<span class="token punctuation">[</span>j<span class="token punctuation">,</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># 一行一行进行拼接</span>                    count<span class="token operator">=</span>np<span class="token punctuation">.</span>row_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                 <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>            <span class="token comment" spellcheck="true"># 更新聚类中心</span>            <span class="token comment" spellcheck="true"># print(count.shape)</span>            self<span class="token punctuation">.</span>center<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>count<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(self.center)</span><span class="token comment" spellcheck="true">## 输出分割后的图像</span><span class="token keyword">def</span> <span class="token function">plot_pic</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    k<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    rows<span class="token punctuation">,</span>columns<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    targets<span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>    img<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>rows<span class="token punctuation">,</span>columns<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># for i in range(rows):</span>    <span class="token comment" spellcheck="true">#     for j in range(columns):</span>    <span class="token comment" spellcheck="true">#         if </span>    img<span class="token operator">=</span>targets<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span>columns<span class="token punctuation">,</span>rows<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T    <span class="token comment" spellcheck="true"># img=img*255/(k-1)</span>    im <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#创建图片</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>                im<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    im<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    im<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'3-result.jpg'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据</span>    img<span class="token operator">=</span>Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'3.bmp'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>    lst<span class="token operator">=</span>list<span class="token punctuation">(</span>img<span class="token punctuation">.</span>getdata<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(type(img.size))</span>    data<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>lst<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 指定k-means中的k值</span>    k<span class="token operator">=</span><span class="token number">3</span>    <span class="token comment" spellcheck="true"># 随机选择k个聚类中心</span>    flags<span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(flags)</span>    center_points<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>k<span class="token punctuation">,</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>        center_points<span class="token punctuation">[</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>data<span class="token punctuation">[</span>flags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        j<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># 实例化一个K_means类</span>    pic<span class="token operator">=</span> K_means<span class="token punctuation">(</span>data<span class="token punctuation">,</span>center_points<span class="token punctuation">,</span> k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(pic.dis)</span>    <span class="token comment" spellcheck="true"># center用来和pic.center比较，相同则迭代终止</span>    center<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>pic<span class="token punctuation">.</span>center<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 迭代部分</span>    i<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>pic<span class="token punctuation">.</span>center<span class="token operator">-</span>center<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.001</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 刚用class写，踩到的一个坑，这里要调用copy方法，</span>        <span class="token comment" spellcheck="true"># 直接等于表示只修改指针，不可取</span>        center<span class="token operator">=</span>pic<span class="token punctuation">.</span>center<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        pic<span class="token punctuation">.</span>distance<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(center)</span>        pic<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>        i<span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"迭代第{}次"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"算法收敛，迭代终止"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(pic.dis[:,-1])</span>    <span class="token comment" spellcheck="true"># 计算轮廓系数来评价聚类效果</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>silhouette_score<span class="token punctuation">(</span>data<span class="token punctuation">,</span>\        pic<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    plot_pic<span class="token punctuation">(</span>k<span class="token punctuation">,</span>img<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>img<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pic<span class="token punctuation">.</span>dis<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
            <tag> 模式识别 </tag>
            
            <tag> 大作业 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网站搭好之后怎么办</title>
      <link href="built-blog-2/"/>
      <url>built-blog-2/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前面的文章已经详细介绍了怎么搭建一个个人网站，可以戳这里去复习一下，这篇文章，我主要写一下，网站搭建好之后该做些什么。主要分为以下几点：</p><ul><li>修改网站的基本信息</li><li>修改主题</li><li>创建新文章并上传</li></ul><h2 id="网站基本信息的修改"><a href="#网站基本信息的修改" class="headerlink" title="网站基本信息的修改"></a>网站基本信息的修改</h2><p>搭建好网站之后，有许多配置信息需要我们去修改，比如网站的标题、标签等选项，具体修改步骤如下（以我的博客为例）：</p><ol><li><p>打开博客目录下的<code>_config.yml</code>文件，找到如图所示的选项</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201027195142732.png"></p></li><li><p>然后根据实际情况修改即可，具体的配置信息如下：</p><table><thead><tr><th align="center">参数</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">title</td><td align="center">网站的标题</td></tr><tr><td align="center">subtitle</td><td align="center">网站的副标题</td></tr><tr><td align="center">description</td><td align="center">对于网站的描述，主要用于<a href="%5Bhttps://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/3132?fromtitle=SEO&fromid=102990%5D(https://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96/3132?fromtitle=SEO&fromid=102990)">SEO</a></td></tr><tr><td align="center">keywords</td><td align="center">网站的关键词，支持多个关键词</td></tr><tr><td align="center">author</td><td align="center">作者名</td></tr><tr><td align="center">language</td><td align="center">网站使用的语言，对于简体中文用户来说，语言的设置跟使用不同的主题有关，可以参考各自主题的文档自行配置，一般为<code>zh-CN</code></td></tr><tr><td align="center">timezone</td><td align="center">设置网站的时区，如果不填则默认使用你电脑的时区</td></tr></tbody></table></li></ol><blockquote><p>ps：更多的配置信息修改可以去hexo的官方文档，<a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">戳我跳转</a>，大家可以修改一个选项之后，执行<code>hexo clean</code>、<code>hexo g</code>、<code>hexo s</code>在本地看一下效果，等全部修改好之后再推送到仓库</p></blockquote><h2 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h2><h3 id="挑选称心的主题"><a href="#挑选称心的主题" class="headerlink" title="挑选称心的主题"></a>挑选称心的主题</h3><p>hexo默认的主题有点不好看，修改好基本配置信息之后，可以考虑换一个主题，主题多可以说的上是hexo框架的一大卖点，<a href="https://hexo.io/themes/" target="_blank" rel="noopener">戳我去挑选主题</a>，界面如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201027210051822.png"></p><p>大家可以进入预览站点看一下该主题功能是否完善，是否满意，在这可以给大家推荐几个主题：</p><h4 id="NexT"><a href="#NexT" class="headerlink" title="NexT"></a>NexT</h4><ul><li><p><a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener">仓库地址</a></p></li><li><p><a href="https://theme-next.js.org/" target="_blank" rel="noopener">预览地址</a></p></li><li><p>首先就是大名鼎鼎的Next主题了，页面简洁，功能全，用的人多，网上的个性化配置教程也超级多，用这个主题如果遇到问题，在网上基本上能找到对应的解决办法。</p></li></ul><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201027212404411.png" alt="有很多人参与主题开发" style="zoom:80%;" /><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_22-10-29.jpg"></p><h4 id="Butterfly"><a href="#Butterfly" class="headerlink" title="Butterfly"></a>Butterfly</h4><ul><li><p><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener">仓库地址</a></p></li><li><p><a href="https://demo.jerryc.me/" target="_blank" rel="noopener">预览地址</a></p></li><li><p>挺好看的一个主题，用的人也不少，贴一张图吧：</p></li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_21-56-27.jpg"></p><h4 id="Nexmoe"><a href="#Nexmoe" class="headerlink" title="Nexmoe"></a>Nexmoe</h4><ul><li><a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank" rel="noopener">仓库地址</a></li><li><a href="https://suikastar.com/" target="_blank" rel="noopener">预览地址</a></li><li>看起来也不错~~（好吧我没词了🤣）</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_22-13-25.jpg"></p><h4 id="Clover"><a href="#Clover" class="headerlink" title="Clover"></a>Clover</h4><ul><li><a href="https://github.com/esappear/hexo-theme-clover" target="_blank" rel="noopener">仓库地址</a></li><li><a href="https://esappear.github.io/clover/" target="_blank" rel="noopener">预览地址</a></li><li>简洁大气，也还不错~~</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_22-15-45.jpg"></p><h4 id="Diaspora"><a href="#Diaspora" class="headerlink" title="Diaspora"></a>Diaspora</h4><ul><li><a href="https://github.com/Fechin/hexo-theme-diaspora" target="_blank" rel="noopener">仓库地址</a></li><li><a href="https://fech.in/" target="_blank" rel="noopener">预览地址</a></li><li>感觉比较适合喜欢二次元的童鞋？</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_22-22-44.jpg"></p><h4 id="Bamboo"><a href="#Bamboo" class="headerlink" title="Bamboo"></a>Bamboo</h4><ul><li><a href="https://github.com/yuang01/hexo-theme-bamboo" target="_blank" rel="noopener">仓库地址</a></li><li><a href="https://yuang01.github.io/" target="_blank" rel="noopener">预览地址</a></li><li>就很棒，好看就完事了，左下角的看板娘真好看</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-27_22-27-48.jpg"></p><h3 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h3><p>前面推荐了几个我觉得还不错的主题，仅代表个人的辣鸡审美哈。更多主题大家可以去主题市场慢慢探索，接下来我给大家讲一下怎么更换主题：</p><ol><li><p>打开你的博客文件夹，会发现有一个<code>themes</code>文件夹，这就是存放网站主题的文件夹</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-12-08.jpg"></p></li><li><p>打开文件夹，你就能看到现在能用的主题有哪几个，文件夹名就是主题名，比如我这儿就有三个可用主题：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-17-00.jpg"></p></li><li><p>选好主题后，就得先把主题弄到本地来，可以使用<code>git clone</code>命令进行下载(具体参考每个主题仓库的<code>README</code>文档)，也有一种粗暴的方法，直接下载压缩包，然后解压到刚才说的<code>themes</code>文件夹就可以了。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-27-49.jpg"></p></li><li><p>解压成功后，应该就能在<code>themes</code>文件夹下看到你新添加的主题，比如我这边用<code>git</code>命令添加一个<code>butterfly</code>主题，结果如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-36-03.jpg"></p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-38-13.jpg"></p></li><li><p>然后就是换主题，打开你的博客目录下的<code>_config.yml</code>文件，按下<code>ctrl+F</code>然后查找<code>Extensions</code>，就能看到<code>theme</code>选项，如图：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_18-50-45.jpg"></p></li><li><p>最后，将你想修改的主题的名字(就是<code>themes</code>文件夹下你所选主题对应的文件夹名)，填写在<code>theme</code>选项后边，然后再<code>hexo三连</code>就大功告成了！</p></li><li><p>可以发现，每个主题文件夹下面也有一个<code>_config.yml</code>文件，这个是该主题的配置文件，在里边还需要改一些配置信息，由于不同主题都不一样，我就不细说了，大伙可以跟着主题仓库的说明文档或者网上的教程自行更改。注意不要和你博客文件夹下的<code>_config.yml</code>文件搞混了哟。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_19-04-37.jpg"></p></li></ol><blockquote><p>不会吧不会吧，不会有人不知道<code>hexo三连</code>是啥吧🔨🔨🔨，那肯定是<code>hexo clean</code>、<code>hexo g</code>、<code>hexo d</code>呀，这么叫多顺口对吧</p></blockquote><h2 id="如何写博客并发布到个人网站上"><a href="#如何写博客并发布到个人网站上" class="headerlink" title="如何写博客并发布到个人网站上"></a>如何写博客并发布到个人网站上</h2><h3 id="用啥写"><a href="#用啥写" class="headerlink" title="用啥写"></a>用啥写</h3><p>前面已经说过，写博客基本上都使用<code>markdown</code>语言来写，那用啥<code>markdown</code>编辑器呢？在这里做一下推荐：</p><ul><li><p>Typora：</p><p>这软件也是我现在写<code>markdown</code>的主力编辑器，很小巧，功能却不少，我也更倾向于推荐大家使用它，软件界面如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_19-24-39.jpg"></p><p>食用方法也很简单，安装即用，下载链接：<a href="https://typora.io/#windows" target="_blank" rel="noopener">戳我跳转</a></p></li><li><p>vscode</p><p>如果你写的博客里边涉及到很多数学公式的话，我更推荐你使用vscode来写，因为写数学公式的时候，vscode支持补全，他是我所知道的唯一一个支持补全数学公式的编辑器，举个栗子：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_20-09-27.jpg"></p><p>再也不用苦逼地一点一点敲数学公式了，vscode永远的神！！！</p><p>食用方法：下载安装vscode，然后安装插件<code>Markdown All in One</code>即可</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_20-14-41.jpg"></p></li></ul><h3 id="添加Front-matter"><a href="#添加Front-matter" class="headerlink" title="添加Front-matter"></a>添加Front-matter</h3><p>找好编辑器，就可以上手写了，你的博客内容你做主，啥都可以写。不过都要在你文章的<strong>最前面</strong>加上一些你对这篇博客的描述（<strong>Front-matter</strong>），比如名称、发布时间、标签之类。举个栗子：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-29_20-39-09.jpg"></p><h3 id="咋发布"><a href="#咋发布" class="headerlink" title="咋发布"></a>咋发布</h3><p>博客写好之后，将写好的md文件复制一下，在<code>你的博客文件夹\source\_posts</code>文件下粘贴即可。然后又是老一套：在你的博客文件夹下打开<code>Git Bash</code>，再来一波<code>hexo三连</code>，推送之前可以先<code>hexo s</code>本地查看效果哈。</p><p><code>hexo三连</code>之后，别忘记去<code>Gitee pages</code>手动更新哦！</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到这，我基本上对有关博客的一些基本操作都有了简单的介绍，当然其中还有很多细节没提到，大家可以自己根据网上的其他教程对自己的主题做进一步完善。最后，祝愿大家能收获一个满意的个人网站！</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/2018072714491746897.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用hexo+Gitee搭建个人网站</title>
      <link href="built-blog-1/"/>
      <url>built-blog-1/</url>
      
        <content type="html"><![CDATA[<h2 id="为什么要搭建个人网站"><a href="#为什么要搭建个人网站" class="headerlink" title="为什么要搭建个人网站"></a>为什么要搭建个人网站</h2><p>个人网站用处有很多，可以写博客来记录学习过程中的各种事，不管是新知识还是踩坑记录，写完就丢在网站上，方便日后复习，也可以共享给他人，让其他人避免踩雷。</p><p>当然也不仅限于技术性的文章，生活中有什么感想，都可以记录在博客中，记录一次出行、聊一聊美好的爱情，统统不在话下。</p><p>个人感觉，搭建个人网站还有一个不错的好处，就是可以锻炼我们解决问题的能力，博客搭建肯定不是一帆风顺，会遇到各种各样的小问题，有很多细节需要自己去打磨，在打磨的过程中，咱们解决问题的能力总会有提升。如果你觉得很麻烦，也可以选择现有的技术交流平台写博客，比如csdn、博客园等。但是我个人感觉，使用这些平台相比起搭建个人网站就少了很多个性，功能比较局限，不像个人网站，可拓展性很高，比如可以加入外链播放器、天气挂件等等。</p><p>所以，我还是推荐大家搭建一个属于自己的个人网站。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1603013081576.jpg"></p><h2 id="搭建方案选择"><a href="#搭建方案选择" class="headerlink" title="搭建方案选择"></a>搭建方案选择</h2><ul><li>Hexo框架+GitHub  page、Gitee  page、coding  page（推荐选择）</li><li>Gridea软件+GitHub  page、Gitee  page、coding  page</li><li>其他框架：<a href="http://jekyllrb.com/" target="_blank" rel="noopener">jekyll</a>，<a href="https://cn.wordpress.org/" target="_blank" rel="noopener">WordPress</a>。。。。。。</li></ul><p>本文主要介绍第一种方案，第二种方案也可以选取，后边会做简单介绍。</p><h2 id="预备工作"><a href="#预备工作" class="headerlink" title="预备工作"></a>预备工作</h2><ul><li>如果使用hexo框架的话，需要提前安装Git和node.js，安装过程很简单，百度就有很多教程，这里顺便贴一下下载地址：<a href="https://git-scm.com/download/" target="_blank" rel="noopener">Git下载地址</a>、<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">node.js下载地址</a>，安装好之后在cmd中输入<code>npm -v</code>和<code>node -v</code>，如果顺利打印出版本号，则说明node.js安装成功。回到桌面，单击鼠标右键，如果出现下图红框中的选项，则说明Git也安装成功了</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201017165530712.png"></p><ul><li><p>安装好之后还要安装hexo框架，具体步骤如下：</p><ol><li><p>找一个你想存放自己博客的位置，随便哪儿都行，新建一个文件夹，名字随便起，”myblogs”、”Blog_by_hexo”之类的，啥啥啥都行，自由发挥，这里以myblogs为例。</p></li><li><p>然后进入你刚才新建的文件夹，单机鼠标右键，选择<code>Git Bash Here</code>选项，然后在弹出的窗口中依次输入下面的命令：</p><pre class=" language-bash"><code class="language-bash">//第一条   安装hexo的基础框架，如果很慢的话，可以考虑挂下梯子，或者换个源<span class="token function">npm</span> <span class="token function">install</span> -g hexo//第二条   初始化hexo框架 这个可能会比较慢hexo init//第三条 安装所需要的组件<span class="token function">npm</span> <span class="token function">install</span>//第四条 编译生成静态页面hexo g//第五条 启动本地服务hexo s</code></pre></li><li><p>上述指令执行完之后，会看到显示如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018174735603.png"></p><p>此时本地的博客框架就搭好了，在浏览器中打开上图中的网址即可看到如下界面</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/18313053-7deab09a58f4396a.png"></p></li></ol></li></ul><h2 id="博客的部署"><a href="#博客的部署" class="headerlink" title="博客的部署"></a>博客的部署</h2><h3 id="为什么选择Gitee"><a href="#为什么选择Gitee" class="headerlink" title="为什么选择Gitee"></a>为什么选择Gitee</h3><p>博客肯定不能只丢在本地，我们得将它部署到GitHub上或者Gitee上，达到可多终端访问的目的。这里以部署到Gitee为例子，因为我用的梯子不是很稳定，怕到时候现场示范会垮掉，所以就用Gitee来做示范吧😂，况且它服务器在国内，访问速度快啊，国产版GitHub也挺好用的。进入正题：</p><h3 id="建立代码托管仓库"><a href="#建立代码托管仓库" class="headerlink" title="建立代码托管仓库"></a>建立代码托管仓库</h3><ol><li><p>首先进入码云的官网，注册一个账号，其他信息如实填写即可，注意这个个人空间地址，不要随便填，可以参考下图中的提示，自己精心想一个，想不出来就像我一样直接用名字的拼音吧哈哈哈，这个地址后续也可以修改的，大家想好了可以去个人设置里边进行修改。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018180841209.png"></p></li><li><p>注册好之后，就登录进去，然后点击右上角头像左边的那个加号(对我知道你肯定看到了)，然后选择新建仓库，然后各项填写如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018184919287.png"></p><p>上图中归属和路径处显示不一致，嗯我猜是码云的问题😂，没关系，只要下边仓库地址处是一样的就行</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018185856107.png"></p></li><li><p>然后页面会自动跳转到刚才新建的仓库界面，选择<strong>服务</strong>选项，然后选择<code>Gitee pages</code>，如图：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018190255742.png"></p><p>然后在跳转到的页面中，勾选上<strong>强制使用Https</strong>选项，然后点击<strong>启动</strong></p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018190546294.png"></p></li><li><p>然后耐心的等它部署，部署完了之后可以点击他给出的网址进行访问了：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201018191339605.png"></p></li></ol><h3 id="向仓库推送文件"><a href="#向仓库推送文件" class="headerlink" title="向仓库推送文件"></a>向仓库推送文件</h3><p>仓库那边整好了，现在再回到本地来，通过<code>Git Bash</code>向仓库进行文件推送，打开你创建好的存放博客的文件夹，我的是<code>myblogs</code>，现在里边应该有这些东西</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201020183210217.png" alt="" style="zoom:80%;" /><ol><li><p>在编辑站点配置文件之前，我们还要安装一个插件，配合该插件我们才能使用<code>deploy</code>进行部署，插件名为<code> hexo-deployer-git</code>，在<code>myblogs</code>文件下打开<code>Git Bash</code>，输入命令<code>npm install hexo-deployer-git --save</code>即可安装。</p></li><li><p>安装好插件之后我们要生成SSH添加到Gitee，还是在<code>Git Bash</code>中操作：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> config --global user.name <span class="token string">"用户名"</span>// 设置提交文件时的用户名<span class="token function">git</span> config --global user.email <span class="token string">"邮箱"</span>// 设置提交文件时的邮箱//设置好之后，可用如下命令查看是否有误<span class="token function">git</span> config user.name<span class="token function">git</span> config user.email</code></pre><p>只有如上设置，你推送文件的时候，Gitee才知道是谁推送的文件，然后来生成SSH，添加到Gitee</p><pre class=" language-bash"><code class="language-bash">ssh-keygen -t rsa -C <span class="token string">"邮箱"</span>// 如果想自定义ssh的名字，可以这样生成一个名为test的密钥ssh-keygen -t rsa -C <span class="token string">"邮箱"</span> -f ~/.ssh/test</code></pre><p>执行之后，一路回车，出现如下界面就表示成功生成了SSH<img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021152832960.png" alt=""  /></p><p>然后打开上图中框出的<code>.ssh</code>文件夹，可以看到有两个文件夹，<code>id_rsa</code>和<code>id_rsa.pub</code>，前者是私有的，自个保存好就行，后者就是SSH公钥，用<code>notepad++</code>打开<code>id_rsa.pub</code>文件，将里边的内容全复制到剪贴板。（在这里推荐大家安装<code>notepad++</code>这款软件，体积很小，能打开的文件格式超级多，具体的安装没啥复杂的，大家可以百度。）</p><p>紧接着来到Gitee的登陆界面，点击右上角头像，选择设置，在安全设置中选择<code>SSH公钥</code>，然后选择添加公钥，标题随便写一个，公钥部分就把你刚才复制的内容给贴进去，然后点击确定即可<img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021155906876.png"></p><p>添加好之后，可以使用命令<code>ssh -T git@gitee.com</code>来验证本机是否与Gitee服务器连接成功，出现下图则表示成功了</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021160453096.png" alt="" style="zoom:80%;" /></li><li><p>前两步成功之后打开<code>_config.yml</code>，直接拉到最底下，找到<code>deploy</code>，这里就是我们设置推送到哪个仓库的地方。</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201020184957151.png"></p><p>修改<code>deploy</code>选项如下：</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> git@gitee.com<span class="token punctuation">:</span>inspur<span class="token punctuation">-</span>club/inspur<span class="token punctuation">-</span>club.git  <span class="token key atrule">branch</span><span class="token punctuation">:</span> master//注意，冒号后边要有一个空格，这是yaml语法</code></pre><p>填写repo的时候，有个小技巧，我们只需要选择克隆或下载仓库，选择<code>SSH</code>，将内容复制下来粘贴到repo选项后即可，如下图所示：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021163002580.png" alt="" style="zoom:80%;" /></li><li><p>修改好配置文件后，<code>ctrl+s</code>保存，然后就可以利用<code>Git Bash</code>向仓库推送文件啦，还是在<code>myblogs</code>文件夹下打开<code>Git Bash</code>，执行以下命令</p><pre class=" language-bash"><code class="language-bash">// 清除缓存以及public文件夹，public文件夹里的东西就是真正被推送到仓库里的东西，每次修改配置文件后都要执行该命令hexo clean// 生成静态页面文件，每次clean后也要重新生成hexo g// 向仓库推送文件hexo d</code></pre></li></ol><p>执行完如果出现如下界面则表示推送文件成功：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021164439172.png" alt="" style="zoom:80%;" /><p>也可以去仓库刷新一下，如果多了很多文件，最近提交时间为刚刚，也可以说明推送文件成功：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021164753537.png" alt="" style="zoom:80%;" /><h2 id="更新Gitee-pages"><a href="#更新Gitee-pages" class="headerlink" title="更新Gitee pages"></a>更新Gitee pages</h2><p>如果你是部署到GitHub或者coding上的话，请忽略这一步，它们俩会自动更新网站内容，只有Gitee pages需要手动更新：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021165604810.png" alt="" style="zoom:80%;" /><p>更新完之后再次访问网站地址，如下：</p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/image-20201021170921703.png" alt="" style="zoom:80%;" /><p>如果你选购了Gitee pages pro，他是支持自动更新的，也可以忽略这一步，但白嫖党怎么能就此屈服，我找到了一点资料，大伙有兴趣可以去看看，<a href="https://cjh0613.com/20200511GiteePageAuto.html" target="_blank" rel="noopener">戳我查看</a>。</p><p>其实我每次都是手动更新的，主要是因为我比较懒，没有经常写博客的习惯，啥时候兴致来了就写，所以每次都去点一下更新就我个人而言也还能接受😂😂😂。</p><h2 id="如何写文章"><a href="#如何写文章" class="headerlink" title="如何写文章"></a>如何写文章</h2><p>写文章要用到<code>markdown</code>，这是一种轻量的标记型语言，语法超级简单，在这里就不细讲了，给大家推荐学习<code>markdown</code>的网站是<a href="https://www.runoob.com/markdown/md-tutorial.html" target="_blank" rel="noopener">菜鸟教程</a>，这个网站有超级多其他教程，大家可以收藏，以后也许能用到。</p><h2 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h2><p>嗯，到这基本上博客的搭建已经接近尾声了，你已经拥有属于自己的个人网站了。</p><p>但其实这才刚刚开始，更重要的是丰富博客的内容，更改一些基本配置，就比如换个主题啊，给自己的网站取个名字、换个背景图等等。总之，还有很多细节需要不断去发现，不断去优化，如果你很注重细节，你会发现优化博客还是需要做蛮多事的。网上教程资源很多，希望大家善于利用。</p><p>另外说一下，GitHub是支持绑定域名的，Gitee pages就不支持（坑爹啊），新域名(.top，.club，.xyz)一般不贵，我很推荐大家买一个域名，逼格瞬间上来了有木有？</p><p>最后希望大家能在这次的分享中有所收获，回去了也可以用hexo+GitHub再搭一次，跟Gitee很类似，算是再练练手。</p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fisher线性判别+KNN分类</title>
      <link href="fisher/"/>
      <url>fisher/</url>
      
        <content type="html"><![CDATA[<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li><p>pycharm专业版2019.3.3</p></li><li><p>python3.7.4</p></li><li><p>外部库：numpy=1.16.5；sklearn=0.21.3；matplotlib=3.3.1；openpyxl=3.0.0</p></li></ul><h3 id="原理简介"><a href="#原理简介" class="headerlink" title="原理简介"></a>原理简介</h3><p>将一个一个复杂的高维分类问题，先通过fisher线性判别分析进行降维，降到低纬之后，再通过KNN算法进行分类</p><h3 id="一些计算公式"><a href="#一些计算公式" class="headerlink" title="一些计算公式"></a>一些计算公式</h3><h4 id="在n维X空间"><a href="#在n维X空间" class="headerlink" title="在n维X空间"></a>在n维X空间</h4><ul><li>各类样本均值向量$\mu_{i}$:</li></ul><p>$$<br>\mu_{i}=\dfrac{1}{N_{i}}\sum_{x_{j}\in\Omega_{i}}x_{j},i=1,2<br>$$</p><ul><li>各类类内离散度矩阵$S_{i}$:</li></ul><p>$$<br>S_{i}=\sum_{x_{j}\in\Omega_{i}}\left( x_{j}-\mu_{i}\right) \left( x_{j}-\mu_{i}\right) ^{T},i=1,2<br>$$</p><ul><li>总类内离散度矩阵$S_{w}$:</li></ul><p>$$<br>S_{w}=\sum_{x_{j}\in \Omega_{i}}S_{i},i=1,2<br>$$</p><ul><li>二分类情况下样本类间离散度矩阵$S_{b}$:</li></ul><p>$$<br>S_{b}=(\mu_{1}-\mu_{2})(\mu_{1}-\mu_{2})^{T}<br>$$</p><ul><li>多分类情况下的样本类间离散度矩阵$S_b$:<br>$$<br>S_b=\sum_{i=1,2,…c}{N_i}(\mu_i-\mu)(\mu_i-\mu)^{T}<br>$$<br>其中$\mu$是所有样本的均值</li></ul><h4 id="Y空间"><a href="#Y空间" class="headerlink" title="Y空间"></a>Y空间</h4><ul><li>各类样本均值$\overline{\mu_{i}}$:</li></ul><p>$$<br>\overline{\mu_{i}}=\dfrac{1}{N_{i}}\sum_{y_{j}\in \psi_{i}}y_{j},i=1,2<br>$$</p><ul><li><p>各类内离散度$\overline{S^2_{i}}$:<br>$$<br>\overline{S_{i}}^{2}=\sum_{y_{j}\in \psi_{i}}\left( y_{j}-\overline\mu_{i}\right)^{2},i=1,2<br>$$</p></li><li><p>二分类情况下降到一维最佳投影方向$\omega^*$:<br>$$<br>\omega^*=S_\omega^-1(\mu_{1}-\mu_{2})<br>$$</p></li></ul><ul><li><p>降到二维的最佳投影方向${\omega}^*$:</p><p>$$<br>S_{w}^{-1}S_{b}\omega^*=\lambda\omega^*<br>$$</p><p>根据式子(9)计算出特征值$\lambda$，取最大的前两个特征值所对应的特征向量，将其组合在一起，即为所求的最佳投影方向，式(9)中的$S_b$由式(5)计算得来</p></li></ul><h4 id="评价指标"><a href="#评价指标" class="headerlink" title="评价指标"></a>评价指标</h4><ul><li><p>总体分类精度OA：<br>$$<br>\frac{所有判断正确的样本数}{所有测试样本数}\times100%<br>$$</p></li><li><p>类别分类精度AA:<br>$$<br>\frac{某一类中判断正确的样本数}{该类参与测试的样本数}\times100%<br>$$</p></li><li><p>kappa系数:<br>$$<br>\frac{OA-pe}{1-pe}<br>$$</p></li><li><p>pe:<br>$$<br>\frac{\sum{(某类参与测试的样本数\times{被判断为该类的测试样本数})}}{所有的测试样本数^2}<br>$$</p></li></ul><h3 id="数据标准化"><a href="#数据标准化" class="headerlink" title="数据标准化"></a>数据标准化</h3><p>由于两种数据集中特征的量纲都一样，所以为了消除量纲，将每个特征的数值除以该特征中的最大值即可，这样将所有特征数值映射到了区间[0,1]之间</p><h3 id="划分训练集和测试集"><a href="#划分训练集和测试集" class="headerlink" title="划分训练集和测试集"></a>划分训练集和测试集</h3><p>利用sklearn包中的train_test_split函数进行训练集和测试集的划分，其中训练集占比40%，测试集占比60%。</p><p>其中train_test_split函数的一般形式如下：</p><pre class=" language-python"><code class="language-python">X_train<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span>train_test_split<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span>train_target<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><p>参数解释：</p><ul><li><p><strong>train_data：</strong>所要划分的样本特征集</p></li><li><p><strong>train_target：</strong>所要划分的样本结果集</p></li><li><p><strong>test_size：</strong>测试样本占比，如果是整数的话就是样本的数量</p></li><li><p><strong>random_state：</strong>是随机数的种子</p></li><li><p><strong>随机种子：</strong>其实就是该组随机数的编号，在需要重复试验的时候，保证得到一组一样的随机数</p></li></ul><p>通过该函数，只要每次传入不同的随机种子，就可以得到不同的训练集、测试集</p><h3 id="分类策略"><a href="#分类策略" class="headerlink" title="分类策略"></a>分类策略</h3><ol><li><p>sonar数据集</p><p>sonar数据集为一个二分类问题，只需要计算出最优投影方向，投影后：</p><ul><li>方案一：将样本降到一维，计算出决策点，再进行分类</li><li>方案二：将样本降到2维，通过KNN算法进行分类</li></ul></li><li><p>iris数据集</p><p>iris数据集为一个三分类问题</p><ul><li><p>方案一：可以将其转化为三个二分类问题进行分类，具体分类思路如下：</p><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/Snipaste_2020-10-17_01-04-19.jpg"></p></li><li><p>方案二：将样本降到二维，再通过KNN算法进行分类</p></li></ul></li></ol><h3 id="K值的选择"><a href="#K值的选择" class="headerlink" title="K值的选择"></a>K值的选择</h3><p>KNN分类算法中，需要我们提前指定k的值，本次试验的k值选取过程如下：</p><ul><li><p>先构建好分类器</p></li><li><p>对于iris数据集，k分别取值为$4,5,7,8,10,11,13,14,16,17,19,20,22,23$，求出对应的OA值，取最大的OA值对应的k值为最终的k值</p></li><li><p>对于sonar数据集，k分别取值为$3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35$，求出对应的OA值，取最大的OA值对应的k值为最终的k值</p></li></ul><p>得到的结果如下：</p><ul><li>sonar：</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/k_OA_sonar.jpg"></p><ul><li>iris：</li></ul><p><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/k_OA.jpg"></p><p>由上图可知，两数据集都取<strong>k=5</strong>分类效果最好</p><h3 id="分类结果展示"><a href="#分类结果展示" class="headerlink" title="分类结果展示"></a>分类结果展示</h3><h4 id="sonar数据集"><a href="#sonar数据集" class="headerlink" title="sonar数据集"></a>sonar数据集</h4><ol><li><p><strong>分类方案1：</strong></p><table><thead><tr><th align="center">试验次数</th><th align="center">整体分类精度OA</th><th align="center">kappa系数</th><th align="center">第一类类别分类精度AA</th><th align="center">第二类类别分类精度AA</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">0.603</td><td align="center">0.213</td><td align="center">0.678</td><td align="center">0.537</td></tr><tr><td align="center">2</td><td align="center">0.690</td><td align="center">0.370</td><td align="center">0.559</td><td align="center">0.806</td></tr><tr><td align="center">3</td><td align="center">0.690</td><td align="center">0.380</td><td align="center">0.695</td><td align="center">0.687</td></tr><tr><td align="center">4</td><td align="center">0.587</td><td align="center">0.171</td><td align="center">0.559</td><td align="center">0.612</td></tr><tr><td align="center">5</td><td align="center">0.690</td><td align="center">0.385</td><td align="center">0.763</td><td align="center">0.627</td></tr><tr><td align="center">6</td><td align="center">0.698</td><td align="center">0.389</td><td align="center">0.610</td><td align="center">0.776</td></tr><tr><td align="center">7</td><td align="center">0.675</td><td align="center">0.355</td><td align="center">0.763</td><td align="center">0.597</td></tr><tr><td align="center">8</td><td align="center">0.683</td><td align="center">0.371</td><td align="center">0.780</td><td align="center">0.597</td></tr><tr><td align="center">9</td><td align="center">0.706</td><td align="center">0.410</td><td align="center">0.678</td><td align="center">0.731</td></tr><tr><td align="center">10</td><td align="center">0.690</td><td align="center">0.383</td><td align="center">0.729</td><td align="center">0.657</td></tr><tr><td align="center">11</td><td align="center">0.643</td><td align="center">0.284</td><td align="center">0.627</td><td align="center">0.657</td></tr><tr><td align="center">12</td><td align="center">0.730</td><td align="center">0.467</td><td align="center">0.847</td><td align="center">0.627</td></tr><tr><td align="center">13</td><td align="center">0.643</td><td align="center">0.279</td><td align="center">0.576</td><td align="center">0.701</td></tr><tr><td align="center">14</td><td align="center">0.683</td><td align="center">0.353</td><td align="center">0.542</td><td align="center">0.806</td></tr><tr><td align="center">15</td><td align="center">0.675</td><td align="center">0.351</td><td align="center">0.712</td><td align="center">0.642</td></tr><tr><td align="center">16</td><td align="center">0.603</td><td align="center">0.198</td><td align="center">0.525</td><td align="center">0.672</td></tr><tr><td align="center">17</td><td align="center">0.794</td><td align="center">0.589</td><td align="center">0.847</td><td align="center">0.746</td></tr><tr><td align="center">18</td><td align="center">0.611</td><td align="center">0.223</td><td align="center">0.627</td><td align="center">0.597</td></tr><tr><td align="center">19</td><td align="center">0.627</td><td align="center">0.246</td><td align="center">0.542</td><td align="center">0.701</td></tr><tr><td align="center">20</td><td align="center">0.778</td><td align="center">0.551</td><td align="center">0.712</td><td align="center">0.836</td></tr><tr><td align="center">21</td><td align="center">0.675</td><td align="center">0.358</td><td align="center">0.797</td><td align="center">0.567</td></tr><tr><td align="center">22</td><td align="center">0.683</td><td align="center">0.365</td><td align="center">0.695</td><td align="center">0.672</td></tr><tr><td align="center">23</td><td align="center">0.754</td><td align="center">0.500</td><td align="center">0.644</td><td align="center">0.851</td></tr><tr><td align="center">24</td><td align="center">0.738</td><td align="center">0.475</td><td align="center">0.729</td><td align="center">0.746</td></tr><tr><td align="center">25</td><td align="center">0.730</td><td align="center">0.460</td><td align="center">0.746</td><td align="center">0.716</td></tr><tr><td align="center">26</td><td align="center">0.667</td><td align="center">0.335</td><td align="center">0.695</td><td align="center">0.642</td></tr><tr><td align="center">27</td><td align="center">0.667</td><td align="center">0.333</td><td align="center">0.678</td><td align="center">0.657</td></tr><tr><td align="center">28</td><td align="center">0.706</td><td align="center">0.417</td><td align="center">0.780</td><td align="center">0.642</td></tr><tr><td align="center">29</td><td align="center">0.754</td><td align="center">0.508</td><td align="center">0.780</td><td align="center">0.731</td></tr><tr><td align="center">30</td><td align="center">0.730</td><td align="center">0.462</td><td align="center">0.780</td><td align="center">0.687</td></tr><tr><td align="center"><strong>平均值</strong></td><td align="center"><strong>0.687</strong></td><td align="center"><strong>0.373</strong></td><td align="center"><strong>0.690</strong></td><td align="center"><strong>0.684</strong></td></tr></tbody></table></li></ol><ol start="2"><li><p><strong>分类方案2：</strong></p><table><thead><tr><th align="center">试验次数</th><th align="center">整体分类精度OA</th><th align="center"><strong>kappa系数</strong></th><th align="center">第一类类别分类精度AA</th><th align="center">第二类类别分类精度AA</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">0.627</td><td align="center">0.252</td><td align="center">0.610</td><td align="center">0.642</td></tr><tr><td align="center">2</td><td align="center">0.603</td><td align="center">0.205</td><td align="center">0.593</td><td align="center">0.612</td></tr><tr><td align="center">3</td><td align="center">0.754</td><td align="center">0.505</td><td align="center">0.729</td><td align="center">0.776</td></tr><tr><td align="center">4</td><td align="center">0.643</td><td align="center">0.278</td><td align="center">0.559</td><td align="center">0.716</td></tr><tr><td align="center">5</td><td align="center">0.548</td><td align="center">0.087</td><td align="center">0.475</td><td align="center">0.612</td></tr><tr><td align="center">6</td><td align="center">0.683</td><td align="center">0.361</td><td align="center">0.644</td><td align="center">0.716</td></tr><tr><td align="center">7</td><td align="center">0.683</td><td align="center">0.361</td><td align="center">0.644</td><td align="center">0.716</td></tr><tr><td align="center">8</td><td align="center">0.690</td><td align="center">0.377</td><td align="center">0.644</td><td align="center">0.731</td></tr><tr><td align="center">9</td><td align="center">0.603</td><td align="center">0.200</td><td align="center">0.542</td><td align="center">0.657</td></tr><tr><td align="center">10</td><td align="center">0.690</td><td align="center">0.379</td><td align="center">0.678</td><td align="center">0.701</td></tr><tr><td align="center">11</td><td align="center">0.683</td><td align="center">0.361</td><td align="center">0.644</td><td align="center">0.716</td></tr><tr><td align="center">12</td><td align="center">0.508</td><td align="center">0.014</td><td align="center">0.492</td><td align="center">0.522</td></tr><tr><td align="center">13</td><td align="center">0.683</td><td align="center">0.361</td><td align="center">0.644</td><td align="center">0.716</td></tr><tr><td align="center">14</td><td align="center">0.595</td><td align="center">0.186</td><td align="center">0.559</td><td align="center">0.627</td></tr><tr><td align="center">15</td><td align="center">0.556</td><td align="center">0.108</td><td align="center">0.525</td><td align="center">0.582</td></tr><tr><td align="center">16</td><td align="center">0.627</td><td align="center">0.256</td><td align="center">0.661</td><td align="center">0.597</td></tr><tr><td align="center">17</td><td align="center">0.587</td><td align="center">0.170</td><td align="center">0.542</td><td align="center">0.627</td></tr><tr><td align="center">18</td><td align="center">0.683</td><td align="center">0.363</td><td align="center">0.661</td><td align="center">0.701</td></tr><tr><td align="center">19</td><td align="center">0.690</td><td align="center">0.379</td><td align="center">0.678</td><td align="center">0.701</td></tr><tr><td align="center">20</td><td align="center">0.563</td><td align="center">0.112</td><td align="center">0.424</td><td align="center">0.687</td></tr><tr><td align="center">21</td><td align="center">0.746</td><td align="center">0.484</td><td align="center">0.627</td><td align="center">0.851</td></tr><tr><td align="center">22</td><td align="center">0.571</td><td align="center">0.138</td><td align="center">0.525</td><td align="center">0.612</td></tr><tr><td align="center">23</td><td align="center">0.651</td><td align="center">0.297</td><td align="center">0.610</td><td align="center">0.687</td></tr><tr><td align="center">24</td><td align="center">0.595</td><td align="center">0.190</td><td align="center">0.593</td><td align="center">0.597</td></tr><tr><td align="center">25</td><td align="center">0.675</td><td align="center">0.341</td><td align="center">0.576</td><td align="center">0.761</td></tr><tr><td align="center">26</td><td align="center">0.603</td><td align="center">0.198</td><td align="center">0.525</td><td align="center">0.672</td></tr><tr><td align="center">27</td><td align="center">0.635</td><td align="center">0.261</td><td align="center">0.542</td><td align="center">0.716</td></tr><tr><td align="center">28</td><td align="center">0.587</td><td align="center">0.173</td><td align="center">0.576</td><td align="center">0.597</td></tr><tr><td align="center">29</td><td align="center">0.667</td><td align="center">0.331</td><td align="center">0.644</td><td align="center">0.687</td></tr><tr><td align="center">30</td><td align="center">0.611</td><td align="center">0.214</td><td align="center">0.525</td><td align="center">0.687</td></tr><tr><td align="center"><strong>平均值</strong></td><td align="center"><strong>0.635</strong></td><td align="center"><strong>0.365</strong></td><td align="center"><strong>0.590</strong></td><td align="center"><strong>0.674</strong></td></tr></tbody></table></li></ol><h4 id="iris数据集"><a href="#iris数据集" class="headerlink" title="iris数据集"></a>iris数据集</h4><ol><li><p><strong>分类方案1：</strong></p><table><thead><tr><th align="center">实验次数</th><th align="center">整体分类精度OA</th><th align="center">kappa系数</th><th align="center">类别分类精度AA（依次为第1，2，3类）</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.767     0.933</td></tr><tr><td align="center">2</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00     0.800     0.933</td></tr><tr><td align="center">3</td><td align="center">0.833</td><td align="center">0.750</td><td align="center">1.00     0.800     0.700</td></tr><tr><td align="center">4</td><td align="center">0.956</td><td align="center">0.933</td><td align="center">1.00     0.900     0.967</td></tr><tr><td align="center">5</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00     0.900     0.867</td></tr><tr><td align="center">6</td><td align="center">0.967</td><td align="center">0.950</td><td align="center">1.00     0.900     1.000</td></tr><tr><td align="center">7</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.800     0.900</td></tr><tr><td align="center">8</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00     0.900     0.933</td></tr><tr><td align="center">9</td><td align="center">0.933</td><td align="center">0.900</td><td align="center">1.00     0.967     0.833</td></tr><tr><td align="center">10</td><td align="center">0.956</td><td align="center">0.933</td><td align="center">1.00     0.933     0.933</td></tr><tr><td align="center">11</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.833     0.867</td></tr><tr><td align="center">12</td><td align="center">0.822</td><td align="center">0.733</td><td align="center">1.00     0.667     0.800</td></tr><tr><td align="center">13</td><td align="center">0.833</td><td align="center">0.75</td><td align="center">1.00     0.800     0.700</td></tr><tr><td align="center">14</td><td align="center">0.967</td><td align="center">0.950</td><td align="center">1.00     0.933     0.967</td></tr><tr><td align="center">15</td><td align="center">0.878</td><td align="center">0.817</td><td align="center">1.00     0.633     1.000</td></tr><tr><td align="center">16</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00     0.933     0.833</td></tr><tr><td align="center">17</td><td align="center">0.644</td><td align="center">0.467</td><td align="center">1.00     0.433     0.500</td></tr><tr><td align="center">18</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.833     0.867</td></tr><tr><td align="center">19</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.867     0.833</td></tr><tr><td align="center">20</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00     0.867     0.800</td></tr><tr><td align="center">21</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.900     0.800</td></tr><tr><td align="center">22</td><td align="center">0.900</td><td align="center">0.850</td><td align="center">1.00     0.833     0.867</td></tr><tr><td align="center">23</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00     0.967     0.767</td></tr><tr><td align="center">24</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00     0.833     1.000</td></tr><tr><td align="center">25</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00     0.967     0.867</td></tr><tr><td align="center">26</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">0.97     0.867     0.933</td></tr><tr><td align="center">27</td><td align="center">0.956</td><td align="center">0.933</td><td align="center">1.00     0.900     0.967</td></tr><tr><td align="center">28</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00     0.900     0.867</td></tr><tr><td align="center">29</td><td align="center">0.956</td><td align="center">0.933</td><td align="center">1.00     0.933     0.933</td></tr><tr><td align="center">30</td><td align="center">0.878</td><td align="center">0.817</td><td align="center">1.00     0.767     0.867</td></tr><tr><td align="center"><strong>平均值</strong></td><td align="center"><strong>0.904</strong></td><td align="center"><strong>0.856</strong></td><td align="center"><strong>0.999       0.844       0.868</strong></td></tr></tbody></table></li></ol><ol start="2"><li><p><strong>分类方案二</strong>：</p><table><thead><tr><th align="center">试验次数</th><th align="center">整体分类精度OA</th><th align="center">kappa系数</th><th align="center">类别分类精度AA（依次为第1，2，3类）</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.900   0.867</td></tr><tr><td align="center">2</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.933  0.833</td></tr><tr><td align="center">3</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.900   0.767</td></tr><tr><td align="center">4</td><td align="center">0.933</td><td align="center">0.9</td><td align="center">1.00    0.900    0.900</td></tr><tr><td align="center">5</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00   0.933   0.800</td></tr><tr><td align="center">6</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.933   0.833</td></tr><tr><td align="center">7</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00    0.933   0.900</td></tr><tr><td align="center">8</td><td align="center">0.9</td><td align="center">0.85</td><td align="center">1.00    0.867   0.833</td></tr><tr><td align="center">9</td><td align="center">0.9</td><td align="center">0.85</td><td align="center">1.00    0.867   0.833</td></tr><tr><td align="center">10</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.900    0.767</td></tr><tr><td align="center">11</td><td align="center">0.933</td><td align="center">0.9</td><td align="center">1.00    0.967   0.833</td></tr><tr><td align="center">12</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.833   0.833</td></tr><tr><td align="center">13</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.900   0.767</td></tr><tr><td align="center">14</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.900   0.867</td></tr><tr><td align="center">15</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.867   0.900</td></tr><tr><td align="center">16</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00    0.900   0.833</td></tr><tr><td align="center">17</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00    0.867    0.867</td></tr><tr><td align="center">18</td><td align="center">0.867</td><td align="center">0.8</td><td align="center">1.00    0.867    0.733</td></tr><tr><td align="center">19</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00    0.967    0.867</td></tr><tr><td align="center">20</td><td align="center">0.9</td><td align="center">0.85</td><td align="center">1.00    0.833    0.867</td></tr><tr><td align="center">21</td><td align="center">0.956</td><td align="center">0.933</td><td align="center">1.00    0.933    0.933</td></tr><tr><td align="center">22</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.933    0.733</td></tr><tr><td align="center">23</td><td align="center">0.922</td><td align="center">0.883</td><td align="center">1.00    0.933   0.833</td></tr><tr><td align="center">24</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00    0.900    0.933</td></tr><tr><td align="center">25</td><td align="center">0.9</td><td align="center">0.85</td><td align="center">1.00    0.967   0.733</td></tr><tr><td align="center">26</td><td align="center">0.867</td><td align="center">0.8</td><td align="center">1.00    0.867   0.733</td></tr><tr><td align="center">27</td><td align="center">0.889</td><td align="center">0.833</td><td align="center">1.00    0.833   0.833</td></tr><tr><td align="center">28</td><td align="center">0.911</td><td align="center">0.867</td><td align="center">1.00    0.900   0.833</td></tr><tr><td align="center">29</td><td align="center">0.944</td><td align="center">0.917</td><td align="center">1.00    0.967  0.867</td></tr><tr><td align="center">30</td><td align="center">0.867</td><td align="center">0.8</td><td align="center">1.00    0.800     0.800</td></tr><tr><td align="center"><strong>平均值</strong></td><td align="center"><strong>0.910</strong></td><td align="center"><strong>0.886</strong></td><td align="center"><strong>1.00    0.900  0.831</strong></td></tr></tbody></table></li></ol><h3 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h3><ol><li><p>sonar</p><p>从结果可以看出，sonar数据集的分类精度并不理想，分类方案一只有68.7%，分类方案二为63.5%，kappa系数也只有0.373、0.365，这说明分类效果较为一般，个人认为分类效果一般的原因如下：</p><p>sonar数据集的维度较高，足足有60维，而我们直接将其降到了较低的维度，降维的过程中避免不了有效信息的损失，有可能是因为有效信息损失过多，导致分类效果不理想。</p><p>可行的改进方法是降成不算太低的维度进行分类。</p></li><li><p>iris数据集</p><p>从结果可以看出，三分类的准确率方案一达到了90.4%，方案二为91.0%，kappa系数达到了0.856、0.886，说明分类效果很好，与实际情况几乎完全一致。</p><p>类别分类精度中第一类的精度最高，二三类稍低一点，可以看出：第一类鸢尾花在四个特征上与另外两类有较为明显的差别，很容易跟另外两类区分开来；而第二三类可能是在四个特征上的差别没有特别明显，所以分类精度会有所下降。</p></li></ol><h3 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h3><h4 id="鸢尾花数据集分类（数据来源于sklearn内部封装的数据集）"><a href="#鸢尾花数据集分类（数据来源于sklearn内部封装的数据集）" class="headerlink" title="鸢尾花数据集分类（数据来源于sklearn内部封装的数据集）"></a>鸢尾花数据集分类（数据来源于sklearn内部封装的数据集）</h4><ol><li><strong>分类方案一：</strong></li></ol><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> random<span class="token comment" spellcheck="true"># 计算并返回均值向量</span><span class="token keyword">def</span> <span class="token function">junzhi</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span class="token comment" spellcheck="true"># 计算类内离散度矩阵S_i</span><span class="token keyword">def</span> <span class="token function">S_i</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>iris<span class="token punctuation">)</span>    b <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        b <span class="token operator">=</span> b <span class="token operator">+</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">(</span>iris<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>iris<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> b<span class="token comment" spellcheck="true"># 计算类间离散度矩阵S_w</span><span class="token keyword">def</span> <span class="token function">S_w</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> iris2<span class="token punctuation">)</span><span class="token punctuation">:</span>    b_1 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>iris1<span class="token punctuation">)</span>    b_2 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>iris2<span class="token punctuation">)</span>    c <span class="token operator">=</span> b_1 <span class="token operator">+</span> b_2    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 划分训练集、测试集的函数</span><span class="token keyword">def</span> <span class="token function">train_test</span><span class="token punctuation">(</span>iris<span class="token punctuation">,</span> target<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_iris<span class="token punctuation">,</span> test_iris<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span>\        train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>num<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'train_iris'</span><span class="token punctuation">:</span> train_iris<span class="token punctuation">,</span> <span class="token string">'test_iris'</span><span class="token punctuation">:</span> test_iris<span class="token punctuation">,</span> <span class="token string">'train_target'</span><span class="token punctuation">:</span> train_target<span class="token punctuation">,</span> <span class="token string">'test_target'</span><span class="token punctuation">:</span> test_target<span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 计算出最优的投影方向并计算出决策点</span><span class="token keyword">def</span> <span class="token function">best_w</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> iris2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_iris1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_iris'</span><span class="token punctuation">]</span>    train_iris2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_iris'</span><span class="token punctuation">]</span>    s_0 <span class="token operator">=</span> S_w<span class="token punctuation">(</span>train_iris1<span class="token punctuation">,</span> train_iris2<span class="token punctuation">)</span>    best_w <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>s_0<span class="token punctuation">)</span><span class="token punctuation">,</span> junzhi<span class="token punctuation">(</span>train_iris1<span class="token punctuation">)</span> <span class="token operator">-</span> junzhi<span class="token punctuation">(</span>train_iris2<span class="token punctuation">)</span><span class="token punctuation">)</span>    y_0 <span class="token operator">=</span> <span class="token number">0.5</span><span class="token operator">*</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>train_iris1<span class="token punctuation">,</span> best_w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token operator">*</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>train_iris2<span class="token punctuation">,</span> best_w<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(best_w)</span>    <span class="token keyword">return</span> best_w<span class="token punctuation">,</span> y_0<span class="token comment" spellcheck="true"># 对测试样本进行分类并计算相关评价指标</span><span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># print(num)</span>    <span class="token comment" spellcheck="true">## 训练集得到的最佳方向和决策点</span>    w_best12<span class="token punctuation">,</span>y0_12<span class="token operator">=</span>best_w<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> iris2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span>    w_best13<span class="token punctuation">,</span>y0_13<span class="token operator">=</span>best_w<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> iris3<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target3<span class="token punctuation">,</span> num<span class="token punctuation">)</span>    w_best23<span class="token punctuation">,</span>y0_23<span class="token operator">=</span>best_w<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span> iris3<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> target3<span class="token punctuation">,</span> num<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 测试集</span>    test1<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test2<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test3<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris3<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span>test2<span class="token punctuation">,</span>test3<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 当前测试集对应的标签</span>    test_target1<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target2<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target3<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris3<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target<span class="token operator">=</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test_target1<span class="token punctuation">,</span>test_target2<span class="token punctuation">,</span>test_target3<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test_target)</span>    <span class="token comment" spellcheck="true">## 存放预测得到的标签</span>    predict_target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 先通过第一二类决策函数</span>    y<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test<span class="token punctuation">,</span>w_best12<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">></span>y0_12 <span class="token operator">or</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>y0_12<span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true">## 再通过第一三类决策函数</span>    y<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test<span class="token punctuation">,</span>w_best13<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">></span>y0_13 <span class="token operator">or</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>y0_13<span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token comment" spellcheck="true">## 剩余的通过第二三类决策函数</span>    y<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test<span class="token punctuation">,</span>w_best23<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">></span>y0_23 <span class="token operator">or</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>y0_23<span class="token punctuation">:</span>                predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span>    <span class="token comment" spellcheck="true"># print(predict_target)</span>    <span class="token comment" spellcheck="true">## 计算OA、AA、kappa系数</span>    <span class="token comment" spellcheck="true">### 记录三类样本分类正确的数量</span>    num_1<span class="token operator">=</span><span class="token number">0</span>    num_2<span class="token operator">=</span><span class="token number">0</span>    num_3<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment" spellcheck="true">### 记录三类样本实际分类的数量</span>    real_num_1<span class="token operator">=</span><span class="token number">0</span>    real_num_2<span class="token operator">=</span><span class="token number">0</span>    real_num_3<span class="token operator">=</span><span class="token number">0</span>     <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">## 统计分类正确的数量</span>        <span class="token keyword">if</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_1<span class="token operator">=</span>num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">elif</span> i<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_2<span class="token operator">=</span>num_2<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_3<span class="token operator">=</span>num_3<span class="token operator">+</span><span class="token number">1</span>        <span class="token comment" spellcheck="true">## 统计实际的分类数量</span>        <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>            real_num_1<span class="token operator">=</span>real_num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">elif</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            real_num_2<span class="token operator">=</span>real_num_2<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            real_num_3<span class="token operator">=</span>real_num_3<span class="token operator">+</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(num_1)</span>    <span class="token comment" spellcheck="true">### 计算相关指标</span>    OA<span class="token operator">=</span><span class="token punctuation">(</span>num_1<span class="token operator">+</span>num_2<span class="token operator">+</span>num_3<span class="token punctuation">)</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_1<span class="token operator">=</span>num_1<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_2<span class="token operator">=</span>num_2<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_3<span class="token operator">=</span>num_3<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    pe<span class="token operator">=</span><span class="token punctuation">(</span>real_num_1<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span><span class="token operator">+</span>real_num_2<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span>\        <span class="token operator">+</span>real_num_3<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    kappa<span class="token operator">=</span><span class="token punctuation">(</span>OA<span class="token operator">-</span>pe<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>pe<span class="token punctuation">)</span>    <span class="token keyword">return</span> OA<span class="token punctuation">,</span><span class="token punctuation">[</span>AA_1<span class="token punctuation">,</span>AA_2<span class="token punctuation">,</span>AA_3<span class="token punctuation">]</span><span class="token punctuation">,</span>kappa<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 导入数据并去量纲</span>    data <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>    iris1 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    iris2 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    iris3 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    max_feature<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\        np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    iris1<span class="token operator">=</span>iris1<span class="token operator">/</span>max_feature    iris2<span class="token operator">=</span>iris2<span class="token operator">/</span>max_feature    iris3<span class="token operator">=</span>iris3<span class="token operator">/</span>max_feature    <span class="token comment" spellcheck="true"># 导入标签</span>    target1 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    target2 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    target3 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    <span class="token comment" spellcheck="true"># 存储相关的指标值</span>    OAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    AAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    kappas<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#随机给出30个随机种子，用于train_test函数</span>    <span class="token comment" spellcheck="true"># nums=[703,5205,8248,4998,1027,8528,7063,6513,793,2805,1524,8985,3939,9000\</span>    <span class="token comment" spellcheck="true"># ,3796,3178,628,9359,582,265,5920,8866,7960,5090,5481,4928,526,8763,5333,6596]</span>    nums<span class="token operator">=</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            OAs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>AAs<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>kappas<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>classify<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>            j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span>            k<span class="token operator">=</span>k<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            k<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(OAs)</span>    temp<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> OAs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>            temp<span class="token operator">=</span>temp<span class="token operator">+</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(AAs)</span>    <span class="token comment" spellcheck="true"># print(OAs)</span>    <span class="token comment" spellcheck="true"># print(kappas)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AA值分别为：\n{:.3f}\n{:.3f}\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">,</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OA值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"kappa值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>kappas<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="2"><li><strong>分类方案二</strong>：</li></ol><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> random<span class="token comment" spellcheck="true"># 计算并返回均值向量</span><span class="token keyword">def</span> <span class="token function">junzhi</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span class="token comment" spellcheck="true"># 计算类内离散度矩阵S_i</span><span class="token keyword">def</span> <span class="token function">S_i</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>iris<span class="token punctuation">)</span>    b <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        b <span class="token operator">=</span> b <span class="token operator">+</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">(</span>iris<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>iris<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> b<span class="token comment" spellcheck="true"># 计算总类间离散度矩阵S_w</span><span class="token keyword">def</span> <span class="token function">S_w</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> iris2<span class="token punctuation">,</span> iris3<span class="token punctuation">)</span><span class="token punctuation">:</span>    b_1 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>iris1<span class="token punctuation">)</span>    b_2 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>iris2<span class="token punctuation">)</span>    b_3 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>iris3<span class="token punctuation">)</span>    c <span class="token operator">=</span> b_1 <span class="token operator">+</span> b_2 <span class="token operator">+</span> b_3    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 计算样本类间离散度矩阵S_b</span><span class="token keyword">def</span> <span class="token function">S_b</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 求类别均值以及所有样本的均值</span>    mu_iris1 <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>iris1<span class="token punctuation">)</span>    mu_iris2 <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>iris2<span class="token punctuation">)</span>    mu_iris3 <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>iris3<span class="token punctuation">)</span>    mu <span class="token operator">=</span> <span class="token punctuation">(</span>mu_iris1<span class="token operator">+</span>mu_iris2<span class="token operator">+</span>mu_iris3<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span>    c<span class="token operator">=</span>iris1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>mu_iris1<span class="token operator">-</span>mu<span class="token punctuation">,</span><span class="token punctuation">(</span>mu_iris1<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token operator">+</span> \      iris2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>mu_iris2<span class="token operator">-</span>mu<span class="token punctuation">,</span><span class="token punctuation">(</span>mu_iris2<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token operator">+</span> \      iris3<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>mu_iris3<span class="token operator">-</span>mu<span class="token punctuation">,</span><span class="token punctuation">(</span>mu_iris3<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 划分训练集、测试集的函数</span><span class="token keyword">def</span> <span class="token function">train_test</span><span class="token punctuation">(</span>iris<span class="token punctuation">,</span> target<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_iris<span class="token punctuation">,</span> test_iris<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> \        train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>num<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'train_iris'</span><span class="token punctuation">:</span> train_iris<span class="token punctuation">,</span> <span class="token string">'test_iris'</span><span class="token punctuation">:</span> test_iris<span class="token punctuation">,</span> <span class="token string">'train_target'</span><span class="token punctuation">:</span> train_target<span class="token punctuation">,</span> <span class="token string">'test_target'</span><span class="token punctuation">:</span> test_target<span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 计算出最优的投影方向(到2维平面)</span><span class="token keyword">def</span> <span class="token function">best_w</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_iris1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_iris'</span><span class="token punctuation">]</span>    train_iris2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_iris'</span><span class="token punctuation">]</span>    train_iris3 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>iris3<span class="token punctuation">,</span> target3<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_iris'</span><span class="token punctuation">]</span>    s_b <span class="token operator">=</span> S_b<span class="token punctuation">(</span>train_iris1<span class="token punctuation">,</span> train_iris2<span class="token punctuation">,</span> train_iris3<span class="token punctuation">)</span>    s_w <span class="token operator">=</span> S_w<span class="token punctuation">(</span>train_iris1<span class="token punctuation">,</span> train_iris2<span class="token punctuation">,</span> train_iris3<span class="token punctuation">)</span>    eigvalue<span class="token punctuation">,</span>eigvector<span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>s_w<span class="token punctuation">)</span><span class="token punctuation">,</span>s_b<span class="token punctuation">)</span><span class="token punctuation">)</span>    eig<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>eigvalue<span class="token punctuation">,</span>eigvector<span class="token punctuation">)</span><span class="token punctuation">)</span>    eig<span class="token operator">=</span>eig<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>eig<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    best_w<span class="token operator">=</span>eig<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> best_w<span class="token comment" spellcheck="true"># 根据k值计算点，并返回类别</span><span class="token keyword">def</span> <span class="token function">knn</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test<span class="token punctuation">,</span>test_target<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>    dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>real<span class="token operator">-</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>real<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>real<span class="token operator">-</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>real<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>dis<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(a.shape)</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># print(a)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 设置一个数组来统计各类的个数</span>    n<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>            n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">elif</span> a<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(n)</span>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>n<span class="token operator">==</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 给定参数，画出分类结果图</span><span class="token keyword">def</span> <span class="token function">ploty</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>predict_target<span class="token punctuation">,</span>real_num_1<span class="token punctuation">,</span>real_num_2<span class="token punctuation">,</span>real_num_3<span class="token punctuation">)</span><span class="token punctuation">:</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>predict_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>real_num_1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>real_num_1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>a<span class="token punctuation">[</span>real_num_1<span class="token punctuation">:</span>real_num_1<span class="token operator">+</span>real_num_2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>real_num_1<span class="token punctuation">:</span>real_num_1<span class="token operator">+</span>real_num_2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># plt.scatter(a[real_num_2:real_num_2+real_num_3,0],a[real_num_2:real_num_2+real_num_3,0],color='green',marker='o')</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 对测试样本进行分类并计算相关评价指标</span><span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">,</span>k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># print(num)</span>    <span class="token comment" spellcheck="true">## 训练集得到的投影方向</span>    w_best<span class="token operator">=</span>best_w<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 测试集</span>    test1_iris<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test2_iris<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test3_iris<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris3<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_iris'</span><span class="token punctuation">]</span>    test_iris<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test1_iris<span class="token punctuation">,</span>test2_iris<span class="token punctuation">,</span>test3_iris<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 将测试集按照投影方向投影</span>    test<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test_iris<span class="token punctuation">,</span>w_best<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test.shape)</span>    <span class="token comment" spellcheck="true">## 当前测试集对应的标签</span>    test_target1<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target2<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target3<span class="token operator">=</span>train_test<span class="token punctuation">(</span>iris3<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target<span class="token operator">=</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test_target1<span class="token punctuation">,</span>test_target2<span class="token punctuation">,</span>test_target3<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test_target.shape)</span>    <span class="token comment" spellcheck="true">## 存放预测得到的标签</span>    predict_target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 利用knn进行分类</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>knn<span class="token punctuation">(</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test<span class="token punctuation">,</span>test_target<span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(predict_target.shape)</span>    <span class="token comment" spellcheck="true"># print(test_target)</span>    <span class="token comment" spellcheck="true">## 计算OA、AA、kappa系数</span>    <span class="token comment" spellcheck="true">### 记录三类样本分类正确的数量</span>    num_1<span class="token operator">=</span><span class="token number">0</span>    num_2<span class="token operator">=</span><span class="token number">0</span>    num_3<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment" spellcheck="true">### 记录三类样本实际分类的数量</span>    real_num_1<span class="token operator">=</span><span class="token number">0</span>    real_num_2<span class="token operator">=</span><span class="token number">0</span>    real_num_3<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">## 统计分类正确的数量</span>        <span class="token keyword">if</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_1<span class="token operator">=</span>num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">elif</span> i<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_2<span class="token operator">=</span>num_2<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_3<span class="token operator">=</span>num_3<span class="token operator">+</span><span class="token number">1</span>        <span class="token comment" spellcheck="true">## 统计实际的分类数量</span>        <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>            real_num_1<span class="token operator">=</span>real_num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">elif</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            real_num_2<span class="token operator">=</span>real_num_2<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            real_num_3<span class="token operator">=</span>real_num_3<span class="token operator">+</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(num_1)</span>    <span class="token comment" spellcheck="true">### 计算相关指标</span>    OA<span class="token operator">=</span><span class="token punctuation">(</span>num_1<span class="token operator">+</span>num_2<span class="token operator">+</span>num_3<span class="token punctuation">)</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_1<span class="token operator">=</span>num_1<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_2<span class="token operator">=</span>num_2<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_3<span class="token operator">=</span>num_3<span class="token operator">*</span><span class="token number">3</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    pe<span class="token operator">=</span><span class="token punctuation">(</span>real_num_1<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span><span class="token operator">+</span>real_num_2<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span> \        <span class="token operator">+</span>real_num_3<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    kappa<span class="token operator">=</span><span class="token punctuation">(</span>OA<span class="token operator">-</span>pe<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>pe<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 结果图</span>    <span class="token comment" spellcheck="true"># ploty(test,predict_target,real_num_1,real_num_2,real_num_3)</span>    <span class="token keyword">return</span> OA<span class="token punctuation">,</span><span class="token punctuation">[</span>AA_1<span class="token punctuation">,</span>AA_2<span class="token punctuation">,</span>AA_3<span class="token punctuation">]</span><span class="token punctuation">,</span>kappa<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 导入数据并去量纲</span>    data <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>    iris1 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    iris2 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    iris3 <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    max_feature<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> \                          np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>data<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    iris1<span class="token operator">=</span>iris1<span class="token operator">/</span>max_feature    iris2<span class="token operator">=</span>iris2<span class="token operator">/</span>max_feature    iris3<span class="token operator">=</span>iris3<span class="token operator">/</span>max_feature    <span class="token comment" spellcheck="true"># 导入标签</span>    target1 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    target2 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    target3 <span class="token operator">=</span> data<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T    <span class="token comment" spellcheck="true"># 存储相关的指标值</span>    OAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    AAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    kappas<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#随机给出30个随机种子，用于train_test函数</span>    nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7136</span><span class="token punctuation">,</span><span class="token number">2619</span><span class="token punctuation">,</span><span class="token number">4794</span><span class="token punctuation">,</span><span class="token number">5676</span><span class="token punctuation">,</span><span class="token number">3265</span><span class="token punctuation">,</span><span class="token number">1979</span><span class="token punctuation">,</span><span class="token number">906</span><span class="token punctuation">,</span><span class="token number">9058</span><span class="token punctuation">,</span><span class="token number">2011</span><span class="token punctuation">,</span><span class="token number">5435</span><span class="token punctuation">,</span><span class="token number">1729</span><span class="token punctuation">,</span><span class="token number">4558</span><span class="token punctuation">,</span><span class="token number">8765</span><span class="token punctuation">,</span><span class="token number">6826</span><span class="token punctuation">,</span><span class="token number">6174</span><span class="token punctuation">,</span><span class="token number">6286</span><span class="token punctuation">,</span><span class="token number">7825</span><span class="token punctuation">,</span><span class="token number">4843</span><span class="token punctuation">,</span><span class="token number">9697</span><span class="token punctuation">,</span><span class="token number">788</span><span class="token punctuation">,</span><span class="token number">8082</span><span class="token punctuation">,</span><span class="token number">3785</span><span class="token punctuation">,</span><span class="token number">8206</span><span class="token punctuation">,</span><span class="token number">5383</span><span class="token punctuation">,</span><span class="token number">4723</span><span class="token punctuation">,</span><span class="token number">7249</span><span class="token punctuation">,</span><span class="token number">4929</span><span class="token punctuation">,</span><span class="token number">4722</span><span class="token punctuation">,</span><span class="token number">9587</span><span class="token punctuation">,</span><span class="token number">4400</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># nums=random.sample(range(0,10000),100)</span>    j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            OAs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>AAs<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>kappas<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>classify<span class="token punctuation">(</span>iris1<span class="token punctuation">,</span>iris2<span class="token punctuation">,</span>iris3<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>target3<span class="token punctuation">,</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span>            i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            i<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true">#     print(j)</span>    <span class="token comment" spellcheck="true"># OAs[j],AAs[j,],kappas[j]=classify(iris1,iris2,iris3,target1,target2,target3,9587)</span>    temp<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> OAs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>            temp<span class="token operator">=</span>temp<span class="token operator">+</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(np.around(AAs,decimals=3))</span>    <span class="token comment" spellcheck="true"># print(np.around(OAs,decimals=3))</span>    <span class="token comment" spellcheck="true"># print(np.around(kappas,decimals=3))</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AA值分别为：\n{:.3f}\n{:.3f}\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">,</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OA值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"kappa值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>kappas<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="sonar数据集分类（数据来源见附件sonar-xlsx）"><a href="#sonar数据集分类（数据来源见附件sonar-xlsx）" class="headerlink" title="sonar数据集分类（数据来源见附件sonar.xlsx）"></a>sonar数据集分类（数据来源见附件sonar.xlsx）</h4><ol><li><strong>分类方案一：</strong></li></ol><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> random<span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook<span class="token comment" spellcheck="true"># 计算并返回均值向量</span><span class="token keyword">def</span> <span class="token function">junzhi</span><span class="token punctuation">(</span>sonar<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sonar<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span class="token comment" spellcheck="true"># 计算类内离散度矩阵S_i</span><span class="token keyword">def</span> <span class="token function">S_i</span><span class="token punctuation">(</span>sonar<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>sonar<span class="token punctuation">)</span>    b <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        b <span class="token operator">=</span> b <span class="token operator">+</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">(</span>sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> b<span class="token comment" spellcheck="true"># 计算类间离散度矩阵S_w</span><span class="token keyword">def</span> <span class="token function">S_w</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">)</span><span class="token punctuation">:</span>    b_1 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>sonar1<span class="token punctuation">)</span>    b_2 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>sonar2<span class="token punctuation">)</span>    c <span class="token operator">=</span> b_1 <span class="token operator">+</span> b_2    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 划分训练集、测试集的函数</span><span class="token keyword">def</span> <span class="token function">train_test</span><span class="token punctuation">(</span>sonar<span class="token punctuation">,</span> target<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_sonar<span class="token punctuation">,</span> test_sonar<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span>\        train_test_split<span class="token punctuation">(</span>sonar<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>num<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'train_sonar'</span><span class="token punctuation">:</span> train_sonar<span class="token punctuation">,</span> <span class="token string">'test_sonar'</span><span class="token punctuation">:</span> test_sonar<span class="token punctuation">,</span> <span class="token string">'train_target'</span><span class="token punctuation">:</span> train_target<span class="token punctuation">,</span> <span class="token string">'test_target'</span><span class="token punctuation">:</span> test_target<span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 计算出最优的投影方向并计算出决策点</span><span class="token keyword">def</span> <span class="token function">best_w</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_sonar1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_sonar'</span><span class="token punctuation">]</span>    train_sonar2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_sonar'</span><span class="token punctuation">]</span>    s_0 <span class="token operator">=</span> S_w<span class="token punctuation">(</span>train_sonar1<span class="token punctuation">,</span> train_sonar2<span class="token punctuation">)</span>    best_w <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>s_0<span class="token punctuation">)</span><span class="token punctuation">,</span> junzhi<span class="token punctuation">(</span>train_sonar1<span class="token punctuation">)</span> <span class="token operator">-</span> junzhi<span class="token punctuation">(</span>train_sonar2<span class="token punctuation">)</span><span class="token punctuation">)</span>    y_0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">58</span><span class="token operator">/</span><span class="token number">124</span><span class="token punctuation">)</span><span class="token operator">*</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>train_sonar1<span class="token punctuation">,</span> best_w<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">66</span><span class="token operator">/</span><span class="token number">124</span><span class="token punctuation">)</span><span class="token operator">*</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>train_sonar2<span class="token punctuation">,</span> best_w<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(best_w)</span>    <span class="token keyword">return</span> best_w<span class="token punctuation">,</span> y_0<span class="token comment" spellcheck="true"># 对测试样本进行分类并计算相关评价指标</span><span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>sonar2<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># print(num)</span>    <span class="token comment" spellcheck="true">## 训练集得到的最佳方向和决策点</span>    w_best12<span class="token punctuation">,</span>y0_12<span class="token operator">=</span>best_w<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 测试集</span>    test1<span class="token operator">=</span>train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_sonar'</span><span class="token punctuation">]</span>    test2<span class="token operator">=</span>train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_sonar'</span><span class="token punctuation">]</span>    test<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span>test2<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 当前测试集对应的标签</span>    test_target1<span class="token operator">=</span>train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target2<span class="token operator">=</span>train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># print(test_target1.shape)</span>    <span class="token comment" spellcheck="true"># print(test_target2.shape)</span>    test_target<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test_target1<span class="token punctuation">,</span>test_target2<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test_target.shape)</span>    <span class="token comment" spellcheck="true"># print(test_target)</span>    <span class="token comment" spellcheck="true">## 存放预测得到的标签</span>    predict_target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 通过决策函数</span>    y<span class="token operator">=</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test<span class="token punctuation">,</span>w_best12<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">></span>y0_12 <span class="token operator">or</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>y0_12<span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(predict_target)</span>    <span class="token comment" spellcheck="true">## 计算OA、AA、kappa系数</span>    <span class="token comment" spellcheck="true">### 记录三类样本分类正确的数量</span>    num_1<span class="token operator">=</span><span class="token number">0</span>    num_2<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment" spellcheck="true">### 记录三类样本实际分类的数量</span>    real_num_1<span class="token operator">=</span><span class="token number">0</span>    real_num_2<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">## 统计分类正确的数量</span>        <span class="token keyword">if</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_1<span class="token operator">=</span>num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_2<span class="token operator">=</span>num_2<span class="token operator">+</span><span class="token number">1</span>        <span class="token comment" spellcheck="true">## 统计实际的分类数量</span>        <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>            real_num_1<span class="token operator">=</span>real_num_1<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            real_num_2<span class="token operator">=</span>real_num_2<span class="token operator">+</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(num_1)</span>    <span class="token comment" spellcheck="true">### 计算相关指标</span>    OA<span class="token operator">=</span><span class="token punctuation">(</span>num_1<span class="token operator">+</span>num_2<span class="token punctuation">)</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_1<span class="token operator">=</span><span class="token punctuation">(</span>num_1<span class="token punctuation">)</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span>    AA_2<span class="token operator">=</span><span class="token punctuation">(</span>num_2<span class="token punctuation">)</span><span class="token operator">/</span>len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span>    pe<span class="token operator">=</span><span class="token punctuation">(</span>real_num_1<span class="token operator">*</span>len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span><span class="token operator">+</span>real_num_2<span class="token operator">*</span>\        len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    kappa<span class="token operator">=</span><span class="token punctuation">(</span>OA<span class="token operator">-</span>pe<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>pe<span class="token punctuation">)</span>    <span class="token keyword">return</span> OA<span class="token punctuation">,</span><span class="token punctuation">[</span>AA_1<span class="token punctuation">,</span>AA_2<span class="token punctuation">]</span><span class="token punctuation">,</span>kappa<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 导入数据</span>    workbook<span class="token operator">=</span>load_workbook<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">'sonar.xlsx'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(workbook.sheetnames)</span>    sheet<span class="token operator">=</span>workbook<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储样本特征集</span>    sonar<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 存储标签</span>    target<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span>sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># print(sonar.shape)</span>    <span class="token comment" spellcheck="true"># print(sonar[0,59])</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">==</span><span class="token string">'R'</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(target[97])</span>    sonar1<span class="token operator">=</span>sonar<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    sonar2<span class="token operator">=</span>sonar<span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">:</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    target1<span class="token operator">=</span>target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    target2<span class="token operator">=</span>target<span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">:</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储相关的指标值</span>    OAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    AAs<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    kappas<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#随机给出30个随机种子，用于train_test函数</span>    <span class="token comment" spellcheck="true"># nums=[703,5205,8248,4998,1027,8528,7063,6513,793,2805,1524,8985,3939,9000\</span>    <span class="token comment" spellcheck="true"># ,3796,3178,628,9359,582,265,5920,8866,7960,5090,5481,4928,526,8763,5333,6596]</span>    nums<span class="token operator">=</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>    j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">while</span> j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            OAs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>AAs<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>kappas<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>classify<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>sonar2<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>            j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span>            k<span class="token operator">=</span>k<span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            k<span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># OAs[j],AAs[j,],kappas[j]=classify(sonar1,sonar2,target1,target2,nums[k])</span>    temp<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> OAs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>            temp<span class="token operator">=</span>temp<span class="token operator">+</span><span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>OAs<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>AAs<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>kappas<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AA值分别为：\n{:.3f}\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">,</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OA值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"kappa值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>kappas<span class="token punctuation">)</span><span class="token operator">/</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ol start="2"><li><strong>分类方案二：</strong></li></ol><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> random<span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook<span class="token comment" spellcheck="true"># 计算并返回均值向量</span><span class="token keyword">def</span> <span class="token function">junzhi</span><span class="token punctuation">(</span>sonar<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sonar<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a<span class="token comment" spellcheck="true"># 计算类内离散度矩阵S_i</span><span class="token keyword">def</span> <span class="token function">S_i</span><span class="token punctuation">(</span>sonar<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>sonar<span class="token punctuation">)</span>    b <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>sonar<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        b <span class="token operator">=</span> b <span class="token operator">+</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">(</span>sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> b<span class="token comment" spellcheck="true"># 计算类间离散度矩阵S_w</span><span class="token keyword">def</span> <span class="token function">S_w</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">)</span><span class="token punctuation">:</span>    b_1 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>sonar1<span class="token punctuation">)</span>    b_2 <span class="token operator">=</span> S_i<span class="token punctuation">(</span>sonar2<span class="token punctuation">)</span>    c <span class="token operator">=</span> b_1 <span class="token operator">+</span> b_2    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 计算样本类间离散度矩阵S_b</span><span class="token keyword">def</span> <span class="token function">S_b</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>sonar2<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 求类别均值以及所有样本的均值</span>    mu_sonar1 <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>sonar1<span class="token punctuation">)</span>    mu_sonar2 <span class="token operator">=</span> junzhi<span class="token punctuation">(</span>sonar2<span class="token punctuation">)</span>    mu <span class="token operator">=</span> <span class="token punctuation">(</span>sonar1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>mu_sonar1<span class="token operator">+</span>sonar2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>mu_sonar2<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>sonar2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>sonar1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    c<span class="token operator">=</span>sonar1<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>mu_sonar1<span class="token operator">-</span>mu<span class="token punctuation">,</span><span class="token punctuation">(</span>mu_sonar1<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token operator">+</span> \      sonar2<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>mu_sonar2<span class="token operator">-</span>mu<span class="token punctuation">,</span><span class="token punctuation">(</span>mu_sonar2<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>    <span class="token keyword">return</span> c<span class="token comment" spellcheck="true"># 划分训练集、测试集的函数</span><span class="token keyword">def</span> <span class="token function">train_test</span><span class="token punctuation">(</span>sonar<span class="token punctuation">,</span> target<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_sonar<span class="token punctuation">,</span> test_sonar<span class="token punctuation">,</span> train_target<span class="token punctuation">,</span> test_target <span class="token operator">=</span> \        train_test_split<span class="token punctuation">(</span>sonar<span class="token punctuation">,</span> target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>num<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'train_sonar'</span><span class="token punctuation">:</span> train_sonar<span class="token punctuation">,</span> <span class="token string">'test_sonar'</span><span class="token punctuation">:</span> test_sonar<span class="token punctuation">,</span> <span class="token string">'train_target'</span><span class="token punctuation">:</span> train_target<span class="token punctuation">,</span>            <span class="token string">'test_target'</span><span class="token punctuation">:</span> test_target<span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 计算出最优的投影方向并计算出决策点</span><span class="token keyword">def</span> <span class="token function">best_w</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span>sonar2<span class="token punctuation">,</span>target1<span class="token punctuation">,</span>target2<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    train_sonar1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_sonar'</span><span class="token punctuation">]</span>    train_sonar2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'train_sonar'</span><span class="token punctuation">]</span>    s_b <span class="token operator">=</span> S_b<span class="token punctuation">(</span>train_sonar1<span class="token punctuation">,</span> train_sonar2<span class="token punctuation">)</span>    s_w <span class="token operator">=</span> S_w<span class="token punctuation">(</span>train_sonar1<span class="token punctuation">,</span> train_sonar2<span class="token punctuation">)</span>    eigvalue<span class="token punctuation">,</span>eigvector<span class="token operator">=</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>s_w<span class="token punctuation">)</span><span class="token punctuation">,</span>s_b<span class="token punctuation">)</span><span class="token punctuation">)</span>    eig<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>eigvalue<span class="token punctuation">,</span>eigvector<span class="token punctuation">)</span><span class="token punctuation">)</span>    eig<span class="token operator">=</span>eig<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>eig<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    best_w<span class="token operator">=</span>eig<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> best_w<span class="token keyword">def</span> <span class="token function">knn</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test<span class="token punctuation">,</span>test_target<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>    dis<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dis<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>real<span class="token operator">-</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>real<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>real<span class="token operator">-</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>real<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>dis<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(a.shape)</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># print(a)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## 设置一个数组来统计各类的个数</span>    n<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>            n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(n)</span>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>n<span class="token operator">==</span>np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">ploty</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>predict_target<span class="token punctuation">,</span>real_num_1<span class="token punctuation">,</span>real_num_2<span class="token punctuation">)</span><span class="token punctuation">:</span>    a<span class="token operator">=</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span>predict_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    a<span class="token operator">=</span>a<span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>real_num_1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>real_num_1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>a<span class="token punctuation">[</span>real_num_1<span class="token punctuation">:</span>real_num_1<span class="token operator">+</span>real_num_2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>real_num_1<span class="token punctuation">:</span>real_num_1<span class="token operator">+</span>real_num_2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># plt.scatter(a[real_num_2:real_num_2+real_num_3,0],a[real_num_2:real_num_2+real_num_3,0],color='green',marker='o')</span>    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 对测试样本进行分类并计算相关评价指标</span><span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># print(num)</span>    <span class="token comment" spellcheck="true">## 训练集得到的最佳方向和决策点</span>    w_best <span class="token operator">=</span> best_w<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 测试集</span>    test1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_sonar'</span><span class="token punctuation">]</span>    test2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_sonar'</span><span class="token punctuation">]</span>    test <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> test2<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 当前测试集对应的标签</span>    test_target1 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    test_target2 <span class="token operator">=</span> train_test<span class="token punctuation">(</span>sonar2<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'test_target'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># print(test_target1.shape)</span>    <span class="token comment" spellcheck="true"># print(test_target2.shape)</span>    test_target <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>test_target1<span class="token punctuation">,</span> test_target2<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test_target.shape)</span>    <span class="token comment" spellcheck="true"># print(test_target)</span>    <span class="token comment" spellcheck="true">## 存放预测得到的标签</span>    predict_target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## 通过决策函数</span>    test <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>test<span class="token punctuation">,</span> w_best<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(test.shape)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>knn<span class="token punctuation">(</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test<span class="token punctuation">,</span>test_target<span class="token punctuation">,</span>k<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(predict_target)</span>    <span class="token comment" spellcheck="true">## 计算OA、AA、kappa系数</span>    <span class="token comment" spellcheck="true">### 记录三类样本分类正确的数量</span>    num_1 <span class="token operator">=</span> <span class="token number">0</span>    num_2 <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true">### 记录三类样本实际分类的数量</span>    real_num_1 <span class="token operator">=</span> <span class="token number">0</span>    real_num_2 <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">## 统计分类正确的数量</span>        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_1 <span class="token operator">=</span> num_1 <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> test_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                num_2 <span class="token operator">=</span> num_2 <span class="token operator">+</span> <span class="token number">1</span>        <span class="token comment" spellcheck="true">## 统计实际的分类数量</span>        <span class="token keyword">if</span> predict_target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            real_num_1 <span class="token operator">=</span> real_num_1 <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            real_num_2 <span class="token operator">=</span> real_num_2 <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(num_1)</span>    <span class="token comment" spellcheck="true">### 计算相关指标</span>    OA <span class="token operator">=</span> <span class="token punctuation">(</span>num_1 <span class="token operator">+</span> num_2<span class="token punctuation">)</span> <span class="token operator">/</span> len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span>    AA_1 <span class="token operator">=</span> <span class="token punctuation">(</span>num_1<span class="token punctuation">)</span> <span class="token operator">/</span> len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span>    AA_2 <span class="token operator">=</span> <span class="token punctuation">(</span>num_2<span class="token punctuation">)</span> <span class="token operator">/</span> len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span>    pe <span class="token operator">=</span> <span class="token punctuation">(</span>real_num_1 <span class="token operator">*</span> len<span class="token punctuation">(</span>test_target1<span class="token punctuation">)</span> <span class="token operator">+</span> real_num_2 <span class="token operator">*</span> \          len<span class="token punctuation">(</span>test_target2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>len<span class="token punctuation">(</span>test_target<span class="token punctuation">)</span><span class="token punctuation">)</span>    kappa <span class="token operator">=</span> <span class="token punctuation">(</span>OA <span class="token operator">-</span> pe<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> pe<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 画图</span>    <span class="token comment" spellcheck="true"># ploty(test,predict_target,real_num_1,real_num_2)</span>    <span class="token keyword">return</span> OA<span class="token punctuation">,</span> <span class="token punctuation">[</span>AA_1<span class="token punctuation">,</span> AA_2<span class="token punctuation">]</span><span class="token punctuation">,</span> kappa<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 导入数据</span>    workbook <span class="token operator">=</span> load_workbook<span class="token punctuation">(</span>filename<span class="token operator">=</span><span class="token string">'sonar.xlsx'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(workbook.sheetnames)</span>    sheet <span class="token operator">=</span> workbook<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储样本特征集</span>    sonar <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 存储标签</span>    target <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sonar<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value    <span class="token comment" spellcheck="true"># print(sonar.shape)</span>    <span class="token comment" spellcheck="true"># print(sonar[0,59])</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'R'</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(target[97])</span>    sonar1 <span class="token operator">=</span> sonar<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>    sonar2 <span class="token operator">=</span> sonar<span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">:</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>    target1 <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>    target2 <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">:</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 存储相关的指标值</span>    OAs <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    AAs <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    kappas <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 随机给出30个随机种子，用于train_test函数</span>    nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7136</span><span class="token punctuation">,</span><span class="token number">796</span><span class="token punctuation">,</span><span class="token number">3590</span><span class="token punctuation">,</span><span class="token number">5709</span><span class="token punctuation">,</span><span class="token number">8347</span><span class="token punctuation">,</span><span class="token number">1121</span><span class="token punctuation">,</span><span class="token number">9951</span><span class="token punctuation">,</span><span class="token number">5279</span><span class="token punctuation">,</span><span class="token number">7502</span><span class="token punctuation">,</span><span class="token number">1557</span><span class="token punctuation">,</span><span class="token number">9951</span><span class="token punctuation">,</span><span class="token number">6234</span><span class="token punctuation">,</span><span class="token number">8257</span><span class="token punctuation">,</span><span class="token number">9254</span><span class="token punctuation">,</span><span class="token number">471</span><span class="token punctuation">,</span><span class="token number">4617</span><span class="token punctuation">,</span><span class="token number">9754</span><span class="token punctuation">,</span>          <span class="token number">7772</span><span class="token punctuation">,</span><span class="token number">9594</span><span class="token punctuation">,</span><span class="token number">8979</span><span class="token punctuation">,</span><span class="token number">7422</span><span class="token punctuation">,</span><span class="token number">7888</span><span class="token punctuation">,</span><span class="token number">1944</span><span class="token punctuation">,</span><span class="token number">405</span><span class="token punctuation">,</span><span class="token number">2475</span><span class="token punctuation">,</span><span class="token number">1438</span><span class="token punctuation">,</span><span class="token number">4992</span><span class="token punctuation">,</span><span class="token number">6025</span><span class="token punctuation">,</span><span class="token number">7114</span><span class="token punctuation">,</span><span class="token number">7512</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># nums = random.sample(range(0, 10000), 100)</span>    j <span class="token operator">=</span> <span class="token number">0</span>    i <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> j <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            OAs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> AAs<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kappas<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> classify<span class="token punctuation">(</span>sonar1<span class="token punctuation">,</span> sonar2<span class="token punctuation">,</span> target1<span class="token punctuation">,</span> target2<span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true"># OAs[j],AAs[j,],kappas[j]=classify(sonar1,sonar2,target1,target2,3590)</span>    temp <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> OAs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>            temp <span class="token operator">=</span> temp <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment" spellcheck="true"># print(OAs)</span>    <span class="token comment" spellcheck="true"># print(AAs)</span>    <span class="token comment" spellcheck="true"># print(kappas)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AA值分别为：\n{:.3f}\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> temp<span class="token punctuation">,</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>AAs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OA值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>OAs<span class="token punctuation">)</span> <span class="token operator">/</span> temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"kappa值为：\n{:.3f}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>kappas<span class="token punctuation">)</span> <span class="token operator">/</span> temp<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
            <tag> 模式识别 </tag>
            
            <tag> 大作业 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫（4）——XPath语法和lxml</title>
      <link href="python-spyder-4/"/>
      <url>python-spyder-4/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前面的python爬虫（1-3）讲了怎么向服务器发送请求，获得网页的源代码，不过一个网页的源代码有很多部分我们都是用不上的，那用什么方法能快速获取到我们想要的数据呢？这个时候，网页解析就派上用场了，常用的解析方法有：XPath语句、beautifulsoup4库、re正则表达式，这里先来介绍第一种。</p><h1 id="XPath"><a href="#XPath" class="headerlink" title="XPath"></a>XPath</h1><h2 id="什么是XPath"><a href="#什么是XPath" class="headerlink" title="什么是XPath"></a>什么是XPath</h2><p>xpath（XML Path Language）是一门在 XML 和 HTML 文档中查找信息的语言，可用来在 XML和 HTML 文档中对元素和属性进行遍历。简单点说，这玩意儿就是用来帮我们提取网页源代码中我们所需要的数据的，比如标签属性值、文本值、链接等等都能通过XPath语法提取。</p><h2 id="XPath语法的开发工具（Chrome插件）"><a href="#XPath语法的开发工具（Chrome插件）" class="headerlink" title="XPath语法的开发工具（Chrome插件）"></a>XPath语法的开发工具（Chrome插件）</h2><p>我们想看XPath语法实时的效果，我觉得直接在浏览器里边写是最直观的方法了。谷歌浏览器的插件就帮我们解决了这个问题，插件名字叫“XPath Helper”，直接安装就行，安装步骤可以百度，教程一大把。<br>来看看使用，这里以豆瓣网为例子：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594126565193.jpg"><br>我先写一句做个例子（取电影汉密尔顿的豆瓣评分）：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594127192478.jpg"><br>匹配好之后，我们就可以把语句复制下来粘贴到代码中。</p><h2 id="XPath语法详解"><a href="#XPath语法详解" class="headerlink" title="XPath语法详解"></a>XPath语法详解</h2><p>关于XPath的语法介绍有很多，这里简单罗列：</p><h3 id="选取节点"><a href="#选取节点" class="headerlink" title="选取节点"></a>选取节点</h3><table><thead><tr><th align="center">表达式</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">nodename</td><td align="center">选取此节点的所有子节点</td></tr><tr><td align="center">/</td><td align="center">从根节点选取</td></tr><tr><td align="center">//</td><td align="center">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置</td></tr><tr><td align="center">.</td><td align="center">选取当前节点</td></tr><tr><td align="center">..</td><td align="center">选取当前节点的父节点</td></tr><tr><td align="center">@</td><td align="center">选取属性</td></tr></tbody></table><h3 id="谓语"><a href="#谓语" class="headerlink" title="谓语"></a>谓语</h3><p>谓语用来查找某个特定的节点或者包含某个指定的值的节点，被嵌在方括号中。在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：</p><table><thead><tr><th align="center">路径表达式</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">/bookstore/book[1]</td><td align="center">选取 bookstore 下的第一个子元素</td></tr><tr><td align="center">/bookstore/book[last()]</td><td align="center">选取 bookstore 下的倒数第二个 book 元素。</td></tr><tr><td align="center">bookstore/book[position()&lt;3]</td><td align="center">选取 bookstore 下前面两个子元素。</td></tr><tr><td align="center">//book[@price]</td><td align="center">选取拥有 price 属性的 book 元素</td></tr><tr><td align="center">//book[@price=10]</td><td align="center">选取所有属性 price 等于 10 的 book 元素</td></tr><tr><td align="center">//div[contains(@id,’1234’)]</td><td align="center">选取所以属性 id 中含有 1234 的 div 元素</td></tr></tbody></table><h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><table><thead><tr><th align="center">通配符</th><th align="center">描述</th><th align="center">示例</th><th align="center">结果</th></tr></thead><tbody><tr><td align="center">*</td><td align="center">匹配任意节点</td><td align="center">/bookstore/*</td><td align="center">选取 bookstore 下的所有子元素。</td></tr><tr><td align="center">@*</td><td align="center">匹配节点中的任何属性</td><td align="center">//book[@*]</td><td align="center">选取所有带有属性的 book 元素。</td></tr></tbody></table><h3 id="选取多个路径"><a href="#选取多个路径" class="headerlink" title="选取多个路径"></a>选取多个路径</h3><p>通过在路径表达式中使用“|”运算符，可以选取若干个路径。示例如下：<br>**//bookstore/book | //book/title**（选取所有 book 元素以及 book 元素下所有的 title 元素）</p><h3 id="XPath运算符"><a href="#XPath运算符" class="headerlink" title="XPath运算符"></a>XPath运算符</h3><table><thead><tr><th align="center">运算符</th><th align="center">描述</th><th align="center">实例</th><th align="center">返回值</th></tr></thead><tbody><tr><td align="center">|</td><td align="center">计算两个节点集</td><td align="center">//book | //cd</td><td align="center">返回所有拥有 book 和 cd 元素的节点集</td></tr><tr><td align="center">+</td><td align="center">加法</td><td align="center">6 + 4</td><td align="center">10</td></tr><tr><td align="center">-</td><td align="center">减法</td><td align="center">6 - 4</td><td align="center">2</td></tr><tr><td align="center">*</td><td align="center">乘法</td><td align="center">6 * 4</td><td align="center">24</td></tr><tr><td align="center">div</td><td align="center">除法</td><td align="center">8 div 4</td><td align="center">2</td></tr><tr><td align="center">=</td><td align="center">等于</td><td align="center">price=9.80</td><td align="center">如果 price 是 9.80，则返回 true。如果 price 是 9.90，则返回false。</td></tr><tr><td align="center">!=</td><td align="center">不等于</td><td align="center">price!=9.80</td><td align="center">如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</td></tr><tr><td align="center">&lt;</td><td align="center">小于</td><td align="center">price&lt;9.80</td><td align="center">如果price是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td></tr><tr><td align="center">&lt;=</td><td align="center">小于或等于</td><td align="center">price&lt;=9.80</td><td align="center">如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td></tr><tr><td align="center">&gt;</td><td align="center">大于</td><td align="center">price&gt;9.80</td><td align="center">如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</td></tr><tr><td align="center">&gt;=</td><td align="center">大于或等于</td><td align="center">price&gt;=9.80</td><td align="center">如果 price 是 9.90，则返回 true。如果 price 是 9.70，则返回 false。</td></tr><tr><td align="center">or</td><td align="center">或</td><td align="center">price=9.80 orprice=9.70</td><td align="center">如果 price 是 9.80，则返回 true。如果 price 是 9.50，则返回 false。</td></tr><tr><td align="center">and</td><td align="center">与</td><td align="center">price&gt;9.00 andprice&lt;9.90</td><td align="center">如果 price 是 9.80，则返回 true。如果 price 是 8.50，则返回 false。</td></tr><tr><td align="center">mod</td><td align="center">计算除法的余数</td><td align="center">5 mod 2</td><td align="center">1</td></tr></tbody></table><h1 id="lxml"><a href="#lxml" class="headerlink" title="lxml"></a>lxml</h1><h2 id="什么是lxml"><a href="#什么是lxml" class="headerlink" title="什么是lxml"></a>什么是lxml</h2><p>lxml 是 一个 HTML/XML 的解析器，主要的功能是如何解析和提取 HTML/XML 数据。lxml 和正则一样，也是用 C 实现的，是一款高性能的 Python HTML/XML 解析器，我们可以利用之前学习的 XPath 语法，来快速的定位特定元素以及节点信息。这里附上<a href="http://lxml.de/index.html" target="_blank" rel="noopener">官方文档</a></p><h3 id="先来说一个坑"><a href="#先来说一个坑" class="headerlink" title="先来说一个坑"></a>先来说一个坑</h3><p>我们一般使用lxml库里的etree方法，我第一次使用lxml库的时候被坑的蛮惨，由于我装的是版本较新的lxml库（4.4.1），老版本的导入方法是<code>from lxml import etree</code>，嗯，果不其然报错了。然后就是去找答案，最后发现在比较新的版本里，etree被封装到lxml下的html库里边了，所以可以这样导入：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> htmletree <span class="token operator">=</span> html<span class="token punctuation">.</span>etree</code></pre><h2 id="大致流程"><a href="#大致流程" class="headerlink" title="大致流程"></a>大致流程</h2><p>使用requests库和lxml库进行爬虫一般分为以下几个步骤：</p><ol><li><p>导库，设置请求头，利用requests库向网页发送请求，并得到一个response对象</p></li><li><p>利用etree对response对象进行解析，得到一个lxml.etree._Element对象，该对象可以使用xpath语法进行提取信息</p></li><li><p>利用xpath语法对lxml.etree._Element对象进行信息提取</p></li><li><p>将提取的信息进行处理</p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>这里利用requests库和lxml库来爬取豆瓣网经典的电影排名前10的电影信息：</p></li><li><p>导入相关模块：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> lxml <span class="token keyword">import</span> htmletree <span class="token operator">=</span> html<span class="token punctuation">.</span>etree</code></pre></li><li><p>设置一些参数</p><pre class=" language-python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "</span>               <span class="token string">"(KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36"</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">#请求头</span>url <span class="token operator">=</span> <span class="token string">"https://movie.douban.com/chart"</span><span class="token comment" spellcheck="true">#目标链接</span>movies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#用于保存电影信息</span></code></pre></li><li><p>requests库请求</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 向指定页数发起请求，并返回resopnse对象</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></code></pre></li><li><p>etree对response对象进行解析</p><pre class=" language-python"><code class="language-python">html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>tables <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//table"</span><span class="token punctuation">)</span></code></pre></li><li><p>用xpath提取信息并保存</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> table <span class="token keyword">in</span> tables<span class="token punctuation">:</span> detail_herf <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//a[@class="nbg"]/@href'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> name <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//a[@class='nbg']/@title"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> post_url <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//img/@src"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//span[@class='rating_nums']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> movie <span class="token operator">=</span><span class="token punctuation">{</span>     <span class="token string">"href"</span><span class="token punctuation">:</span> detail_herf<span class="token punctuation">,</span><span class="token comment" spellcheck="true">#详情链接</span>     <span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span><span class="token comment" spellcheck="true">#电影名</span>     <span class="token string">"post_url"</span><span class="token punctuation">:</span> post_url<span class="token punctuation">,</span><span class="token comment" spellcheck="true">#海报链接</span>     <span class="token string">"nums"</span><span class="token punctuation">:</span> nums<span class="token comment" spellcheck="true">#评分</span> <span class="token punctuation">}</span> <span class="token keyword">print</span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span> movies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie<span class="token punctuation">)</span></code></pre><p>运行，结果如下图：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594696787504.jpg"><br>最后，再贴一下完整代码：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 爬取豆瓣电影经典影片排名</span><span class="token keyword">import</span> requests<span class="token keyword">from</span> lxml <span class="token keyword">import</span> htmletree <span class="token operator">=</span> html<span class="token punctuation">.</span>etreeheaders <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "</span>               <span class="token string">"(KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36"</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">"https://movie.douban.com/chart"</span>movies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>n <span class="token operator">=</span> <span class="token number">1</span><span class="token comment" spellcheck="true"># 向指定页数发起请求，并返回resopnse对象</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>tables <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//table"</span><span class="token punctuation">)</span><span class="token keyword">for</span> table <span class="token keyword">in</span> tables<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#这个地方可以借助前面介绍的谷歌浏览器插件来检查匹配是否正确</span> detail_herf <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//a[@class="nbg"]/@href'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> name <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//a[@class='nbg']/@title"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> post_url <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//img/@src"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> table<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//span[@class='rating_nums']/text()"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> movie <span class="token operator">=</span> <span class="token punctuation">{</span>     <span class="token string">"href"</span><span class="token punctuation">:</span> detail_herf<span class="token punctuation">,</span>     <span class="token string">"name"</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>     <span class="token string">"post_url"</span><span class="token punctuation">:</span> post_url<span class="token punctuation">,</span>     <span class="token string">"nums"</span><span class="token punctuation">:</span> nums <span class="token punctuation">}</span> <span class="token keyword">print</span><span class="token punctuation">(</span>movie<span class="token punctuation">)</span> movies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie<span class="token punctuation">)</span></code></pre><h1 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h1><p>嗯，总的看来，写个小爬虫其实是很简单的，xpath语法也很好理解，但仅掌握这些是不够的，无法写出很diao的爬虫，还有蛮多东西要学习！</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫（3）——cookie与requests库</title>
      <link href="python-spyder-3/"/>
      <url>python-spyder-3/</url>
      
        <content type="html"><![CDATA[<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>在网站中，http请求是无状态的。也就是说即使第一次和服务器连接后并且登录成功后，第二次请求服务器依然不能知道当前请求是哪个用户。cookie 的出现就是为了解决这个问题，第一次登录后服务器返回一些数据（cookie）给浏览器，然后浏览器保存在本地，当该用户发送第二次请求的时候，就会自动的把上次请求存储的 cookie 数据自动的携带给服务器，服务器通过浏览器携带的数据就能判断当前用户是哪个了。cookie 存储的数据量有限，不同的浏览器有不同的存储大小，但一般不超过 4KB。因此使用 cookie 只能存储一些小量的数据。<br>cookie的一般格式如下：<br><code>Set-Cookie: NAME=VALUE；Expires/Max-age=DATE；Path=PATH；Domain=DOMAIN_NAME；SECURE</code><br>参数的描述如下表：</p><table><thead><tr><th align="center">参数名</th><th align="center">参数描述</th></tr></thead><tbody><tr><td align="center">NAME</td><td align="center">cookie的名字</td></tr><tr><td align="center">VALUE</td><td align="center">cookie的值</td></tr><tr><td align="center">Expires</td><td align="center">cookie的过期时间</td></tr><tr><td align="center">Path</td><td align="center">cookie作用的路径</td></tr><tr><td align="center">Domain</td><td align="center">cookie作用的域名</td></tr><tr><td align="center">SECURE</td><td align="center">是否只在https协议下起作用</td></tr></tbody></table><p>浏览器保存了cookie，后面每次访问时就方便，如果要用代码来向那些需要登录才能访问的（进行更多操作）网站，就需要把cookie信息传给目标服务器，登录说白了也就是要有cookie信息。要获取cookie信息，首先第一想法就是直接去网站上登录，然后按F12，就能找到cookie信息，以人人网（访问演员大鹏主页，需要登录才能访问）为例子：</p><pre class=" language-python"><code class="language-python">!<span class="token punctuation">[</span><span class="token number">1594010413908</span><span class="token punctuation">]</span><span class="token punctuation">(</span>E<span class="token punctuation">:</span><span class="token operator">%</span>5CGridea<span class="token operator">%</span>5Cpost<span class="token operator">-</span>images<span class="token operator">%</span><span class="token number">5C1594010413908.</span>jpg<span class="token punctuation">)</span><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parse<span class="token comment" spellcheck="true">#先注释掉cookie</span>headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> 'Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span>\         AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> \         Chrome<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">4103.116</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">478.58</span>'<span class="token punctuation">,</span>         <span class="token comment" spellcheck="true"># 'Cookie': 'ick_login=0ddad9f3-7fa0-4787-b916-5248ea8bb154; anonymid=kca04u42-rmbvi0; depovince=GW; _r01_=1; JSESSIONID=abchsJm52fkNjfdE5xImx; taihe_bi_sdk_uid=15a8a286885699bb6771e6212cc23aa5; taihe_bi_sdk_session=d83833b4a0fb72a6a466205c9329e993; ick=07bea91b-c6d1-4955-ad33-0980db50a672; t=c2a3a8d10309229b0555eb589c8482575; societyguester=c2a3a8d10309229b0555eb589c8482575; id=974715915; xnsid=dd9ddee7; XNESSESSIONID=6c76a75ff812; WebOnLineNotice_974715915=1; ver=7.0; loginfrom=null; jebe_key=060c174f-c2df-4669-9a2c-584b47a0e4a8%7C032338e00e79b21248aaa07a19d3e44d%7C1594009812653%7C1%7C1594009810029; jebe_key=060c174f-c2df-4669-9a2c-584b47a0e4a8%7C032338e00e79b21248aaa07a19d3e44d%7C1594009812653%7C1%7C1594009810031; wp_fold=0; jebecookies=ba0612a2-0ce7-4a4d-95d1-1f71f38ee8ce|||||'</span>    <span class="token punctuation">}</span>url<span class="token operator">=</span><span class="token string">"http://www.renren.com/880151247/profile"</span>req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>resp <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'result.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>运行代码，会生成一个html文件，我们用浏览器打开它，发现结果如下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594010413908.jpg"><br>这并不是我们想要的页面，然后将上面的代码中cookie部分取消注释，再运行，打开result.html：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594010616018.jpg"><br>可以看到出现了我们想要的页面！这就很好的体现出cookie的作用。</p><h2 id="http-cookiejar模块"><a href="#http-cookiejar模块" class="headerlink" title="http.cookiejar模块"></a>http.cookiejar模块</h2><p>上面介绍了一种可行的方法，不过我写爬虫不就是为了提高效率嘛，你还每次让我手动去复制粘贴cookie信息？再想想，我们能通过请求获得状态码之类的网站信息，cookie也能用同样的方式获得呀，那不就完事了。这里我们的http.cookiejar模块就闪亮登场了，该模块主要的类有 CookieJar、FileCookieJar、MozillaCookieJar、LWPCookieJar。这四个类的作用分别如下：</p><table><thead><tr><th align="center">类名</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">CookieJar</td><td align="center">管理 HTTP cookie 值、存储 HTTP 请求生成的 cookie、向传出的 HTTP 请求添加 cookie 的对象。整个 cookie 都存储在内存中，对 CookieJar 实例进行垃圾回收后 cookie也将丢失。</td></tr><tr><td align="center">FileCookieJar (filename,delayload=None,policy=None)</td><td align="center">从 CookieJar 派生而来，用创建 FileCookieJar 实例，检索 cookie 信息并将 cookie 存储到文件中。filename 是存储cookie的文件名。delayload 为 True 时支持延迟访问访问文件，即只有在需要时才读取文件或在文件中存储数据。</td></tr><tr><td align="center">MozillaCookieJar (filename,delayload=None,policy=None)</td><td align="center">从 FileCookieJar 派生而来，创建与 Mozilla 浏览器 cookies.txt 兼容的 FileCookieJar 实例。</td></tr><tr><td align="center">LWPCookieJar (filename,delayload=None,policy=None)</td><td align="center">从 FileCookieJar 派生而来，创建与 libwww-perl 标准的 Set-Cookie3 文件格式兼容的 FileCookieJar 实例。</td></tr></tbody></table><p>再用该模块实现访问人人网大鹏的主页：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parse<span class="token keyword">from</span> http<span class="token punctuation">.</span>cookiejar <span class="token keyword">import</span> CookieJarheaders<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> 'Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span>\         AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> \         Chrome<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">4103.116</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">478.58</span>'    <span class="token punctuation">}</span><span class="token comment" spellcheck="true">#创造一个opener</span><span class="token keyword">def</span> <span class="token function">get_opener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    cookjar<span class="token operator">=</span>CookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>    handler<span class="token operator">=</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookjar<span class="token punctuation">)</span>    opener<span class="token operator">=</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>    <span class="token keyword">return</span> opener<span class="token comment" spellcheck="true">#利用创造好的opener发送请求，请求返回的数据中就有cookie信息，他会保存到cookiejar类中</span><span class="token keyword">def</span> <span class="token function">save_cookie</span><span class="token punctuation">(</span>opener<span class="token punctuation">)</span><span class="token punctuation">:</span>    login_url<span class="token operator">=</span><span class="token string">"http://www.renren.com/PLogin.do"</span>    <span class="token comment" spellcheck="true">#账号密码不能泄露啊😂😂😂</span>    data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"##########"</span><span class="token punctuation">,</span>          <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">"##########"</span>        <span class="token punctuation">}</span>    res <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>data<span class="token operator">=</span> parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#访问大鹏主页</span><span class="token keyword">def</span> <span class="token function">get_profile</span><span class="token punctuation">(</span>opener<span class="token punctuation">)</span><span class="token punctuation">:</span>    url<span class="token operator">=</span><span class="token string">"http://www.renren.com/880151247/profile"</span>    res<span class="token operator">=</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    resp<span class="token operator">=</span>opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span>res<span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'result2.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    opener<span class="token operator">=</span>get_opener<span class="token punctuation">(</span><span class="token punctuation">)</span>    save_cookie<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>    get_profile<span class="token punctuation">(</span>opener<span class="token punctuation">)</span></code></pre><p>结果如下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594037026162.jpg"></p><h2 id="cookie的保存与加载"><a href="#cookie的保存与加载" class="headerlink" title="cookie的保存与加载"></a>cookie的保存与加载</h2><h3 id="保存到本地"><a href="#保存到本地" class="headerlink" title="保存到本地"></a>保存到本地</h3><p>保存 cookie 到本地，可以使用 MozillaCookieJar 的 save 方法，并且需要指定一个文件名。这里我们再用<strong><a href="http://httpbin.org/" target="_blank" rel="noopener">http://httpbin.org</a></strong>这个网站来演示，该网站可以让我们自定义该网站的cookie信息，话不多说，先上图；<br>主页是这样的，先点击cookie选项:<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594041407808.jpg"><br>跟着步骤来：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594041429670.jpg"><br>设置好后是这样：<img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594041443340.jpg"><br>如果想重新设置，可以先清除该网站的cookie数据哦，怎么清除点<a href="https://jingyan.baidu.com/article/09ea3ede592a34c0afde394e.html" target="_blank" rel="noopener">它</a></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parse<span class="token keyword">from</span> http<span class="token punctuation">.</span>cookiejar <span class="token keyword">import</span> MozillaCookieJarheaders<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> 'Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span>\         AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> \         Chrome<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">4103.116</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">478.58</span>'<span class="token punctuation">}</span>url<span class="token operator">=</span><span class="token string">"http://httpbin.org/cookies/set/python/spyder"</span>cookiejar<span class="token operator">=</span>MozillaCookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>handler<span class="token operator">=</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookiejar<span class="token punctuation">)</span>    opener<span class="token operator">=</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>req<span class="token operator">=</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span>req<span class="token punctuation">)</span>cookiejar<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span>ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#由于该网站的cookie不会可能会过期或者被丢弃，所以这里得设置一下参数</span><span class="token comment" spellcheck="true">#ignore_discard 的意思是即使 cookies 将被丢弃也将它保存下来</span><span class="token comment" spellcheck="true">#ignore_expires 的意思是如果 cookies 已经过期也将它保存并且文件已存在时将覆盖</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>可以看到已经生成了cookie.txt文件，里边就存储着cookie信息，结果如下（出现这种格式应该是save方法的问题）：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594041878454.jpg"></p><h3 id="加载cookie信息"><a href="#加载cookie信息" class="headerlink" title="加载cookie信息"></a>加载cookie信息</h3><p>然后再来看看加载cookie信息，跟上边很类似：</p><pre class=" language-python"><code class="language-python">headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> 'Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span>\         AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> \         Chrome<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">4103.116</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">478.58</span>'<span class="token punctuation">}</span>url<span class="token operator">=</span><span class="token string">"http://httpbin.org/cookies"</span>cookiejar<span class="token operator">=</span>MozillaCookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>cookiejar<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span>ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>handler<span class="token operator">=</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookiejar<span class="token punctuation">)</span>    opener<span class="token operator">=</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>req<span class="token operator">=</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>resp<span class="token operator">=</span>opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>输出：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594043291139.jpg"></p><h2 id="Requests库"><a href="#Requests库" class="headerlink" title="Requests库"></a>Requests库</h2><p>虽然 Python 的标准库中 urllib 模块已经包含了平常我们使用的大多数功能，但是它的 API使用起来让人感觉不太好，而 Requests 宣传是 “HTTP for Humans”，说明使用更简洁方便。接下来我们就用requests库来实现和urllib同样的功能</p><h3 id="发送get请求"><a href="#发送get请求" class="headerlink" title="发送get请求"></a>发送get请求</h3><p>requests库发送get请求直接使用get方法即可，返回的是一个response对象，如果想添加 headers，可以传入 headers 参数来增加请求头中的 headers 信息。如果要将参数放在 url 中传递，可以利用params 参数</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"https://www.baidu.com"</span>headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> 'Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span>\         AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> \         Chrome<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">4103.116</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">83.0</span><span class="token punctuation">.</span><span class="token number">478.58</span>'<span class="token punctuation">}</span>kw<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'wd'</span><span class="token punctuation">:</span><span class="token string">'高考'</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># params 是一个字典或者字符串的查询参数，字典自动转换为 url 编码，不需要urlencode()</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params <span class="token operator">=</span> kw<span class="token punctuation">,</span> headers <span class="token operator">=</span> headers<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 查看响应内容，response.text 返回的是 Unicode 格式的数据(python 会利用自己猜测的编码方式解码，可能会产生乱码的问题)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 查看响应头部字符编码</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># python 会根据网页内容来得到一个字符编码</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>apparent_encoding<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 如果 response.text 乱码了，可以先设置</span>response<span class="token punctuation">.</span>encoding<span class="token operator">=</span> response<span class="token punctuation">.</span>apparent_encoding<span class="token comment" spellcheck="true"># 查看响应内容，response.content 返回的字节流 bytes 数据</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content <span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 查看完整 url 地址</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 查看响应码</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#如果网页返回的是 json，那么可以通过 response.json()转换为 dict 或者 list</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="发送-POST-请求"><a href="#发送-POST-请求" class="headerlink" title="发送 POST 请求"></a>发送 POST 请求</h3><p>最基本的 POST 请求可以使用 post 方法，传入 data 数据（这时候就不要再使用 urlencode 进行编码了，直接传入一个字典进去就可以了）。返回的也是response对象，可以进行的操作同上。比如请求拉勾网的数据的代码：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsparams <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'px'</span><span class="token punctuation">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span>          <span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'北京'</span><span class="token punctuation">,</span>          <span class="token string">'needAddtionalResult'</span><span class="token punctuation">:</span> <span class="token string">'false'</span><span class="token punctuation">}</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'first'</span><span class="token punctuation">:</span> <span class="token string">'true'</span><span class="token punctuation">,</span>        <span class="token string">'pn'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token string">'kd'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">}</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">"https://www.lagou.com/jobs/list_python"</span><span class="token punctuation">,</span>           <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'JSEIONID=ABAAABA9B2BCC46'</span><span class="token punctuation">,</span>           <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">'https://www.lagou.com/jobs/list_python#filterBox'</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>                         params<span class="token operator">=</span>params<span class="token punctuation">,</span>                         headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>                         data<span class="token operator">=</span>data<span class="token punctuation">,</span>                         timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'UTF-8'</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h3 id="使用代理"><a href="#使用代理" class="headerlink" title="使用代理"></a>使用代理</h3><p>使用 requests 添加代理也非常简单，只要在请求的方法中（比如 get 或者 post）传递 proxies参数即可（挂了科学上网软件的最好先关一下，我就因为没关被坑惨了）：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://www.httpbin.org/ip'</span>proxy <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'161.35.110.112:3128'</span><span class="token punctuation">}</span>resp_1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp_1<span class="token punctuation">.</span>text<span class="token punctuation">)</span>resp_2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxy<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp_2<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><p>输出如下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1594091758109.jpg"></p><h3 id="使用requests-session保存cookie"><a href="#使用requests-session保存cookie" class="headerlink" title="使用requests.session保存cookie"></a>使用requests.session保存cookie</h3><p>之前使用 urllib 库，是可以使用 opener 发送多个请求，多个请求之间是可以共享 cookie 的。那么如果使用 requests，也要达到共享 cookie 的目的，那么可以使用 requests 库给我们提供的 session 对象。注意，这里的 session 不是 web 开发中的那个 session，这个地方只是一个会话的对象而已。还是以登录人人网为例，使用 requests 来实现。示例代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://www.renren.com/PLogin.do"</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"970138074@qq.com"</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">"pythonspider"</span><span class="token punctuation">}</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'UserAgent'</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36"</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 登录</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 访问大鹏个人中心</span>resp <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.renren.com/880151247/profile'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出：</span><span class="token number">200</span></code></pre><h2 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h2><p>个人感觉使用方面确实requests库比起urllib的API接口要舒适许多，所以以后能用requests俺就不用urllib🤣🤣🤣</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫（2）——urllib库</title>
      <link href="python-spyder-2/"/>
      <url>python-spyder-2/</url>
      
        <content type="html"><![CDATA[<h2 id="urllib库简介"><a href="#urllib库简介" class="headerlink" title="urllib库简介"></a>urllib库简介</h2><p>urllib 库是 Python 中一个最基本的网络请求库。可以模拟浏览器的行为，向指定的服务器发 送一个请求，并可以保存服务器返回的数据。</p><h2 id="urlopen函数"><a href="#urlopen函数" class="headerlink" title="urlopen函数"></a>urlopen函数</h2><p>在python3的<code>urllib</code>库中，所有和网络请求相关的方法，都被集成到<code>urllib.request</code>模块下了，该函数的使用格式如下：</p><p><code>urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</code></p><p>其中：</p><p><code>cafile、capath、cadefault</code> 参数：用于实现可信任的 CA 证书的 HTTP 请求。（基本上很少用）</p><p><code>context</code> 参数：实现 SSL 加密传输。（基本上很少用）</p><p>所以我们一般关注前面几个参数就可以了：</p><ul><li>URL：所请求的URL</li><li>data：请求的data，如果设置了这个参数，请求会变为post请求</li><li>返回值：返回值是一个http.client.HTTPResponse对象，这是一个类文件句柄对象，它主要有以下几种方法：<ol><li>read(size):返回指定字节的数目，默认为全部 </li><li>readline()：返回一行 </li><li>readlines()：用列表返回全部行 </li><li>getcode()：返回状态码，<code>resp.getcode()</code>等价于 <code>resp.status</code> </li><li>getheaders()：返回响应头</li></ol></li></ul><p>下面来看一个例子：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> requesturl<span class="token operator">=</span><span class="token string">"http://www.baidu.com"</span>resp<span class="token operator">=</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>运行上面的程序，就会打印出百度首页的html源代码，见下图：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593685333801.png"></p><h2 id="request-urlretrieve函数"><a href="#request-urlretrieve函数" class="headerlink" title="request.urlretrieve函数"></a>request.urlretrieve函数</h2><p>这个文件可以很方便的将网页上的文件保存到本地，就比如保存百度首页：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> requesturl<span class="token operator">=</span><span class="token string">"http://www.baidu.com"</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token string">'baidu.html'</span><span class="token punctuation">)</span></code></pre><p>运行代码后，就会在代码文件同目录下生成我们所命名的文件，如图：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593685309150.png"><br>同理，也可以用此方法下载图片，以下载一张王者荣耀韩信的图片为例：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token comment" spellcheck="true">#图片链接只需在网页中鼠标右键选择复制图像链接即可</span>url<span class="token operator">=</span><span class="token string">"https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1107967462,1249145194&amp;fm=26&amp;gp=0.jpg"</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token string">"韩信.jpg"</span><span class="token punctuation">)</span></code></pre><p>运行后，我们就能看到所下载的图片：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593685278665.png"><br>打开看一下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593685038035.jpg"></p><h2 id="parse-urlencode函数和parse-parse-qs函数"><a href="#parse-urlencode函数和parse-parse-qs函数" class="headerlink" title="parse.urlencode函数和parse.parse_qs函数"></a>parse.urlencode函数和parse.parse_qs函数</h2><p>用浏览器发送请求的时候，如果 url 中包含了中文或者其他特殊字符，那么浏览器会自动的给我们进行编码。而如果使用代码发送请求，那么就必须手动的进行编码，这时候就应该使用 urlencode 函数来实现。urlencode 可以把字典数据转换为 URL 编码的数据。示例代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parsedic1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token string">'18'</span><span class="token punctuation">,</span><span class="token string">'slogan'</span> <span class="token punctuation">:</span> <span class="token string">"Hello world"</span><span class="token punctuation">}</span>dic2<span class="token operator">=</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>dic1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>dic2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>name<span class="token operator">=</span><span class="token operator">%</span>E5<span class="token operator">%</span>BC<span class="token operator">%</span>A0<span class="token operator">%</span>E4<span class="token operator">%</span>B8<span class="token operator">%</span><span class="token number">89</span><span class="token operator">&amp;</span>age<span class="token operator">=</span><span class="token number">18</span><span class="token operator">&amp;</span>slogan<span class="token operator">=</span>Hello<span class="token operator">+</span>world</code></pre><p>如果不经过编码，就用urlopen方法的话，会报错：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parseresp <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/s?wd=刘德华'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#报错如下：</span>UnicodeEncodeError<span class="token punctuation">:</span> <span class="token string">'ascii'</span> codec can't encode characters <span class="token keyword">in</span> position <span class="token number">30</span><span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">:</span> ordinal <span class="token operator">not</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span></code></pre><p>编码之后就可以了：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parseparms <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'wd'</span><span class="token punctuation">:</span><span class="token string">'刘德华'</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/s'</span>query_string <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>query_string<span class="token punctuation">)</span>url <span class="token operator">=</span> url<span class="token operator">+</span><span class="token string">'?'</span><span class="token operator">+</span>query_stringresp <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>getcode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>wd<span class="token operator">=</span><span class="token operator">%</span>E5<span class="token operator">%</span><span class="token number">88</span><span class="token operator">%</span><span class="token number">98</span><span class="token operator">%</span>E5<span class="token operator">%</span>BE<span class="token operator">%</span>B7<span class="token operator">%</span>E5<span class="token operator">%</span><span class="token number">8D</span><span class="token operator">%</span><span class="token number">8E</span><span class="token number">200</span></code></pre><p>parse.parse_qs函数就是将编码后的数据再转变回来的函数：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parsedic1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'age'</span> <span class="token punctuation">:</span> <span class="token string">'18'</span><span class="token punctuation">,</span><span class="token string">'slogan'</span> <span class="token punctuation">:</span> <span class="token string">"Hello world"</span><span class="token punctuation">}</span>dic2<span class="token operator">=</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>dic1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>dic2<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>parse<span class="token punctuation">.</span>parse_qs<span class="token punctuation">(</span>dic2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>name<span class="token operator">=</span><span class="token operator">%</span>E5<span class="token operator">%</span>BC<span class="token operator">%</span>A0<span class="token operator">%</span>E4<span class="token operator">%</span>B8<span class="token operator">%</span><span class="token number">89</span><span class="token operator">&amp;</span>age<span class="token operator">=</span><span class="token number">18</span><span class="token operator">&amp;</span>slogan<span class="token operator">=</span>Hello<span class="token operator">+</span>world<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'18'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'slogan'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Hello world'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">#注意返回的数据类型</span></code></pre><h2 id="parse-urlparse-和-parse-urlsplit-函数"><a href="#parse-urlparse-和-parse-urlsplit-函数" class="headerlink" title="parse.urlparse 和 parse.urlsplit 函数"></a>parse.urlparse 和 parse.urlsplit 函数</h2><p>有时候拿到一个 url，想要对这个 url 中的各个组成部分进行分割，那么这时候就可以使用<br>urlparse 或者是 urlsplit 来进行分割。示例代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parseurl <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/s?username=zhiliao'</span>result1 <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlsplit<span class="token punctuation">(</span>url<span class="token punctuation">)</span>result2 <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span></code></pre><p>结果如下图：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593771183471.jpg"><br>从图中可以看出：urlparse 和 urlsplit 基本上是一模一样的。唯一不一样的地方是，urlparse 里面多了一个 params 属性，而 urlsplit 没有这个 params 属性。如果将上面代码的url换一下就能看出区别：</p><pre class=" language-python"><code class="language-python">!<span class="token punctuation">[</span><span class="token number">1593773675938</span><span class="token punctuation">]</span><span class="token punctuation">(</span>E<span class="token punctuation">:</span><span class="token operator">%</span>5CGridea<span class="token operator">%</span>5Cpost<span class="token operator">-</span>images<span class="token operator">%</span><span class="token number">5C1593773675938.</span>jpg<span class="token punctuation">)</span>!<span class="token punctuation">[</span><span class="token number">1593773675938</span><span class="token punctuation">]</span><span class="token punctuation">(</span>E<span class="token punctuation">:</span><span class="token operator">%</span>5CGridea<span class="token operator">%</span>5Cpost<span class="token operator">-</span>images<span class="token operator">%</span><span class="token number">5C1593773675938.</span>jpg<span class="token punctuation">)</span><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span>parseurl <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/s;hello?wd=python&amp;username=abc#1'</span>result1 <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlsplit<span class="token punctuation">(</span>url<span class="token punctuation">)</span>result2 <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span></code></pre><p>结果：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593773675938.jpg"><br>不过params属性很少用到，所以这两种方法基本可以视为相同</p><h2 id="ProxyHandler-处理器（代理设置）"><a href="#ProxyHandler-处理器（代理设置）" class="headerlink" title="ProxyHandler 处理器（代理设置）"></a>ProxyHandler 处理器（代理设置）</h2><p>很多网站会检测某一段时间某个 IP 的访问次数(通过流量统计，系统日志等)，如果访问次数多的不像正常人，它会禁止这个 IP 的访问。所以我们可以设置一些代理服务器，每隔一段时间换一个代理，就算 IP 被禁止，依然可以换个 IP 继续爬取。urllib 中通过 ProxyHandler 来设置使用代理服务器，下面代码说明如何使用自定义 opener来使用代理：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> urlliburl <span class="token operator">=</span> <span class="token string">'http://httpbin.org/ip'</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">"Mozilla/5.0 (Macintosh; U; Mac OS X Mach-O; enUS; rv:2.0a) Gecko/20040614 Firefox/3.0.0 "</span><span class="token punctuation">}</span>req <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>resp <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">,</span>timeout <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'163.204.240.95:9999'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>resp <span class="token operator">=</span> opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>运行结果如下图：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1593787948833.jpg"><br>可以看出，我们的向目标服务器发送请求的ip地址已经变了，这样就能有效防止目标服务器封我们ip而导致爬虫无法完整运行。</p><blockquote><p>ps:这个网址：<a href="http://httpbin.org/ip%EF%BC%8C%E8%83%BD%E5%B8%AE%E6%88%91%E4%BB%AC%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%AF%A2%E6%88%91%E4%BB%AC%E7%9A%84ip%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BF%9D%E5%AD%98%E4%B8%8B%E6%9D%A5%E4%BD%BF%E7%94%A8%E5%93%A6" target="_blank" rel="noopener">http://httpbin.org/ip，能帮我们快速查询我们的ip地址，可以保存下来使用哦</a><br>常见的代理获取可以点<a href="http://www.kuaidaili.com/" target="_blank" rel="noopener">这里</a>去看看，可以使用免费的代理，当然体验肯定没有付费的代理来得好。</p></blockquote><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>小总结一下，用urllib库基本上就可以写一些比较简单的爬虫了，但这里我们想象中的那种强大的爬虫还是有些差距，所以还需要继续学习呀！</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫（1）——前置知识</title>
      <link href="python-spyder-1/"/>
      <url>python-spyder-1/</url>
      
        <content type="html"><![CDATA[<h3 id="什么是爬虫"><a href="#什么是爬虫" class="headerlink" title="什么是爬虫"></a>什么是爬虫</h3><ul><li>通俗理解：爬虫是一个模拟人类请求网站行为的程序。可以自动请求网页、并数据抓取 下来，然后使用一定的规则提取有价值的数据。</li><li>专业介绍可参考：<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/5162711?fr=aladdin" target="_blank" rel="noopener">百度百科</a><h3 id="什么是-http-和-https-协议"><a href="#什么是-http-和-https-协议" class="headerlink" title="什么是 http 和 https 协议"></a>什么是 http 和 https 协议</h3></li><li>HTTP 协议：全称是 HyperText Transfer Protocol，中文意思是超文本传输协议， 是一种发布和接收 HTML 页面的方法。服务器端口号是 80 端口。</li><li>HTTPS 协议：是 HTTP 协议的加密版本，在 HTTP 下加入了 SSL 层。（数据传输更加安 全）服务器端口号是 443 端口。<h3 id="在浏览器中发送一个-http-请求的过程"><a href="#在浏览器中发送一个-http-请求的过程" class="headerlink" title="在浏览器中发送一个 http 请求的过程"></a>在浏览器中发送一个 http 请求的过程</h3></li></ul><ol><li>当用户在浏览器的地址栏中输入一个 URL 并按回车键之后，浏览器会向 HTTP 服务器 发送 HTTP 请求。HTTP 请求主要分为“Get”和“Post”两种方法。 </li><li>当我们在浏览器输入 URL <a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com</a> 的时候，浏览器发送一个 Request 请 求去获取 <a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com</a> 的 html 文件，服务器把 Response 文件对象发送回给 浏览器。</li><li>浏览器分析 Response 中的 HTML，发现其中引用了很多其他文件，比如 Images 文件， CSS 文件，JS 文件。 浏览器会自动再次发送 Request 去获取图片，CSS 文件，或者 JS 文件。 </li><li>当所有的文件都下载成功后，网页会根据 HTML 语法结构，完整的显示出来了。<h3 id="url-详解"><a href="#url-详解" class="headerlink" title="url 详解"></a>url 详解</h3>URL 是 Uniform Resource Locator 的简写，统一资源定位符。一个 URL 由以下几部分组成： scheme://host:port/path/?query-string=xxx&amp;query-string=xxx#anchor </li></ol><ul><li><strong>scheme</strong>：代表的是访问的协议，一般为 http 或者 https 以及 ftp 等。 </li><li><strong>host</strong>：主机名，域名，比如 <a href="http://www.baidu.com./" target="_blank" rel="noopener">www.baidu.com。</a> </li><li><strong>port</strong>：端口号。当你访问一个网站的时候，浏览器默认使用 80 端口。 </li><li><strong>path</strong>：查找路径。比如：<a href="http://www.jianshu.com/trending/now%EF%BC%8C%E5%90%8E%E9%9D%A2%E7%9A%84" target="_blank" rel="noopener">www.jianshu.com/trending/now，后面的</a> trending/now 就是 path。 </li><li><strong>query-string</strong>：查询字符串，比如：<a href="http://www.baidu.com/s?wd=python%EF%BC%8C%E5%90%8E%E9%9D%A2%E7%9A%84" target="_blank" rel="noopener">www.baidu.com/s?wd=python，后面的</a> wd=python 就是查询字符串。 </li><li><strong>anchor</strong>：锚点，后台一般不用管，前端用来做页面定位的。(就相当于一个页面中有目 录，目录的跳转就是锚点的作用) 在浏览器中请求一个 url，浏览器会对这个 url 进行一个编码。除英文字母，数字和部分符号 外，其他的全部使用百分号+十六进制码值进行编码。<h3 id="常见请求方法"><a href="#常见请求方法" class="headerlink" title="常见请求方法"></a>常见请求方法</h3>在 Http 协议中，定义了八种请求方法。这里介绍两种常用的请求方法，分别是 get 请求和 post 请求。 </li><li><strong>get 请求</strong>：一般情况下，只从服务器获取数据下来，并不会对服务器资源产生任何影响 的时候会使用 get 请求。 </li><li><strong>post 请求</strong>：向服务器发送数据（登录）、上传文件等，会对服务器资源产生影响的时候 会使用 post 请求。 以上是在网站开发中常用的两种方法。并且一般情况下都会遵循使用的原则。但是有的 网站和服务器为了做反爬虫机制，也经常会不按常理出牌，有可能一个应该使用 get 方 法的请求就一定要改成 post 请求，这个要视情况而定。</li><li>更多的请求，可以参考：<a href="https://www.runoob.com/http/http-methods.html" target="_blank" rel="noopener">菜鸟教程</a><h3 id="常见响应状态码"><a href="#常见响应状态码" class="headerlink" title="常见响应状态码"></a>常见响应状态码</h3></li><li>200：请求正常，服务器正常的返回数据。 </li><li>301：永久重定向。比如在访问 <a href="http://www.jingdong.com/" target="_blank" rel="noopener">www.jingdong.com</a> 的时候会重定向到 <a href="http://www.jd.com./" target="_blank" rel="noopener">www.jd.com。</a></li><li>302：临时重定向。比如在访问一个需要登录的页面的时候，而此时没有登录，那么就 会重定向到登录页面。 </li><li>400：请求的 url 在服务器上找不到。换句话说就是请求 url 错误。 </li><li>403：服务器拒绝访问，权限不够。 </li><li>500：服务器内部错误。可能是服务器出现 bug 了。<h3 id="请求头常见参数"><a href="#请求头常见参数" class="headerlink" title="请求头常见参数"></a>请求头常见参数</h3>在 http 协议中，向服务器发送一个请求，数据分为三部分，第一个是把数据放在 url 中，第 二个是把数据放在 body 中（在 post 请求中），第三个就是把数据放在 head 中。 这里介绍在网络爬虫中经常会用到的一些请求头参数： </li><li><strong>User-Agent</strong>：浏览器名称。这个在网络爬虫中经常会被使用到。请求一个网页的时候， 服务器通过这个参数就可以知道这个请求是由哪种浏览器发送的。如果我们是通过爬虫 发送请求，那么我们的 User-Agent 就是 Python，这对于那些有反爬虫机制的网站来说， 可以轻易的判断你这个请求是爬虫。因此我们要经常设置这个值为一些浏览器的值，来 伪装我们的爬虫。 </li><li><strong>Referer</strong>：表明当前这个请求是从哪个 url 过来的。这个一般也可以用来做反爬虫技术。 如果不是从指定页面过来的，那么就不做相关的响应。 </li><li><strong>Cookie</strong>：http 协议是无状态的。也就是同一个人发送了两次请求，服务器没有能力知道 这两个请求是否来自同一个人。因此这时候就用 cookie 来做标识。一般如果想要做登 录后才能访问的网站，那么就需要发送 cookie 信息了。</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——numpy（2）</title>
      <link href="numpy-2/"/>
      <url>numpy-2/</url>
      
        <content type="html"><![CDATA[<p>继续来学习numpy：</p><h2 id="一、索引和切片"><a href="#一、索引和切片" class="headerlink" title="一、索引和切片"></a>一、索引和切片</h2><p>前面学了用numpy来创建各种各样的数组，这些数组都是<code>ndarray</code>对象，都支持索引和切片操作。<code>ndarray</code>对象的索引与python中的<code>list</code>基本一致：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> aarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#也是从0开始索引</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token number">5</span><span class="token comment" spellcheck="true">#再看二维数组索引</span><span class="token operator">>></span><span class="token operator">></span> aa<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> aaarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>></span><span class="token operator">></span> aa<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> aa<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token number">9</span></code></pre><p>更高维度数组元素的索引和上述方式大同小异，再来看切片，先用和列表一样的方法来试试：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> b<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> barray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>可以发现，这种方法是完全可行的，还可以利用python内置函数<code>slice</code>进行切片：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span>slice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取出b中从索引1开始到索引8的元素，间隔为2</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>看完了一维数组，再来看看二维数组元素的切片,二维数组里边我们经常有取一整列或者一整行的需求，可以使用<code>...</code>和<code>:</code>来进行切片，具体操作如下：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> bb<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bbarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取数组bb里第一列元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#跟bb[...,0]作用相同</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取数组bb里第一行元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#跟bb[1,...]作用相同</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#还可以取几列或者几行元素</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取第0列和第1列全部元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取第0行和第1行的全部元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取第0行和第1行上第1列和第2列的元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> bb<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#取全部元素</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="二、数组变形"><a href="#二、数组变形" class="headerlink" title="二、数组变形"></a>二、数组变形</h2><p>numpy里面的数组，还可以进行变形操作，主要有以下几种操作：</p><h3 id="1-改变数组形状"><a href="#1-改变数组形状" class="headerlink" title="1.改变数组形状"></a>1.改变数组形状</h3><p>在numpy中，封装了reshape函数来对数组进行变形操作，它一共接收三个参数：<code>numpy.reshape(arr, newshape, order=&#39;C&#39;)</code>，各个参数的描述如下：</p><table><thead><tr><th align="center">参数</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">arr</td><td align="center">需要修改形状的数组</td></tr><tr><td align="center">reshape</td><td align="center">修改后数组的形状，传入的应该是整数或者整数数组,而且总的元素数量应该与arr一致</td></tr><tr><td align="center">order</td><td align="center">‘C’ – 按行，’F’ – 按列，’A’ – 原顺序，’k’ – 元素在内存中的出现顺序</td></tr></tbody></table><p>来看一下例子：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a1<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a1array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a2<span class="token operator">=</span>np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a2array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a3<span class="token operator">=</span>np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order<span class="token operator">=</span><span class="token string">'F'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a3array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a4<span class="token operator">=</span>np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>a1<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>order<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a4array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>也可以使用a1.reshape()来进行数组变形，跟上面的效果一样</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a6<span class="token operator">=</span>a1<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a6array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 id="2-转置"><a href="#2-转置" class="headerlink" title="2.转置"></a>2.转置</h3><p>矩阵转置有两种方法：</p><ul><li><strong>transpose函数</strong></li><li><strong>ndarray.T</strong><br>二者基本上等价，来看个例子：<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> b1<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b1array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b2<span class="token operator">=</span>np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b2array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b3<span class="token operator">=</span>b1<span class="token punctuation">.</span>T<span class="token operator">>></span><span class="token operator">></span> b3array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 id="3-广播（broadcost）"><a href="#3-广播（broadcost）" class="headerlink" title="3.广播（broadcost）"></a>3.广播（broadcost）</h3>我们知道，矩阵运算通常对矩阵的维度有要求，所以numpy里边用广播机制来使矩阵满足维度要求。当运算中的 2 个数组的形状不同时，numpy 将自动触发广播机制。如：<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> aarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">+</span>barray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>广播机制内容较多，这里只简单介绍，详细学习可参考<a href="https://www.cnblogs.com/jiaxin359/p/9021726.html" target="_blank" rel="noopener">这篇博客</a><h2 id="三、通用函数"><a href="#三、通用函数" class="headerlink" title="三、通用函数"></a>三、通用函数</h2>通用函数，也可以称为ufunc，是一种在ndarray数据中进行<strong>逐元素操作</strong>的函数。某些简单函数接受一个或多个标量数值，并产生一个或多个标量数值，而通用函数就是对这些简单函数的向量化封装<h3 id="3-1一元通用函数"><a href="#3-1一元通用函数" class="headerlink" title="3.1一元通用函数"></a>3.1一元通用函数</h3>有很多ufunc是简单的逐元素转换，比如<code>sqrt</code>或者<code>exp</code>函数：<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> arr<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> arrarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">1.41421356</span><span class="token punctuation">,</span> <span class="token number">1.73205081</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>     <span class="token number">2.23606798</span><span class="token punctuation">,</span> <span class="token number">2.44948974</span><span class="token punctuation">,</span> <span class="token number">2.64575131</span><span class="token punctuation">,</span> <span class="token number">2.82842712</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.00000000e+00</span><span class="token punctuation">,</span> <span class="token number">2.71828183e+00</span><span class="token punctuation">,</span> <span class="token number">7.38905610e+00</span><span class="token punctuation">,</span> <span class="token number">2.00855369e+01</span><span class="token punctuation">,</span>     <span class="token number">5.45981500e+01</span><span class="token punctuation">,</span> <span class="token number">1.48413159e+02</span><span class="token punctuation">,</span> <span class="token number">4.03428793e+02</span><span class="token punctuation">,</span> <span class="token number">1.09663316e+03</span><span class="token punctuation">,</span>     <span class="token number">2.98095799e+03</span><span class="token punctuation">,</span> <span class="token number">8.10308393e+03</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>这类函数我们把它称为一元通用函数，在这里列举一些常见的一元通用函数：</li></ul><table><thead><tr><th align="center">函数名</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">abs、fabs</td><td align="center">逐元素的计算整数、浮点数或者复数的绝对值</td></tr><tr><td align="center">sqrt</td><td align="center">计算每个元素的平方根（与$arr^{0.5}$等价）</td></tr><tr><td align="center">square</td><td align="center">计算每个元素的平方（与$arr^2$等价）</td></tr><tr><td align="center">exp</td><td align="center">计算每个元素的以自然底数为底的指数值$e^2$</td></tr><tr><td align="center">log、log10、log2、log1p</td><td align="center">分别对应：自然对数（e为底）、对数10为底、对数2为底、$log(1+x)$</td></tr><tr><td align="center">sign</td><td align="center">计算每个元素的符号值：1（表示正数）、0表示数字0、-1表示复数</td></tr><tr><td align="center">ceil</td><td align="center">计算每个元素的向上取整（大于等于给定数字的最小整数）</td></tr><tr><td align="center">floor</td><td align="center">计算每个元素的向下取整（小于等于给定数字的最大整数）</td></tr><tr><td align="center">rint</td><td align="center">将每个元素保留整数位，并保持dtype</td></tr><tr><td align="center">modf</td><td align="center">将每个元素的整数位和小数位分开，并按数组形式返回</td></tr><tr><td align="center">isnan</td><td align="center">判断各个元素是不是NAN（不是一个数值）并返回布尔值数组</td></tr><tr><td align="center">isfinite、isinf</td><td align="center">判断数组中各元素是否有限、是否无限，并返回布尔值数组</td></tr><tr><td align="center">cos、cosh、sin、sinh、tan、tanh</td><td align="center">常规的双曲三角函数</td></tr><tr><td align="center">arccos、arccosh、arcsin、arcsinh、arctan、arctanh</td><td align="center">反三角函数</td></tr><tr><td align="center">logical_not</td><td align="center">对数组的元素按位取反（与-arr等价）</td></tr></tbody></table><h3 id="3-2二元通用函数"><a href="#3-2二元通用函数" class="headerlink" title="3.2二元通用函数"></a>3.2二元通用函数</h3><p>还有一些通用函数，比如add或者maximum则会接收两个数组并返回一个数组作为结果，因此成为二元通用函数，在这列举一些：</p><table><thead><tr><th align="center">函数名</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">add</td><td align="center">将数组的对应元素相加</td></tr><tr><td align="center">subtract</td><td align="center">在第二个数组中，将第一个数组中包含的元素去除</td></tr><tr><td align="center">multiply</td><td align="center">将数组的对应元素相乘</td></tr><tr><td align="center">devide、floor_devide</td><td align="center">除或整除（放弃余数）</td></tr><tr><td align="center">power</td><td align="center">将第二个数组的元素作为第一个数组对应元素的幂次方</td></tr><tr><td align="center">maximum、fmax</td><td align="center">逐个元素计算最大值，fmax会忽略NaN</td></tr><tr><td align="center">minimum、fmin</td><td align="center">逐个元素计算最小值，fmin会忽略NaN</td></tr><tr><td align="center">mod</td><td align="center">按元素的求模计算（即求除法的余数）</td></tr><tr><td align="center">copysign</td><td align="center">将第一个数组的符号值改为第二个数组的符号值</td></tr><tr><td align="center">greater、greater_equal、less、less_equal、equal、not_equal</td><td align="center">进行逐个元素的比较，返回布尔值数组（分别与数学操作符<code>&gt;,&gt;=,&lt;,&lt;=,==,!=</code>对应效果一致）</td></tr><tr><td align="center">logical_and、logical_or、logical_xor</td><td align="center">进行逐个元素的逻辑操作，与逻辑操作`&amp;,</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——numpy（1）</title>
      <link href="numpy-1/"/>
      <url>numpy-1/</url>
      
        <content type="html"><![CDATA[<p>学过python的人应该都接触过<a href="https://baike.baidu.com/item/numpy/5678437?fr=aladdin" target="_blank" rel="noopener"><strong>numpy</strong></a>这个有名的第三方库，它是一个支持大量的维度数组与矩阵运算，此外也针对数组运算提供大量的数学函数库。</p><h1 id="1-安装numpy"><a href="#1-安装numpy" class="headerlink" title="1.安装numpy"></a>1.安装numpy</h1><p>安装方法有两种：</p><ul><li>pip安装：直接在命令行里键入<code>pip install numpy</code>即可，如果遇到安装速度过慢的情况，可以考虑到清华镜像源下载安装。</li><li>conda安装，在anaconda powershell里输入<code>conda install numpy</code>,速度慢也可以换源。<br>我这里已经安装好了，显示如下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1592147524509.jpg"><br>打开idle验证一下安装是否成功：<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>__version__<span class="token comment" spellcheck="true">#打印版本信息</span><span class="token string">'1.16.5'</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#生成值全为1的数组</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>正确生成了数组，说明numpy安装成功<h1 id="2-基础操作"><a href="#2-基础操作" class="headerlink" title="2. 基础操作"></a>2. 基础操作</h1><h2 id="2-1通过维度创建数组"><a href="#2-1通过维度创建数组" class="headerlink" title="2.1通过维度创建数组"></a>2.1通过维度创建数组</h2>先看由指定维度来创建数组的方法：<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#创建一维数组</span><span class="token operator">>></span><span class="token operator">></span> aarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>）<span class="token operator">>></span><span class="token operator">></span> b<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#创建二维数组，高维度同理</span><span class="token operator">>></span><span class="token operator">></span> barray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#生成指定维度的值全为0的数组</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">##生成指定维度的值全为1的数组</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#生成指定维度的值为随机数的数组</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>empty_like<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#生成和b数组同维度的值为随机数的数组</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>在实际操作中，通过生成a，b数组的方式来创建高维度数组时会显得很麻烦，所以一般使用<code>np.ones</code>或<code>np.zeros</code>来生成指定维度的数组，然后对其中的元素进行修改。<h2 id="2-2通过数值范围创建数组"><a href="#2-2通过数值范围创建数组" class="headerlink" title="2.2通过数值范围创建数组"></a>2.2通过数值范围创建数组</h2><h3 id="2-2-1等差数列"><a href="#2-2-1等差数列" class="headerlink" title="2.2.1等差数列"></a>2.2.1等差数列</h3>有时候，我们需要通过数值范围来创建数组，比如现在需要一个从1到100的公差为2的等差数列，通过前面的方法也可以创建（先生成指定维度的0数组，再利用循环进行赋值），这样会显得比较繁琐，可以使用<code>arange</code>函数：<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#以生成1到20的公差为2的等差数列为例</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>stop<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>step<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#详细写法</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span>     <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><code>arange</code>函数中需要三个参数，依次是起始点、终止点和步长，可以看出：即使步长设置为1，输出的数组也是不包括终止点的，所以<code>arange</code>函数的输入可以看做一个左闭右开区间，如果想要包括终止点，可以让终止点增大一个步长。</li></ul><p>除了<code>arange</code>函数，还有一个<code>linspace</code>函数也可以生成等差数列：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#以生成1到10的公差为1的等差数列为例</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>stop<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#详细写法</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span> <span class="token number">1.9</span><span class="token punctuation">,</span> <span class="token number">2.8</span><span class="token punctuation">,</span> <span class="token number">3.7</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">7.3</span><span class="token punctuation">,</span> <span class="token number">8.2</span><span class="token punctuation">,</span> <span class="token number">9.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p><code>linspace</code>函数中需要至少三个参数，依次为起始点、终止点和要生成的等间距点的数量，还有一个可选参数<code>endpoint</code>，它的默认值为<code>True</code>，表示默认包括终止点，此时可将输入理解为一个闭区间，将其设置为<code>False</code>后，输入又变成了一个左闭右开区间。</p><h3 id="2-2-2等比数列"><a href="#2-2-2等比数列" class="headerlink" title="2.2.2等比数列"></a>2.2.2等比数列</h3><p><code>numpy</code>同样有函数来创建满足需要的等比数列，函数名字叫<code>logspace</code>，该函数有<code>start</code>、<code>stop</code>、<code>num</code>、<code>endpoint</code>、<code>base</code>五个参数，</p><table><thead><tr><th align="center">参数</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">start</td><td align="center">表示所生成数列的起始值为${base}^{start}$</td></tr><tr><td align="center">stop</td><td align="center">表示所生成数列的终止值为$base^{stop}$</td></tr><tr><td align="center">num</td><td align="center">要生成的等步长的样本数量，默认为50</td></tr><tr><td align="center">endpoint</td><td align="center">该值为 True 时，数列中中包含$base^{stop}$ 值，反之不包含，默认是True。</td></tr><tr><td align="center">base</td><td align="center">对数 log 的底数，默认值为10</td></tr></tbody></table><p>实例如下：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#生成1到10000的等差数列</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>logspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.e+00</span><span class="token punctuation">,</span> <span class="token number">1.e+01</span><span class="token punctuation">,</span> <span class="token number">1.e+02</span><span class="token punctuation">,</span> <span class="token number">1.e+03</span><span class="token punctuation">,</span> <span class="token number">1.e+04</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>logspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.00000000e+00</span><span class="token punctuation">,</span> <span class="token number">6.30957344e+00</span><span class="token punctuation">,</span> <span class="token number">3.98107171e+01</span><span class="token punctuation">,</span> <span class="token number">2.51188643e+02</span><span class="token punctuation">,</span>       <span class="token number">1.58489319e+03</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#生成1到128的等差数列</span><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>logspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>   <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>   <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span>   <span class="token number">8</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">16</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">32</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">64</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="2-3数据类型"><a href="#2-3数据类型" class="headerlink" title="2.3数据类型"></a>2.3数据类型</h2><p>在上述的各种函数中，其实都还有一个参数，名字为<code>dtype</code>，它可以用来指定数组中元素的类型，举一个例子：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> c<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> carray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> c<span class="token punctuation">.</span>dtypedtype<span class="token punctuation">(</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> d<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> darray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float32<span class="token punctuation">)</span></code></pre><p>这里再附上numpy里的数据类型表（转载于<a href="https://www.runoob.com/numpy/numpy-dtype.html" target="_blank" rel="noopener">菜鸟教程</a>）：</p><table><thead><tr><th align="center">名称</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">bool_</td><td align="center">布尔型数据类型（True 或者 False）</td></tr><tr><td align="center">int_</td><td align="center">默认的整数类型（类似于 C 语言中的 long，int32 或 int64）</td></tr><tr><td align="center">intc</td><td align="center">与 C 的 int 类型一样，一般是 int32 或 int 64</td></tr><tr><td align="center">intp</td><td align="center">用于索引的整数类型（类似于 C 的 ssize_t，一般情况下仍然是 int32 或 int64）</td></tr><tr><td align="center">int8</td><td align="center">字节（-128 to 127）</td></tr><tr><td align="center">int16</td><td align="center">整数（-32768 to 32767）</td></tr><tr><td align="center">int32</td><td align="center">整数（-2147483648 to 2147483647）</td></tr><tr><td align="center">int64</td><td align="center">整数（-9223372036854775808 to 9223372036854775807）</td></tr><tr><td align="center">uint8</td><td align="center">无符号整数（0 to 255）</td></tr><tr><td align="center">uint16</td><td align="center">无符号整数（0 to 65535）</td></tr><tr><td align="center">uint32</td><td align="center">无符号整数（0 to 4294967295）</td></tr><tr><td align="center">uint64</td><td align="center">无符号整数（0 to 18446744073709551615）</td></tr><tr><td align="center">float_</td><td align="center">float64 类型的简写</td></tr><tr><td align="center">float16</td><td align="center">半精度浮点数，包括：1 个符号位，5 个指数位，10 个尾数位</td></tr><tr><td align="center">float32</td><td align="center">单精度浮点数，包括：1 个符号位，8 个指数位，23 个尾数位</td></tr><tr><td align="center">float64</td><td align="center">双精度浮点数，包括：1 个符号位，11 个指数位，52 个尾数位</td></tr><tr><td align="center">complex_</td><td align="center">complex128 类型的简写，即 128 位复数</td></tr><tr><td align="center">complex64</td><td align="center">复数，表示双 32 位浮点数（实数部分和虚数部分）</td></tr><tr><td align="center">complex128</td><td align="center">复数，表示双 64 位浮点数（实数部分和虚数部分）</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——文件读写</title>
      <link href="python-io/"/>
      <url>python-io/</url>
      
        <content type="html"><![CDATA[<p>读写文件是最常见的IO操作。Python内置了读写文件的函数，用法和C是兼容的。</p><p>在磁盘上读写文件的功能都是由操作系统提供的，现代操作系统不允许普通的程序直接操作磁盘，所以，读写文件就是请求操作系统打开一个文件对象（通常称为文件描述符），然后，通过操作系统提供的接口从这个文件对象中读取数据（读文件），或者把数据写入这个文件对象（写文件）。</p><h2 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h2><p>要以读文件的模式打开一个文件对象，使用Python内置的open()函数，传入文件名和标示符要注意的是：文件使用完毕后必须关闭，因为文件对象会占用操作系统的资源，并且操作系统同一时间能打开的文件数量也是有限的，例子如下：<br><img src="https://gitee.com/ranchongzhi/blog_images/raw/master/img/1591280519170.jpg"><br>使用open语句读取文件内全部字符：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#读取txt文件</span>f<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#r表示以只读方式打开文件</span><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#read方法读取所有字符</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>pythonjavacc<span class="token operator">+</span><span class="token operator">+</span></code></pre><p>由于文件路径以及其他原因，open语句经常会报错<code>IOError</code>，报错之后<code>f.close()</code>就不会再被执行了，这是我们不想看到的，所以可以使用<code>try</code>语句改进上面的代码，如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    f<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">###输出如下：</span>pythonjavacc<span class="token operator">+</span><span class="token operator">+</span></code></pre><p>但这样又显得代码量较大，这与<a href="https://blog.csdn.net/Albert_1000/article/details/89494512" target="_blank" rel="noopener">python之禅</a>是相违背的，因此<code>with</code>语句就诞生了，该语句会在执行时自动帮我们调用<code>close</code>方法，改进后的代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">###输出如下：</span>pythonjavacc<span class="token operator">+</span><span class="token operator">+</span></code></pre><p>两行代码既稳定又简洁的读取了文件内容。</p><p>调用<code>read()</code>会一次性读取文件的全部内容，如果文件有10G，内存就爆了，所以，要保险起见，可以反复调用<code>read(size)</code>方法，每次最多读取<code>size</code>个字节的内容。另外，调用<code>readline()</code>可以每次读取一行内容，调用<code>readlines()</code>一次读取所有内容并按行返回list。因此，可以根据需要决定怎么调用。例如还是读取刚才的文件：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span><span class="token punctuation">[</span><span class="token string">'python\n'</span><span class="token punctuation">,</span> <span class="token string">'java\n'</span><span class="token punctuation">,</span> <span class="token string">'c\n'</span><span class="token punctuation">,</span> <span class="token string">'c++'</span><span class="token punctuation">]</span></code></pre><h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h2><p>写入文件之前也需要先用<code>open</code>方法打开文件，例子如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#r+表示可读可写模式</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\ngo'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"写入后的文件："</span><span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>pythonjavacc<span class="token operator">+</span><span class="token operator">+</span>写入后的文件：pythonjavacc<span class="token operator">+</span><span class="token operator">+</span>go</code></pre><p>可以看出，<code>r+</code>模式下写入字符，是直接在文本末尾添加字符的，而另外一种写入模式<code>w</code>与此不同：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#r+表示可读可写模式</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'go'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"写入后的文件："</span><span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出如下：</span>pythonjavacc<span class="token operator">+</span><span class="token operator">+</span>写入后的文件：go</code></pre><p>可以看出，<code>w</code>模式下写入会直接覆盖掉原有字符，相当于把原文件内容清空在写入新字符</p><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>读取文件和写入文件默认的编码都是<code>UTF-8</code>，如果被读文件不是以该方式编码的，那么读取出来的内容就会出现乱码的情况，这个时候只需要向<code>open</code>函数里传入一个<code>encoding</code>参数即可</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#r+表示可读可写模式</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>遇到有些编码不规范的文件，直接读取可能会报错，因为在文本文件中可能夹杂了一些非法编码的字符。遇到这种情况，<code>open()</code>函数还可以接收一个<code>errors</code>参数，表示如果遇到编码错误后如何处理。最简单的方式是直接忽略：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">,</span>errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#r+表示可读可写模式</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="最后附上所有文件读写模式表"><a href="#最后附上所有文件读写模式表" class="headerlink" title="最后附上所有文件读写模式表"></a>最后附上所有文件读写模式表</h2><table><thead><tr><th align="center">模式</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">r</td><td align="center">只读模式</td></tr><tr><td align="center">w</td><td align="center">只写模式，创建新文件（清除路径下同名文件中的数据）</td></tr><tr><td align="center">x</td><td align="center">只写模式，创建新文件，但存在同名路径时会创建失败</td></tr><tr><td align="center">a</td><td align="center">添加到已经存在的文件里，如果不存在就创建</td></tr><tr><td align="center">r+</td><td align="center">读写模式</td></tr><tr><td align="center">b</td><td align="center">二进制文件的模式，可以添加到别的模式中，如”rb“或”wb“</td></tr><tr><td align="center">t</td><td align="center">文件的文本模式（自动将字节解码为Unicode）。如果没有指明模式，默认使用此模式，也可以添加到其它模式中（”rt“、”xt“）</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——集合（set）与字典（dict）</title>
      <link href="python-2/"/>
      <url>python-2/</url>
      
        <content type="html"><![CDATA[<h1 id="一、字典（dict）"><a href="#一、字典（dict）" class="headerlink" title="一、字典（dict）"></a>一、字典（dict）</h1><p>字典是python内置的一种数据类型，使用键-值（key-value）的方式进行存储，得益于该存储方式，字典具有很快的查找速度。例如，想快速根据关键字姓名查询学生成绩，那么存储方式就可以采用字典。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#初始化一个字典</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Mike'</span><span class="token punctuation">:</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token string">'Lucy'</span><span class="token punctuation">:</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token string">'Jane'</span><span class="token punctuation">:</span><span class="token number">85</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">{</span><span class="token string">'Mike'</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">:</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token comment" spellcheck="true">#根据关键字快速查询value</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">[</span><span class="token string">'Lucy'</span><span class="token punctuation">]</span><span class="token number">79</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">]</span><span class="token number">90</span></code></pre><p>对字典里的value值也可以进行替换</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">95</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">{</span><span class="token string">'Mike'</span><span class="token punctuation">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">:</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">}</span></code></pre><p>可以删除指定的key（该key对应的value也会被删掉）</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">)</span><span class="token number">85</span><span class="token operator">>></span><span class="token operator">></span> score<span class="token punctuation">{</span><span class="token string">'Mike'</span><span class="token punctuation">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">:</span> <span class="token number">79</span><span class="token punctuation">}</span></code></pre><p>字典查询速度很快，但也有缺点，它会较多内存，是一种空间换取时间的方式；而列表恰恰与它相反，当元素过多时查找速度会变慢，但占用内存比较少</p><h1 id="二、集合（set）"><a href="#二、集合（set）" class="headerlink" title="二、集合（set）"></a>二、集合（set）</h1><p>set中的元素是不重复的，无序的。里面的元素必须是可hash的(int, str, tuple,bool), 我们可以这样来记。set就是dict类型的数据但是不保存value, 只保存key。 set也用{}表示，set集合中的元素必须是可hash的, 但是set本身是不可hash得.，set是可变的。</p><h2 id="1-创建集合"><a href="#1-创建集合" class="headerlink" title="1.创建集合"></a>1.创建集合</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#方法一</span><span class="token operator">>></span><span class="token operator">></span> s1<span class="token operator">=</span>set<span class="token punctuation">(</span><span class="token string">'boy'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s1<span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token comment" spellcheck="true">#方法二</span><span class="token operator">>></span><span class="token operator">></span> s2<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> s2<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'set'</span><span class="token operator">></span></code></pre><h2 id="2-增删"><a href="#2-增删" class="headerlink" title="2.增删"></a>2.增删</h2><p>集合的添加有两种常用方法，分别是add和update。集合add方法：是把要传入的元素做为一个整个添加到集合中，例如：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'boy'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">}</span></code></pre><p>集合update方法：是把要传入的元素拆分，做为个体传入到集合中，例如：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token string">'boy'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span></code></pre><p> 集合删除操作方法：remove</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a<span class="token operator">=</span>set<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">{</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">}</span></code></pre><h2 id="3-其他"><a href="#3-其他" class="headerlink" title="3.其他"></a>3.其他</h2><p> set可以看成数学意义上的无序和无重复元素的集合，因此，两个set可以做数学意义上的交集、并集等操作：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s2 <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">&amp;</span> s2<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">|</span> s2<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span></code></pre><h2 id="4-不可变对象"><a href="#4-不可变对象" class="headerlink" title="4.不可变对象"></a>4.不可变对象</h2><p>接下来看一个“奇怪的”现象：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#将元素a换成A</span><span class="token string">'Abc'</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token string">'abc'</span></code></pre><p>为什么调用了<code>replace</code>方法后<code>a</code>的值没有发生改变呢？我们改进一下代码：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> b<span class="token string">'Abc'</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token string">'abc'</span><span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#查询变量存储地址</span><span class="token number">2417392456560</span><span class="token operator">>></span><span class="token operator">></span> id<span class="token punctuation">(</span><span class="token string">'Abc'</span><span class="token punctuation">)</span><span class="token number">2417402248688</span></code></pre><p>可以发现，a指向的值是一直不变的，当我们调用<code>replace</code>的时候，a所指向的内存存储的’abc’没有发生改变，replace创建了一个新字符串’Abc’并返回。所以，对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的。</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python学习笔记——列表（list）和元组（tuple）</title>
      <link href="python-1/"/>
      <url>python-1/</url>
      
        <content type="html"><![CDATA[<h1 id="一、列表（list）"><a href="#一、列表（list）" class="headerlink" title="一、列表（list）"></a>一、列表（list）</h1><p>Python内置的一种数据类型是列表：list。list是一种有序的集合，可以随时添加和删除其中的元素。<br>例如：列出一些人名：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> name<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span><span class="token string">'Lucy'</span><span class="token punctuation">,</span><span class="token string">'Jane'</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">></span></code></pre><p>其中name就是一个list，用len函数可以获取列表元素的个数：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> len<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token number">3</span></code></pre><h2 id="1-索引操作"><a href="#1-索引操作" class="headerlink" title="1.索引操作"></a>1.索引操作</h2><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#正向索引（左往右索引，从0开始）</span><span class="token string">'Lucy'</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#负向索引（右往左索引，从-1开始）</span><span class="token string">'Jane'</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#正向索引越界</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;pyshell#6>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>    name<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>IndexError<span class="token punctuation">:</span> list index out of range<span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#负向索引越界</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;pyshell#8>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>    name<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>IndexError<span class="token punctuation">:</span> list index out of range</code></pre><h2 id="2-添加元素"><a href="#2-添加元素" class="headerlink" title="2.添加元素"></a>2.添加元素</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#添加元素到列表末尾</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#在列表中指定位置插入新元素</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Nike'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#将新元素插入到列表中索引为1的元素之前</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">]</span></code></pre><h2 id="3-删除元素"><a href="#3-删除元素" class="headerlink" title="3.删除元素"></a>3.删除元素</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#删除列表最后一个元素</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token string">'Bob'</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#删除列表指定位置的元素</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#删除列表中索引为1的元素</span><span class="token string">'Nike'</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">]</span></code></pre><h2 id="4-元素的替换"><a href="#4-元素的替换" class="headerlink" title="4.元素的替换"></a>4.元素的替换</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#直接采用索引赋值的方式即可</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'Peter'</span><span class="token operator">>></span><span class="token operator">></span> name<span class="token punctuation">[</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'Peter'</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">]</span></code></pre><h2 id="5-补充"><a href="#5-补充" class="headerlink" title="5.补充"></a>5.补充</h2><p>list的元素类型可以不同，如</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Apple'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span></code></pre><p>list的元素也可以是另外一个list，如</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'asp'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> len<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token number">4</span></code></pre><p> 要拿到<code>&#39;php&#39;</code>可以用<code>s[2][1]</code>，因此s可以看成是一个二维数组，类似的还有三维、四维……数组，不过很少用到。<br>如果一个list中一个元素也没有，就是一个空的list，它的长度为0：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> len<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token number">0</span></code></pre><h1 id="二、元组（tuple）"><a href="#二、元组（tuple）" class="headerlink" title="二、元组（tuple）"></a>二、元组（tuple）</h1><p>另一种有序列表叫元组：tuple。tuple和list非常类似，但是tuple一旦初始化就不能修改，比如同样是列出同学的名字：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> classmates <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Michael'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Tracy'</span><span class="token punctuation">)</span></code></pre><p>现在，<code>classmates</code>这个<code>tuple</code>不能变了，它也没有<code>append()</code>，<code>insert()</code>这样的方法。其他获取元素的方法和list是一样的，也可以正常地使用<code>classmates[0]</code>，<code>classmates[-1]</code>，但不能赋值成另外的元素。<br>不可变的tuple可以使代码更安全。如果可能，能用tuple代替list就尽量用tuple。<br>tuple的陷阱：当你定义一个tuple时，在定义的时候，tuple的元素就必须被确定下来，比如：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#定义空元组</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#定义只有一个元素的元组（要在元素后面加上逗号）</span><span class="token operator">>></span><span class="token operator">></span> tuple_1<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>tuple_1<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token operator">>></span><span class="token operator">></span> tuple_2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> type<span class="token punctuation">(</span>tuple_2<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple'</span><span class="token operator">></span></code></pre><p>注意：元组里的元素如果有列表，那么该列表里的元素可以改变，因为此时元组里的元素其实是没有改变的，tuple指向的那个list还是那个list。所以，tuple所谓的“不变”是说，tuple的每个元素，指向永远不变。即指向<code>&#39;a&#39;</code>，就不能改成指向<code>&#39;b&#39;</code>，指向一个list，就不能改成指向其他对象，但指向的这个list本身是可变的！例子：</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'X'</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>此时运行不报错，说明该元组是“可变的”</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见聚类模型</title>
      <link href="julei/"/>
      <url>julei/</url>
      
        <content type="html"><![CDATA[<p>今天来写写数学建模中的聚类模型，还是分为几个版块来写</p><h2 id="1-聚类模型简介"><a href="#1-聚类模型简介" class="headerlink" title="1.聚类模型简介"></a>1.聚类模型简介</h2><p>俗话说：“物以类聚，人以群分”，所谓的聚类，就是将样本划分为由类似的对象组成的多个类的过程。聚类之后，我们可以更加准确地在每个类中单独使用统计模型进行估计，分析或者预测；也可以研究不同类之间的差异。聚类算法常见的有<strong>K-means聚类算法，系统聚类算法，<a href="https://baike.baidu.com/item/DBSCAN/4864716?fr=aladdin" target="_blank" rel="noopener">DBSCAN</a>算法</strong></p><h2 id="2-K-means聚类算法"><a href="#2-K-means聚类算法" class="headerlink" title="2.K-means聚类算法"></a>2.K-means聚类算法</h2><h4 id="a-算法流程："><a href="#a-算法流程：" class="headerlink" title="a.算法流程："></a>a.算法流程：</h4><ul><li>指定需要划分的簇的个数，即K值（类的个数）；</li><li>随机的选择K个数据对象作为初始的聚类中心；</li><li>计算其余的各个数据对象到这K个聚类中心的距离，把数据对象划分到距离它最近的那个中心所在的簇中；</li><li>调整新类并计算出新的聚类中心；</li><li>循环第三和第四步，直到聚类中心不再发生变化，聚类结束。</li></ul><h4 id="b-算法评价与改进："><a href="#b-算法评价与改进：" class="headerlink" title="b.算法评价与改进："></a>b.算法评价与改进：</h4><ul><li>优点：算法简单迅速，处理大量数据的时候，该算法效率较高；</li><li>缺点：要求提前给出要分成的类数K；对初值、孤立点数据敏感；</li><li>解决办法：使用K-means++算法可以解决K均值算法对初值和孤立数据敏感的问题；</li><li>K-means++算法基本原则：选择初始聚类中心时要保证聚类中心之间的距离尽可能远；</li><li>K-means++算法的实现：对原K-means算法的第一步进行优化，先随机选择一个聚类中心，然后计算各个数据点到这个聚类中心的距离，距离越远被选做聚类中心的概率越大，最后用轮盘法（依据概率大小抽选）来选取下一个聚类中心，然后重复这一操作，直至选出K个聚类中心。</li></ul><h4 id="c-举例实现"><a href="#c-举例实现" class="headerlink" title="c.举例实现"></a>c.举例实现</h4><p>在这我们使用<a href="https://baike.baidu.com/item/spss/2351375?fr=aladdin" target="_blank" rel="noopener">SPSS</a>软件来实现K均值聚类，SPSS默认使用K-means++算法：</p><ol><li>打开<a href="https://baike.baidu.com/item/spss/2351375?fr=aladdin" target="_blank" rel="noopener">SPSS</a>，导入要用于聚类的数据，我这里是直接选择的500组数据（数据是我2020美赛c题对评论文本进行情感提取得到的，分别为消极词得分、中性词得分、积极词得分、复合词得分）粘贴进去<br><img src="https://img-blog.csdnimg.cn/20200326190637565.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li><li>接下来操作如下：<br><img src="https://img-blog.csdnimg.cn/20200326191149603.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li><li>然后设置如下，设置完毕后点击<strong>确定</strong>，系统就开始聚类了：<br><img src="https://img-blog.csdnimg.cn/20200326192324788.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li><li>聚类结果：<br><img src="https://img-blog.csdnimg.cn/20200326192942116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200326192830192.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></li></ol><h4 id="d-注意事项："><a href="#d-注意事项：" class="headerlink" title="d.注意事项："></a>d.注意事项：</h4><p>如果数据的量纲不一致，那么计算距离就没有意义了，我们得先将数据进行标准化，操作如下：<br><img src="https://img-blog.csdnimg.cn/20200326200856623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200326200915398.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="3-系统（层次）聚类算法："><a href="#3-系统（层次）聚类算法：" class="headerlink" title="3.系统（层次）聚类算法："></a>3.系统（层次）聚类算法：</h2><h4 id="a-算法流程"><a href="#a-算法流程" class="headerlink" title="a.算法流程"></a>a.算法流程</h4><ul><li>将每个对象看作一类，计算两两之间的最小距离；</li><li>将距离最小的两个类合并成一个新类；</li><li>重新计算新类与所有类之间的距离；</li><li>重复二三两步，直到所有类最后合并成一类，聚类结束。</li></ul><h4 id="b-SPSS实现："><a href="#b-SPSS实现：" class="headerlink" title="b.SPSS实现："></a>b.<a href="https://baike.baidu.com/item/spss/2351375?fr=aladdin" target="_blank" rel="noopener">SPSS</a>实现：</h4><p><img src="https://img-blog.csdnimg.cn/20200326203721645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODU3ODAw,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>结果会得到一张谱系图，由于图片太长我就不展示了，根据谱系图我们可以自己决定将数据分为几类。</p><h2 id="4-DBSCAN算法："><a href="#4-DBSCAN算法：" class="headerlink" title="4.DBSCAN算法："></a>4.<a href="https://baike.baidu.com/item/DBSCAN/4864716?fr=aladdin" target="_blank" rel="noopener">DBSCAN</a>算法：</h2><p>该算法是一种基于密度的聚类算法，聚类前不需要预先指定聚类的个数，生成簇的个数不定（由数据决定）。该算法利用基于密度的聚类的概念，即要求聚类空间中的一定区域内所包含对象（点或其他空间对象）的数目不小于某一给定阈值。该方法能在具有噪声的空间数据库中发现任意形状的簇，可将密度足够大的相邻区域连接，能有效处理异常数据。（说白了就是：挨我近的就是我的兄弟，我兄弟的兄弟，就是我的兄弟）</p><h4 id="a-基本概念："><a href="#a-基本概念：" class="headerlink" title="a.基本概念："></a>a.基本概念：</h4><p>DBSCAN算法将数据分为以下三类：</p><ul><li>核心点：在半径Eps内含有不少于MinPts数目的点；</li><li>边界点：在半径Eps内点的数量小于MinPts，但是落在核心点的邻域内；</li><li>噪音点：既不是核心点也不是边界点的点。</li></ul><h4 id="b-优缺点："><a href="#b-优缺点：" class="headerlink" title="b.优缺点："></a>b.优缺点：</h4><p> <strong>1. 优点：</strong></p><ul><li>基于密度定义，能够处理任意形状和大小的簇；</li><li>可在聚类的同时发现异常点；</li><li>不需要指定要划分的簇的个数</li></ul><p> <strong>2.</strong> </p><ul><li>对于输入参数$\xi$和MinPts敏感，确定参数困难；</li><li>在该算法中，变量$\xi$和MinPts是全局唯一的，当聚类的密度不均匀时，聚类距离相差很大时，聚类质量差；</li><li>当数据量大时，计算密度单元的计算复杂度大</li></ul><h2 id="4-可视化："><a href="#4-可视化：" class="headerlink" title="4.可视化："></a>4.可视化：</h2><ol><li>K-means聚类算法可视化，<a href="https://www.naftaliharris.com/blog/visualizing-k-means-clustering/" target="_blank" rel="noopener">戳我</a></li><li>DBSCAN算法可视化，<a href="https://www.naftaliharris.com/blog/visualizing-dbscan-clustering/" target="_blank" rel="noopener">戳我</a></li></ol><h2 id="5-总结："><a href="#5-总结：" class="headerlink" title="5.总结："></a>5.总结：</h2><p>聚类算法在数学建模中应用比较广泛，这次2020美赛我们队伍还用到了系统聚类算法来对评论进行分类评级，这几种算法的优缺点都很明显，尽量根据实际情况来合理使用，效果会更好。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 数模 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
